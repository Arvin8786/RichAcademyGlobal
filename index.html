<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promotion Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            max-width: 500px;
            margin: 0 auto;
        }
        .promotion-card, .festival-card {
            margin-bottom: 20px;
        }
        .card-img-top {
            height: 200px;
            object-fit: cover;
        }
        .active-promotion {
            border-left: 5px solid #28a745;
        }
        .expired-promotion {
            border-left: 5px solid #dc3545;
        }
        .nav-tabs {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="app" class="container mt-5">
        <!-- Login Screen -->
        <div id="login-screen" class="card">
            <div class="card-body">
                <h2 class="card-title">Admin Login</h2>
                <form id="login-form">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </div>
        </div>

        <!-- Dashboard (hidden by default) -->
        <div id="dashboard" class="d-none">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
                <div class="container-fluid">
                    <span class="navbar-brand">Promotion Manager</span>
                    <button id="logout-btn" class="btn btn-outline-light">Logout</button>
                </div>
            </nav>

            <ul class="nav nav-tabs" id="managerTabs">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#promotions-tab">Promotions</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#festivals-tab">Festivals</button>
                </li>
            </ul>

            <div class="tab-content mt-3">
                <!-- Promotions Tab -->
                <div class="tab-pane fade show active" id="promotions-tab">
                    <button id="add-promotion-btn" class="btn btn-success mb-3">Add Promotion</button>
                    <div id="promotions-list" class="row"></div>
                </div>

                <!-- Festivals Tab -->
                <div class="tab-pane fade" id="festivals-tab">
                    <button id="add-festival-btn" class="btn btn-success mb-3">Add Festival</button>
                    <div id="festivals-list" class="row"></div>
                </div>
            </div>
        </div>

        <!-- Promotion Modal -->
        <div class="modal fade" id="promotion-modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="promotion-modal-title">Add New Promotion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="promotion-form">
                            <input type="hidden" id="promotion-id">
                            <div class="mb-3">
                                <label for="promotion-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="promotion-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="promotion-description" class="form-label">Description</label>
                                <textarea class="form-control" id="promotion-description" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="promotion-image" class="form-label">Image URL</label>
                                <input type="text" class="form-control" id="promotion-image">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="promotion-start" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="promotion-start" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="promotion-end" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="promotion-end" required>
                                </div>
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="promotion-active">
                                <label class="form-check-label" for="promotion-active">Active</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-promotion">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Festival Modal -->
        <div class="modal fade" id="festival-modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="festival-modal-title">Add New Festival</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="festival-form">
                            <input type="hidden" id="festival-id">
                            <div class="mb-3">
                                <label for="festival-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="festival-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="festival-description" class="form-label">Description</label>
                                <textarea class="form-control" id="festival-description" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="festival-image" class="form-label">Image URL</label>
                                <input type="text" class="form-control" id="festival-image">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="festival-start" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="festival-start" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="festival-end" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="festival-end" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="festival-location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="festival-location" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-festival">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Promotion Manager Object
        const PromotionManager = {
            // Initialize the system
            init: function() {
                // Create admin account if not exists
                if (!localStorage.getItem('admin')) {
                    localStorage.setItem('admin', JSON.stringify({
                        username: 'admin',
                        password: 'admin123' // In real app, this should be hashed
                    }));
                }
                
                // Initialize promotions and festivals if not exists
                if (!localStorage.getItem('promotions')) {
                    localStorage.setItem('promotions', JSON.stringify([]));
                }
                if (!localStorage.getItem('festivals')) {
                    localStorage.setItem('festivals', JSON.stringify([]));
                }
                
                // Check if user is already logged in
                if (sessionStorage.getItem('loggedIn')) {
                    this.showDashboard();
                }
            },
            
            // Authentication functions
            login: function(username, password) {
                const admin = JSON.parse(localStorage.getItem('admin'));
                if (admin.username === username && admin.password === password) {
                    sessionStorage.setItem('loggedIn', 'true');
                    this.showDashboard();
                    return true;
                }
                return false;
            },
            
            logout: function() {
                sessionStorage.removeItem('loggedIn');
                this.showLogin();
            },
            
            // UI Functions
            showLogin: function() {
                document.getElementById('login-screen').classList.remove('d-none');
                document.getElementById('dashboard').classList.add('d-none');
                document.getElementById('login-form').reset();
            },
            
            showDashboard: function() {
                document.getElementById('login-screen').classList.add('d-none');
                document.getElementById('dashboard').classList.remove('d-none');
                this.loadPromotions();
                this.loadFestivals();
            },
            
            // Promotion CRUD Operations
            createPromotion: function(promotion) {
                const promotions = this.getAllPromotions();
                promotion.id = Date.now().toString();
                promotions.push(promotion);
                localStorage.setItem('promotions', JSON.stringify(promotions));
                return promotion;
            },
            
            getPromotion: function(id) {
                const promotions = this.getAllPromotions();
                return promotions.find(p => p.id === id);
            },
            
            getAllPromotions: function() {
                return JSON.parse(localStorage.getItem('promotions'));
            },
            
            updatePromotion: function(id, updatedPromotion) {
                let promotions = this.getAllPromotions();
                promotions = promotions.map(p => p.id === id ? {...p, ...updatedPromotion} : p);
                localStorage.setItem('promotions', JSON.stringify(promotions));
                return this.getPromotion(id);
            },
            
            deletePromotion: function(id) {
                let promotions = this.getAllPromotions();
                promotions = promotions.filter(p => p.id !== id);
                localStorage.setItem('promotions', JSON.stringify(promotions));
            },
            
            // Festival CRUD Operations
            createFestival: function(festival) {
                const festivals = this.getAllFestivals();
                festival.id = Date.now().toString();
                festivals.push(festival);
                localStorage.setItem('festivals', JSON.stringify(festivals));
                return festival;
            },
            
            getFestival: function(id) {
                const festivals = this.getAllFestivals();
                return festivals.find(f => f.id === id);
            },
            
            getAllFestivals: function() {
                return JSON.parse(localStorage.getItem('festivals'));
            },
            
            updateFestival: function(id, updatedFestival) {
                let festivals = this.getAllFestivals();
                festivals = festivals.map(f => f.id === id ? {...f, ...updatedFestival} : f);
                localStorage.setItem('festivals', JSON.stringify(festivals));
                return this.getFestival(id);
            },
            
            deleteFestival: function(id) {
                let festivals = this.getAllFestivals();
                festivals = festivals.filter(f => f.id !== id);
                localStorage.setItem('festivals', JSON.stringify(festivals));
            },
            
            // UI Loading Functions
            loadPromotions: function() {
                const promotions = this.getAllPromotions();
                const container = document.getElementById('promotions-list');
                container.innerHTML = '';
                
                if (promotions.length === 0) {
                    container.innerHTML = '<p>No promotions found. Add your first promotion!</p>';
                    return;
                }
                
                promotions.forEach(promotion => {
                    const isActive = new Date(promotion.end) >= new Date() && promotion.active;
                    const cardClass = isActive ? 'active-promotion' : 'expired-promotion';
                    
                    const card = document.createElement('div');
                    card.className = `col-md-6 promotion-card`;
                    card.innerHTML = `
                        <div class="card ${cardClass}">
                            ${promotion.image ? `<img src="${promotion.image}" class="card-img-top" alt="${promotion.name}">` : ''}
                            <div class="card-body">
                                <h5 class="card-title">${promotion.name}</h5>
                                <p class="card-text">${promotion.description}</p>
                                <p class="card-text"><small class="text-muted">${new Date(promotion.start).toLocaleDateString()} - ${new Date(promotion.end).toLocaleDateString()}</small></p>
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-sm btn-primary edit-promotion" data-id="${promotion.id}">Edit</button>
                                    <button class="btn btn-sm btn-danger delete-promotion" data-id="${promotion.id}">Delete</button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.edit-promotion').forEach(btn => {
                    btn.addEventListener('click', (e) => this.showEditPromotionModal(e.target.dataset.id));
                });
                
                document.querySelectorAll('.delete-promotion').forEach(btn => {
                    btn.addEventListener('click', (e) => this.deletePromotionHandler(e.target.dataset.id));
                });
            },
            
            loadFestivals: function() {
                const festivals = this.getAllFestivals();
                const container = document.getElementById('festivals-list');
                container.innerHTML = '';
                
                if (festivals.length === 0) {
                    container.innerHTML = '<p>No festivals found. Add your first festival!</p>';
                    return;
                }
                
                festivals.forEach(festival => {
                    const card = document.createElement('div');
                    card.className = 'col-md-6 festival-card';
                    card.innerHTML = `
                        <div class="card">
                            ${festival.image ? `<img src="${festival.image}" class="card-img-top" alt="${festival.name}">` : ''}
                            <div class="card-body">
                                <h5 class="card-title">${festival.name}</h5>
                                <p class="card-text">${festival.description}</p>
                                <p class="card-text"><small class="text-muted">${new Date(festival.start).toLocaleDateString()} - ${new Date(festival.end).toLocaleDateString()}</small></p>
                                <p class="card-text"><i class="bi bi-geo-alt"></i> ${festival.location}</p>
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-sm btn-primary edit-festival" data-id="${festival.id}">Edit</button>
                                    <button class="btn btn-sm btn-danger delete-festival" data-id="${festival.id}">Delete</button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.edit-festival').forEach(btn => {
                    btn.addEventListener('click', (e) => this.showEditFestivalModal(e.target.dataset.id));
                });
                
                document.querySelectorAll('.delete-festival').forEach(btn => {
                    btn.addEventListener('click', (e) => this.deleteFestivalHandler(e.target.dataset.id));
                });
            },
            
            // Modal Handlers
            showAddPromotionModal: function() {
                document.getElementById('promotion-modal-title').textContent = 'Add New Promotion';
                document.getElementById('promotion-form').reset();
                document.getElementById('promotion-id').value = '';
                promotionModal.show();
            },
            
            showEditPromotionModal: function(id) {
                const promotion = this.getPromotion(id);
                if (!promotion) return;
                
                document.getElementById('promotion-modal-title').textContent = 'Edit Promotion';
                document.getElementById('promotion-id').value = promotion.id;
                document.getElementById('promotion-name').value = promotion.name;
                document.getElementById('promotion-description').value = promotion.description;
                document.getElementById('promotion-image').value = promotion.image || '';
                document.getElementById('promotion-start').value = promotion.start.split('T')[0];
                document.getElementById('promotion-end').value = promotion.end.split('T')[0];
                document.getElementById('promotion-active').checked = promotion.active || false;
                
                promotionModal.show();
            },
            
            showAddFestivalModal: function() {
                document.getElementById('festival-modal-title').textContent = 'Add New Festival';
                document.getElementById('festival-form').reset();
                document.getElementById('festival-id').value = '';
                festivalModal.show();
            },
            
            showEditFestivalModal: function(id) {
                const festival = this.getFestival(id);
                if (!festival) return;
                
                document.getElementById('festival-modal-title').textContent = 'Edit Festival';
                document.getElementById('festival-id').value = festival.id;
                document.getElementById('festival-name').value = festival.name;
                document.getElementById('festival-description').value = festival.description;
                document.getElementById('festival-image').value = festival.image || '';
                document.getElementById('festival-start').value = festival.start.split('T')[0];
                document.getElementById('festival-end').value = festival.end.split('T')[0];
                document.getElementById('festival-location').value = festival.location;
                
                festivalModal.show();
            },
            
            // Form Handlers
            savePromotion: function() {
                const id = document.getElementById('promotion-id').value;
                const promotion = {
                    name: document.getElementById('promotion-name').value,
                    description: document.getElementById('promotion-description').value,
                    image: document.getElementById('promotion-image').value,
                    start: document.getElementById('promotion-start').value,
                    end: document.getElementById('promotion-end').value,
                    active: document.getElementById('promotion-active').checked
                };
                
                if (id) {
                    this.updatePromotion(id, promotion);
                } else {
                    this.createPromotion(promotion);
                }
                
                promotionModal.hide();
                this.loadPromotions();
            },
            
            saveFestival: function() {
                const id = document.getElementById('festival-id').value;
                const festival = {
                    name: document.getElementById('festival-name').value,
                    description: document.getElementById('festival-description').value,
                    image: document.getElementById('festival-image').value,
                    start: document.getElementById('festival-start').value,
                    end: document.getElementById('festival-end').value,
                    location: document.getElementById('festival-location').value
                };
                
                if (id) {
                    this.updateFestival(id, festival);
                } else {
                    this.createFestival(festival);
                }
                
                festivalModal.hide();
                this.loadFestivals();
            },
            
            // Delete Handlers
            deletePromotionHandler: function(id) {
                if (confirm('Are you sure you want to delete this promotion?')) {
                    this.deletePromotion(id);
                    this.loadPromotions();
                }
            },
            
            deleteFestivalHandler: function(id) {
                if (confirm('Are you sure you want to delete this festival?')) {
                    this.deleteFestival(id);
                    this.loadFestivals();
                }
            }
        };
        
        // Initialize modals
        const promotionModal = new bootstrap.Modal(document.getElementById('promotion-modal'));
        const festivalModal = new bootstrap.Modal(document.getElementById('festival-modal'));
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            PromotionManager.init();
            
            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (!PromotionManager.login(username, password)) {
                    alert('Invalid credentials');
                }
            });
            
            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                PromotionManager.logout();
            });
            
            // Add promotion button
            document.getElementById('add-promotion-btn').addEventListener('click', function() {
                PromotionManager.showAddPromotionModal();
            });
            
            // Add festival button
            document.getElementById('add-festival-btn').addEventListener('click', function() {
                PromotionManager.showAddFestivalModal();
            });
            
            // Save promotion button
            document.getElementById('save-promotion').addEventListener('click', function() {
                PromotionManager.savePromotion();
            });
            
            // Save festival button
            document.getElementById('save-festival').addEventListener('click', function() {
                PromotionManager.saveFestival();
            });
        });
    </script>
</body>
</html>
