<script>
// Product Data (30 products with hot selling badges)
const products = [
  // ... (same as before, all 30 items unchanged)
];

const cart = [];
let currentProduct = null;

// Load products on page load
function loadProducts() {
  const container = document.getElementById("product-list");
  container.innerHTML = "";

  products.forEach((product) => {
    const div = document.createElement("div");
    div.className = "product";
    div.onclick = () => openProductModal(product);

    let badge = "";
    if (product.hot) {
      badge = `<div class="hot-badge">HOT</div>`;
    }

    div.innerHTML = `
      ${badge}
      <img src="${product.image}" alt="${product.name}">
      <h3>${product.name}</h3>
      <p class="price">RM ${product.price.toFixed(2)}</p>
      <button onclick="event.stopPropagation(); addToCart(${product.id})">Add to Cart</button>
    `;
    container.appendChild(div);
  });
}

// Product Modal Functions
function openProductModal(product) {
  currentProduct = product;
  const modal = document.getElementById("product-modal");
  document.getElementById("modal-product-img").src = product.image;
  document.getElementById("modal-product-name").textContent = product.name;
  document.getElementById("modal-product-desc").textContent = product.description;
  document.getElementById("modal-product-price").textContent = `RM ${product.price.toFixed(2)}`;
  document.getElementById("product-qty").textContent = "1";
  modal.style.display = "block";
}

function closeModal() {
  document.getElementById("product-modal").style.display = "none";
}

// Cart Functions
function addToCart(productId, quantity = 1) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  const existingItem = cart.find(item => item.id === productId);
  if (existingItem) {
    existingItem.quantity += quantity;
  } else {
    cart.push({
      id: product.id,
      name: product.name,
      price: product.price,
      quantity: quantity,
      image: product.image
    });
  }

  updateCartUI();
  closeModal();
}

function removeFromCart(productId) {
  const index = cart.findIndex(item => item.id === productId);
  if (index !== -1) {
    cart.splice(index, 1);
    updateCartUI();
  }
}

function updateCartItemQuantity(productId, newQuantity) {
  const item = cart.find(item => item.id === productId);
  if (item) {
    item.quantity = newQuantity;
    updateCartUI();
  }
}

function updateCartUI() {
  const cartItemsContainer = document.getElementById("cart-items");
  const cartCount = document.getElementById("cart-count");
  const cartTotal = document.getElementById("cart-total");

  cartItemsContainer.innerHTML = "";

  let total = 0;
  cart.forEach(item => {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;

    const itemDiv = document.createElement("div");
    itemDiv.className = "cart-item";
    itemDiv.innerHTML = `
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-price">RM ${item.price.toFixed(2)}</div>
      </div>
      <div class="cart-item-qty">
        <button onclick="updateCartItemQuantity(${item.id}, ${item.quantity-1})">-</button>
        <span>${item.quantity}</span>
        <button onclick="updateCartItemQuantity(${item.id}, ${item.quantity+1})">+</button>
      </div>
      <div class="cart-item-remove" onclick="removeFromCart(${item.id})">&times;</div>
    `;
    cartItemsContainer.appendChild(itemDiv);
  });

  cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
  cartTotal.textContent = `Total: RM ${total.toFixed(2)}`;
}

function toggleCart() {
  const panel = document.getElementById("cart-panel");
  panel.style.display = panel.style.display === "block" ? "none" : "block";
}

function checkout() {
  if (cart.length === 0) {
    alert("Your cart is empty!");
    return;
  }

  const phone = "601111033154";
  let message = "Hi, I'd like to place an order:\n\n";

  cart.forEach(item => {
    message += `${item.name} x ${item.quantity} = RM ${(item.price * item.quantity).toFixed(2)}\n`;
  });

  const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  message += `\nTotal: RM ${total.toFixed(2)}\n\n`;
  message += "Please advise on payment and delivery. Thank you!";

  const encodedMessage = encodeURIComponent(message);
  window.open(`https://wa.me/${phone}?text=${encodedMessage}`, "_blank");
}

// AI Suggestion Function
function suggestProducts() {
  const input = document.getElementById("symptom-input").value.trim().toLowerCase();
  if (!input) {
    alert("Please enter your health concern");
    return;
  }

  const concerns = input.split(/[,;]/).map(s => s.trim());
  const matchedProducts = [];

  concerns.forEach(concern => {
    if (concern.includes('skin') || concern.includes('acne') || concern.includes('eczema')) {
      matchedProducts.push(
        products.find(p => p.name.includes("Aloe Vera Gel")),
        products.find(p => p.name.includes("Aloe First"))
      );
    }
    if (concern.includes('joint') || concern.includes('arthritis') || concern.includes('pain')) {
      matchedProducts.push(
        products.find(p => p.name.includes("Freedom")),
        products.find(p => p.name.includes("MSM"))
      );
    }
    if (concern.includes('immune') || concern.includes('cold') || concern.includes('flu')) {
      matchedProducts.push(
        products.find(p => p.name.includes("Bee Honey")),
        products.find(p => p.name.includes("Immublend"))
      );
    }
    if (concern.includes('energy') || concern.includes('fatigue') || concern.includes('tired')) {
      matchedProducts.push(
        products.find(p => p.name.includes("Royal Jelly")),
        products.find(p => p.name.includes("Argi+"))
      );
    }
    if (concern.includes('digest') || concern.includes('stomach') || concern.includes('bloat')) {
      matchedProducts.push(
        products.find(p => p.name.includes("Aloe Vera Gel")),
        products.find(p => p.name.includes("Probiotic"))
      );
    }
    if (concern.includes('weight') || concern.includes('diet') || concern.includes('fat')) {
      matchedProducts.push(
        products.find(p => p.name.includes("Therm")),
        products.find(p => p.name.includes("Lean"))
      );
    }
  });

  const uniqueProducts = [...new Map(matchedProducts.filter(p => p).map(p => [p.id, p])).values()];

  displaySuggestions(uniqueProducts);
}

function displaySuggestions(products) {
  const container = document.getElementById("suggestion-result");

  if (products.length === 0) {
    container.innerHTML = "<p>No products found for your concerns. Please contact us for personalized advice.</p>";
    return;
  }

  let html = "<h3>Recommended Products:</h3>";
  products.forEach(product => {
    html += `
      <div class="suggested-product" onclick="openProductModal(${product.id})">
        <img src="${product.image}" alt="${product.name}">
        <div>
          <strong>${product.name}</strong><br>
          RM ${product.price.toFixed(2)}
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
  loadProducts();
  document.querySelector('.close').addEventListener('click', closeModal);
  window.addEventListener('click', (event) => {
    if (event.target === document.getElementById('product-modal')) {
      closeModal();
    }
  });
  document.getElementById('increase-qty').addEventListener('click', () => {
    const qtyEl = document.getElementById('product-qty');
    qtyEl.textContent = parseInt(qtyEl.textContent) + 1;
  });
  document.getElementById('decrease-qty').addEventListener('click', () => {
    const qtyEl = document.getElementById('product-qty');
    const newQty = Math.max(1, parseInt(qtyEl.textContent) - 1);
    qtyEl.textContent = newQty;
  });
  document.getElementById('modal-add-to-cart').addEventListener('click', () => {
    if (currentProduct) {
      const quantity = parseInt(document.getElementById('product-qty').textContent);
      addToCart(currentProduct.id, quantity);
    }
  });
});
</script>
