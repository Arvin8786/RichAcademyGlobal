<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forever Living by Muhd Arvind Isa</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root{--primary-color:#1a5276;--secondary-color:#f39c12;--accent-color:#27ae60;--light-gray:#f4f6f8;--dark-text:#333;--light-text:#fff;--border-radius:12px;--shadow:0 4px 15px rgba(0,0,0,.08);--font-family:'Poppins',sans-serif}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}@keyframes promoGlow{0%{box-shadow:0 0 5px rgba(243,156,18,.6)}50%{box-shadow:0 0 20px rgba(243,156,18,.9)}100%{box-shadow:0 0 5px rgba(243,156,18,.6)}}@keyframes marquee{0%{transform:translateX(0%)}100%{transform:translateX(-100%)}}
    *,::after,::before{box-sizing:border-box}
    body{font-family:var(--font-family);margin:0;padding:0;background-color:var(--light-gray);color:var(--dark-text);overflow-x:hidden;line-height:1.6;padding-top:45px; position: relative;}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}h1,h2,h3,h4{color:var(--primary-color);font-weight:600}
    .hero-section{background:linear-gradient(135deg, #2c3e50, #4ca1af);color:var(--light-text);padding:80px 20px;text-align:center;border-radius:var(--border-radius);margin-bottom:30px;transition:all .5s ease;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    
    header{background-color:var(--light-text);padding:20px 0;text-align:center;border-bottom:1px solid #e0e0e0;position:relative}.header-content{display:flex;align-items:center;justify-content:center;gap:20px}.header-logo{width:80px;height:80px}.header-content h1{margin:0}.header-content h1 span{display:block}#promo-running-banner{color:var(--light-text);padding:10px 0;text-align:center;font-weight:700;font-size:1.1rem;position:fixed;top:0;left:0;width:100%;box-shadow:0 2px 5px rgba(0,0,0,.1);z-index:101;overflow:hidden;white-space:nowrap;display:none}#promo-running-banner .marquee-content{display:inline-block;padding-left:100%;animation:marquee 20s linear infinite}nav{background-color:var(--primary-color);position:sticky;top:45px;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.1)}nav ul{display:flex;list-style:none;padding:10px 0;margin:0;justify-content:center;flex-wrap:wrap}nav a{color:var(--light-text);text-decoration:none;font-weight:600;padding:10px 20px;display:inline-block;position:relative;transition:color .3s;cursor:pointer}nav a::after{content:'';position:absolute;bottom:5px;left:50%;transform:translateX(-50%);width:0;height:2px;background-color:var(--secondary-color);transition:width .3s}nav a:hover{color:#f1c40f}nav a:hover::after{width:60%}
    nav a.nav-disabled{color:#a9a9a9;pointer-events:none;cursor:not-allowed}nav a.nav-disabled:hover{color:#a9a9a9}nav a.nav-disabled::after{width:0!important}
    .tab-content{display:none;padding:20px 0}.tab-content.active{display:block;animation:fadeIn .5s}.hero-section h2{color:var(--light-text)}.ai-suggestion-box,.search-container{margin-bottom:30px;position:relative}
    #product-search{width:100%;padding:15px 50px 15px 25px;border:2px solid #ddd;border-radius:50px;font-size:1rem;outline:none;transition:all .3s}#product-search:focus{border-color:var(--primary-color);box-shadow:0 0 10px rgba(26,82,118,.2)}.search-icon{position:absolute;right:25px;top:50%;transform:translateY(-50%);color:var(--primary-color);font-size:1.2rem}
    .ai-suggestion-box{background:var(--light-text);padding:30px;border-radius:var(--border-radius);box-shadow:var(--shadow);text-align:center}#symptom-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;margin:10px 0}#suggest-btn{background:linear-gradient(135deg,var(--primary-color),var(--accent-color));color:var(--light-text);border:none;padding:12px 30px;border-radius:50px;cursor:pointer;font-weight:700;transition:all .3s;margin-top:10px}#suggest-btn:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.2)}#suggestion-result{margin-top:20px;text-align:left}.suggestion-product{background:#f8f9fa;padding:15px;border-radius:8px;margin:10px 0;display:flex;justify-content:space-between;align-items:center;border-left:4px solid var(--accent-color)}
    .promo-section h2 {font-size: 2rem; border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 25px; margin-top: 40px;}
    .product-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:30px}.product{background:var(--light-text);border-radius:var(--border-radius);box-shadow:var(--shadow);display:flex;flex-direction:column;position:relative;transition:all .3s ease;overflow:hidden}.product:hover{transform:translateY(-8px);box-shadow:0 10px 25px rgba(0,0,0,.12)}.product.promo-highlight{animation:promoGlow 2.5s infinite ease-in-out}.product-image-container{height:220px;padding:15px;display:flex;align-items:center;justify-content:center}.product img{max-width:100%;max-height:100%;object-fit:contain}.product-info{padding:20px;flex-grow:1;display:flex;flex-direction:column;text-align:left;position:relative}.product h3{margin:0 0 10px;font-size:1.25rem;height:3.75rem;overflow:hidden}.product .benefits{font-size:.85rem;color:#555;margin:10px 0;flex-grow:1}.product .consumption{font-size:.85rem;color:var(--primary-color);font-style:italic;margin:10px 0}.price-section{margin:15px 0;text-align:center}.original-price{text-decoration:line-through;color:#999;font-size:1rem;margin-right:10px}.new-price{color:var(--secondary-color);font-weight:700;font-size:1.5rem}.product-points{font-size:.9rem;font-weight:600;color:var(--accent-color);text-align:center;margin-top:10px}.product-actions{margin-top:auto;display:flex;flex-direction:column;gap:10px}.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 15px;border-radius:50px;text-decoration:none;font-weight:700;border:none;cursor:pointer;transition:all .3s}.btn:disabled{background-color:#ccc;cursor:not-allowed}.btn-primary{background:var(--primary-color);color:var(--light-text)}.btn-primary:hover{background:#123e5a;transform:scale(1.05)}.btn-secondary{background:var(--light-gray);color:var(--primary-color);border:1px solid var(--primary-color)}.btn-secondary:hover{background:#e0e0e0}.featured-badge{position:absolute;top:0;right:0;background:var(--secondary-color);color:#fff;padding:5px 25px;transform:rotate(45deg) translate(25%,-65%);transform-origin:0 0;font-weight:700;font-size:.9rem;box-shadow:0 3px 10px rgba(0,0,0,.2);z-index:10;white-space:nowrap}.halal-badge{position:absolute;top:10px;left:10px;background-color:rgba(255,255,255,0.8);color:var(--accent-color);padding:3px 8px;border-radius:5px;font-size:.75rem;font-weight:700;border:1px solid rgba(39,174,96,0.3)}.floating-cart-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background-color:var(--primary-color);color:var(--light-text);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;box-shadow:0 4px 12px rgba(0,0,0,.25);cursor:pointer;z-index:1000;transition:transform .3s ease}.floating-cart-btn:hover{transform:scale(1.1)}#cart-count{position:absolute;top:-2px;right:-2px;background-color:var(--secondary-color);color:var(--light-text);border-radius:50%;padding:3px 8px;font-size:.8rem;font-weight:700;border:2px solid var(--light-text)}.modal{display:none;position:fixed;z-index:1001;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);align-items:center;justify-content:center;animation:fadeIn .4s ease}.modal-content{background-color:#fefefe;padding:30px;border-radius:var(--border-radius);width:90%;max-width:600px;animation:slideIn .4s ease;max-height:90vh;overflow-y:auto}.close{color:#aaa;float:right;font-size:28px;font-weight:700;cursor:pointer;transition:color .3s}.close:hover{color:#000}#cart-items{max-height:250px;overflow-y:auto;padding-right:10px;border-bottom:1px solid #eee;margin-bottom:15px}.cart-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0}.cart-item-details{flex-grow:1}.quantity-controls{display:flex;align-items:center;gap:8px;margin-top:5px}.quantity-btn{width:28px;height:28px;background:var(--light-gray);border:1px solid #ccc;border-radius:50%;cursor:pointer;font-weight:700}.quantity-display{font-weight:600;min-width:20px;text-align:center}.remove-item-btn{font-size:1.2rem;color:#c00;cursor:pointer;margin-left:15px; border: none; background: none;}.cart-summary{margin-top:20px;font-size:1.1rem}.summary-line{display:flex;justify-content:space-between;padding:8px 0}.summary-line.total{font-weight:700;font-size:1.3rem;border-top:2px solid #333;margin-top:10px}.points-earned,.free-shipping-promo{background-color:#e0f2f1;color:var(--accent-color);padding:10px;border-radius:8px;text-align:center;margin-top:20px;font-weight:700}.customer-info-form input{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px}.discount-section{display:flex;gap:10px;margin-top:15px}.discount-section input{flex-grow:1;padding:10px;border:1px solid #ccc;border-radius:5px}.discount-section button{width:auto;padding:10px 15px;flex-shrink:0}#discount-status{font-size:.9rem;font-weight:600;margin-top:8px;min-height:18px;text-align:center}#consent-form{margin-top:20px;padding:15px;background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;font-size:.9rem}#consent-form label{display:flex;align-items:flex-start;gap:10px}#consent-form input[type=checkbox]{margin-top:3px}#consent-form a{color:var(--primary-color);font-weight:600}.checkout-btn{width:100%;margin-top:15px}.verification-step{margin-top:20px;padding:20px;background-color:var(--light-gray);border-radius:var(--border-radius);text-align:center;border:2px dashed #ddd}.verification-step.active{border-color:var(--primary-color);background-color:#eaf2f8}.verification-step.completed{border-color:var(--accent-color);background-color:#e8f8f5;opacity:.7}.verification-step h4{margin-top:0}.verification-step input[type=file],.verification-step input[type=text]{width:100%;padding:12px;margin:15px 0 10px;border:1px solid #ddd;border-radius:8px}#upload-status,#verification-status{margin-top:10px;font-weight:700;min-height:20px}footer{background:var(--primary-color);color:var(--light-text);padding:40px 20px;text-align:center;margin-top:30px}.disclaimer{margin-top:10px;background-color:#fff3cd;color:#856404;padding:15px;border-top:1px solid #ffeeba}
    .about-us-section{padding:40px;background-color:#fff;border-radius:var(--border-radius);box-shadow:var(--shadow)}.about-us-section .owner-profile{display:flex;align-items:center;gap:30px;flex-wrap:wrap}.about-us-section .owner-image{width:150px;height:150px;border-radius:50%;object-fit:cover;border:5px solid var(--primary-color)}.about-us-section .owner-details{flex:1;min-width:300px}.about-us-section ul {list-style: none; padding-left: 0;} .about-us-section ul li {margin-bottom: 10px;} .feedback-form select{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px} .feedback-form textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px;min-height:120px} #feedback-status{font-weight:bold;margin-top:15px;}
    .program-section{background:var(--light-text);padding:40px;border-radius:var(--border-radius);box-shadow:var(--shadow);margin-bottom:30px}.program-section h2{font-size:2.5rem;text-align:center}.program-section ul {list-style: none; padding-left: 0; margin-top: 30px;}.program-section ul li {background: #f9f9f9; border-left: 5px solid var(--accent-color); padding: 15px; margin-bottom: 10px; border-radius: 5px; text-align: left;}.program-section ul li strong {color: var(--primary-color); display: block; margin-bottom: 5px;}
    .cta-button{display:block;width:fit-content;margin:30px auto;background:linear-gradient(135deg,var(--secondary-color),#e67e22);color:var(--light-text);text-align:center;padding:15px 40px;border-radius:50px;font-weight:700;text-decoration:none;font-size:1.2rem;transition:all .3s;box-shadow:0 4px 8px rgba(0,0,0,.2)}.cta-button:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.3)}.rewards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}.reward-item{background:var(--light-gray);border:1px solid #ddd;border-radius:var(--border-radius);padding:20px;text-align:center;display:flex;flex-direction:column;position:relative}.reward-item img{max-width:100%;max-height:100px;object-fit:contain;margin-bottom:15px;border-radius:8px}.reward-item h4{margin:10px 0 5px}.reward-item .points-cost{font-weight:700;color:var(--accent-color);margin-bottom:15px}.coming-soon-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(255,255,255,.8);color:var(--primary-color);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;border-radius:var(--border-radius);backdrop-filter:blur(2px)}
    .original-cart-price{text-decoration:line-through;color:#999;font-size:.9rem;}.final-cart-price{font-weight:600}.summary-line small{font-size:.8rem;color:var(--accent-color);font-style:italic}
    #maintenance-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(26, 82, 118, 0.95); color: white; z-index: 99999; justify-content: center; align-items: center; text-align: center; padding: 20px; }
    #maintenance-overlay i { font-size: 5rem; margin-bottom: 20px; } #maintenance-overlay h1 { font-size: 2.5rem; color: white; } #maintenance-overlay p { font-size: 1.2rem; max-width: 600px; }
    /* CSS for the new pricing display */
    .original-price { text-decoration: line-through; color: #999; font-size: 0.9em; margin-right: 8px; }
    .new-price { color: var(--accent-color); font-weight: bold; font-size: 1.4em; }
  </style>
  <style id="festival-animations-style">
    /* Festival styles are unchanged */
  </style>
</head>
<body data-festival="">

<!-- The rest of your HTML body is unchanged -->
<div id="maintenance-overlay">
  <div><i class="fa-solid fa-person-digging"></i><h1>Under Maintenance</h1><p id="maintenance-message">We'll be back shortly!</p></div>
</div>
<div class="festive-layer"></div>
<div id="store-wrapper">
  <header><!-- ... --></header>
  <div id="promo-running-banner"><div class="marquee-content" id="promo-banner-text"></div></div>
  <nav><!-- ... --></nav>
  <main id="main-content" class="container"><!-- ... --></main>
  <footer class="footer"><!-- ... --></footer>
</div>
<div id="floating-cart" class="floating-cart-btn" onclick="toggleCart()"><i class="fa-solid fa-cart-shopping"></i><span id="cart-count">0</span></div>
<div id="cart-modal" class="modal"><!-- ... --></div>

<script>
    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbzjmV6A2uO8zPu4du5LmGToIfJGwCU_11HmjJEsi9LjZbwXLCs_GXtNfewEc6ZHxGSr/exec';
    let products = []; let cart = []; let activeFestival = null; let activePromotions = [];
    let shippingRules = {}; let availableDiscountCodes = {}; let appliedDiscount = null;

    document.addEventListener('DOMContentLoaded', fetchData);

    async function fetchData() {
        const productListContainer = document.getElementById("product-list-container");
        try {
            const response = await fetch(googleScriptURL);
            if (!response.ok) throw new Error(`Network response error: ${response.statusText}`);
            const data = await response.json();
            if (data.status !== 'success') throw new Error(data.message || 'Failed to parse data.');
            const marketingSettings = data.marketing || {};
            if (marketingSettings.MaintenanceMode === true) {
                document.getElementById('maintenance-message').textContent = marketingSettings.MaintenanceMessage || "We'll be back shortly!";
                document.getElementById('maintenance-overlay').style.display = 'flex';
                return;
            }
            products = data.products || [];
            activeFestival = data.activeFestival || null;
            activePromotions = data.activePromotions || [];
            shippingRules = data.shippingRules || {};
            availableDiscountCodes = data.discountCodes || {};
            initializeUI(marketingSettings);
        } catch (error) {
            console.error("Error fetching store data:", error);
            if (productListContainer) {
                productListContainer.innerHTML = `<p style="text-align: center; color: red; font-weight: bold; width: 100%; padding: 40px 0;"><i class="fa-solid fa-triangle-exclamation"></i> Error loading store.<br>Could not retrieve catalog. Please try again later.</p>`;
            }
        }
        document.getElementById('update-timestamp').textContent = `${new Date().toLocaleDateString('en-GB')} (v18.1)`;
        if (sessionStorage.getItem('pendingOrder')) { 
            toggleCart(); 
        } 
        else { showTab('products'); }
    }

    function initializeUI(marketingSettings) {
        const body = document.body;
        body.removeAttribute("data-festival");
        if (activeFestival && activeFestival.theme) {
            const themeMap = { "CNY": "cny", "NationalDay": "national-day", "MalaysiaDay": "malaysia-day", "MooncakeFestival": "mid-autumn", "Thaipusam": "thaipusam", "HariRaya": "hari-raya", "Deepavali": "deepavali", "Christmas": "christmas", "GrandOpening": "grand-opening", "NewYear": "new-year"};
            const festiveAttr = themeMap[activeFestival.theme];
            if(festiveAttr) { body.setAttribute("data-festival", festiveAttr); }
            document.getElementById('hero-title').innerHTML = `<i class="fa-solid fa-gift"></i> ${activeFestival.name}`;
            document.getElementById('hero-subtitle').textContent = "Enjoy special festive offers!";
        } else {
            document.getElementById('hero-title').innerHTML = `<i class="fa-solid fa-store"></i> Welcome to Our Store`;
            document.getElementById('hero-subtitle').textContent = "Enjoy high-quality wellness products for a healthier lifestyle.";
        }
        const banner = document.getElementById('promo-running-banner');
        const bannerTextEl = document.getElementById('promo-banner-text');
        if (marketingSettings.BannerText) {
            bannerTextEl.textContent = `ðŸ”¥ ${marketingSettings.BannerText} ðŸ”¥`;
            banner.style.backgroundColor = 'var(--primary-color)';
            banner.style.color = 'white';
            banner.style.display = 'block';
        } else if (activePromotions.length > 0) {
            const promoNames = activePromotions.map(p => p.description).join(' | ');
            bannerTextEl.textContent = `âœ¨ ONGOING PROMOTIONS: ${promoNames} âœ¨`;
            banner.style.backgroundColor = 'var(--accent-color)';
            banner.style.color = 'white';
            banner.style.display = 'block';
        }
        renderProducts();
    }
    
    function renderProducts(){
        const productListContainer = document.getElementById("product-list-container"); if (!productListContainer) return;
        if (products.length === 0) { productListContainer.innerHTML = `<p style="text-align: center; width: 100%;">No products found in the catalog.</p>`; return; }
        let html = ""; let displayedProductIds = new Set();
        if (activePromotions && activePromotions.length > 0) {
            activePromotions.forEach(promo => {
                const productsInPromo = products.filter(p => promo.productIDs.includes(p.id));
                if (productsInPromo.length > 0) {
                    html += `<section class="promo-section"><h2>${promo.description}</h2><div class="product-list">`;
                    productsInPromo.forEach(product => { 
                        html += renderSingleProduct(product); 
                        displayedProductIds.add(product.id);
                    });
                    html += `</div></section>`;
                }
            });
        }
        const remainingProducts = products.filter(p => !displayedProductIds.has(p.id));
        if (remainingProducts.length > 0) {
            html += `<section class="promo-section"><h2>All Products</h2><div class="product-list">`;
            remainingProducts.forEach(product => { html += renderSingleProduct(product); });
            html += `</div></section>`;
        }
        productListContainer.innerHTML = html;
    }

    /**
     * [FINAL, CORRECTED VERSION] This function now correctly displays the strikethrough price.
     */
    function renderSingleProduct(product) {
        // This is the new, corrected pricing logic.
        let priceHTML = '';
        if (product.originalPrice) {
            // If an originalPrice exists, it means there's a discount.
            // Create the HTML with the strikethrough original price and the new final price.
            priceHTML = `
                <span class="original-price">RM ${product.originalPrice.toFixed(2)}</span>
                <span class="new-price">RM ${product.price.toFixed(2)}</span>
            `;
        } else {
            // If there is no originalPrice, just show the normal final price.
            priceHTML = `<span class="new-price">RM ${product.price.toFixed(2)}</span>`;
        }

        // The rest of this function is your original code, it remains the same.
        const itemPromo = activePromotions.find(p => p.productIDs.includes(product.id));
        let promoDescriptionHTML = '';
        if (itemPromo && itemPromo.type === 'BUNDLE') {
            promoDescriptionHTML = `<p class="promo-description">${itemPromo.description}</p>`;
        }

        return `
            <div class="product ${itemPromo ? 'promo-highlight' : ''}">
                <div class="halal-badge">HALAL</div>
                ${itemPromo ? '<div class="featured-badge">On Offer!</div>' : ''}
                <div class="product-image-container">
                    <img src="${product.image || 'https://via.placeholder.com/200'}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/200x200?text=Image+Not+Found'">
                </div>
                <div class="product-info">
                    <h3>${product.name}</h3>
                    <div class="price-section">${priceHTML}</div>
                    ${promoDescriptionHTML}
                    <div class="benefits"><strong>Benefits:</strong> ${product.benefits || ''}</div>
                    <div class="consumption"><strong>Usage:</strong> ${product.consumption || ''}</div>
                    <div class="product-actions">
                        <button class="btn btn-primary" onclick="addToCart(${product.id})"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
                    </div>
                </div>
            </div>
        `;
    }

    // --- All other JavaScript functions are unchanged ---
    function addToCart(productId) { /* ... */ }
    function increaseQuantity(productId) { /* ... */ }
    function decreaseQuantity(productId) { /* ... */ }
    function removeItemFromCart(productId) { /* ... */ }
    function updateCartCount() { /* ... */ }
    function applyDiscount() { /* ... */ }
    function calculateCartTotals() { /* ... */ }
    function calculateShipping(currentCart, totalAfterDiscounts, promoShippingRuleId) { /* ... */ }
    function updateCartDisplay() { /* ... */ }
    function initiateCheckout() { /* ... */ }
    function uploadProof() { /* ... */ }
    function finalizeOrder() { /* ... */ }
    function handleSuccessfulFinalization(receiptUrl) { /* ... */ }
    function updateVerificationUI(reset = false) { /* ... */ }
    function cancelVerification() { /* ... */ }
    function toggleCart(t = !1) { /* ... */ }
    function getBase64(t) { /* ... */ }
    function filterProducts() { /* ... */ }
    function suggestProduct() { /* ... */ }
    function sendFeedbackEmail(t) { /* ... */ }
    function toggleCheckoutButton() { /* ... */ }
    function showTab(tabId) { /* ... */ }

</script>
</body>
</html>
