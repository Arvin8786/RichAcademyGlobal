<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forever Living by Muhd Arvind Isa</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root{--primary-color:#1a5276;--secondary-color:#f39c12;--accent-color:#27ae60;--light-gray:#f4f6f8;--dark-text:#333;--light-text:#fff;--border-radius:12px;--shadow:0 4px 15px rgba(0,0,0,.08);--font-family:'Poppins',sans-serif}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}@keyframes promoGlow{0%{box-shadow:0 0 5px rgba(243,156,18,.6)}50%{box-shadow:0 0 20px rgba(243,156,18,.9)}100%{box-shadow:0 0 5px rgba(243,156,18,.6)}}@keyframes marquee{0%{transform:translateX(0%)}100%{transform:translateX(-100%)}}
    *,::after,::before{box-sizing:border-box}
    body{font-family:var(--font-family);margin:0;padding:0;background-color:var(--light-gray);color:var(--dark-text);overflow-x:hidden;line-height:1.6;padding-top:45px; position: relative;}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}h1,h2,h3,h4{color:var(--primary-color);font-weight:600}
    .default-theme .hero-section{background:linear-gradient(135deg, #2c3e50, #4ca1af);color:var(--light-text);padding:80px 20px;text-align:center;border-radius:var(--border-radius);margin-bottom:30px;transition:all .5s ease;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    
    /* --- FESTIVAL THEMES --- */
    .theme-GrandOpening {background-color: #fdf5e6;}
    .theme-GrandOpening .hero-section {background: linear-gradient(135deg, #ffd700, #ff6347); border: 5px solid #fff; box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);}
    .theme-GrandOpening #promo-running-banner {background-color: #ff4500; color: #ffffff;}

    .theme-HariRaya{background-color:#f0fff0}.theme-HariRaya .hero-section{background:linear-gradient(135deg, #006400, #daa520); border:4px dashed #FFD700;}.theme-HariRaya #promo-running-banner{background-color:#006400;color:#FFD700}
    .theme-Deepavali{background-color:#fff8e1}.theme-Deepavali .hero-section{background:linear-gradient(135deg, #ff6b6b, #feca57); border:4px dashed #ff9f43;}.theme-Deepavali #promo-running-banner{background-color:#e74c3c;color:#fff}
    .theme-Christmas{background-color:#f8f9fa}.theme-Christmas .hero-section{background:linear-gradient(135deg, #d32f2f, #388e3c); border:4px dashed #ffffff;}.theme-Christmas #promo-running-banner{background-color:#c62828;color:#fff}
    .theme-CNY{background-color:#fffbf0}.theme-CNY .hero-section{background:linear-gradient(135deg, #c0392b, #f1c40f); border:4px dashed #f1c40f;}.theme-CNY #promo-running-banner{background-color:#c0392b;color:#f1c40f}
    .theme-NationalDay .hero-section, .theme-MalaysiaDay .hero-section {background:linear-gradient(135deg, #000066, #cc0000); border:4px dashed #f1c40f;}
    .theme-Thaipusam .hero-section {background:linear-gradient(135deg, #ff9933, #ffffff); border:4px dashed #3366cc;}
    .theme-MooncakeFestival .hero-section {background:linear-gradient(135deg, #1a1a2e, #ff4e50); border:4px dashed #f9d423;}
    header{background-color:var(--light-text);padding:20px 0;text-align:center;border-bottom:1px solid #e0e0e0;position:relative}.header-content{display:flex;align-items:center;justify-content:center;gap:20px}.header-logo{width:80px;height:80px}.header-content h1{margin:0}.header-content h1 span{display:block}#promo-running-banner{color:var(--light-text);padding:10px 0;text-align:center;font-weight:700;font-size:1.1rem;position:fixed;top:0;left:0;width:100%;box-shadow:0 2px 5px rgba(0,0,0,.1);z-index:101;overflow:hidden;white-space:nowrap;display:none}#promo-running-banner .marquee-content{display:inline-block;padding-left:100%;animation:marquee 20s linear infinite}nav{background-color:var(--primary-color);position:sticky;top:45px;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.1)}nav ul{display:flex;list-style:none;padding:10px 0;margin:0;justify-content:center;flex-wrap:wrap}nav a{color:var(--light-text);text-decoration:none;font-weight:600;padding:10px 20px;display:inline-block;position:relative;transition:color .3s;cursor:pointer}nav a::after{content:'';position:absolute;bottom:5px;left:50%;transform:translateX(-50%);width:0;height:2px;background-color:var(--secondary-color);transition:width .3s}nav a:hover{color:#f1c40f}nav a:hover::after{width:60%}
    nav a.nav-disabled{color:#a9a9a9;pointer-events:none;cursor:not-allowed}nav a.nav-disabled:hover{color:#a9a9a9}nav a.nav-disabled::after{width:0!important}
    .tab-content{display:none;padding:20px 0}.tab-content.active{display:block;animation:fadeIn .5s}.hero-section h2{color:var(--light-text)}.ai-suggestion-box,.search-container{margin-bottom:30px;position:relative}
    #product-search{width:100%;padding:15px 50px 15px 25px;border:2px solid #ddd;border-radius:50px;font-size:1rem;outline:none;transition:all .3s}#product-search:focus{border-color:var(--primary-color);box-shadow:0 0 10px rgba(26,82,118,.2)}.search-icon{position:absolute;right:25px;top:50%;transform:translateY(-50%);color:var(--primary-color);font-size:1.2rem}
    .ai-suggestion-box{background:var(--light-text);padding:30px;border-radius:var(--border-radius);box-shadow:var(--shadow);text-align:center}#symptom-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;margin:10px 0}#suggest-btn{background:linear-gradient(135deg,var(--primary-color),var(--accent-color));color:var(--light-text);border:none;padding:12px 30px;border-radius:50px;cursor:pointer;font-weight:700;transition:all .3s;margin-top:10px}#suggest-btn:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.2)}#suggestion-result{margin-top:20px;text-align:left}.suggestion-product{background:#f8f9fa;padding:15px;border-radius:8px;margin:10px 0;display:flex;justify-content:space-between;align-items:center;border-left:4px solid var(--accent-color)}
    .promo-section h2 {font-size: 2rem; border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 25px; margin-top: 40px;}
    .product-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:30px}.product{background:var(--light-text);border-radius:var(--border-radius);box-shadow:var(--shadow);display:flex;flex-direction:column;position:relative;transition:all .3s ease;overflow:hidden}.product:hover{transform:translateY(-8px);box-shadow:0 10px 25px rgba(0,0,0,.12)}.product.promo-highlight{animation:promoGlow 2.5s infinite ease-in-out}.product-image-container{height:220px;padding:15px;display:flex;align-items:center;justify-content:center}.product img{max-width:100%;max-height:100%;object-fit:contain}.product-info{padding:20px;flex-grow:1;display:flex;flex-direction:column;text-align:left;position:relative}.product h3{margin:0 0 10px;font-size:1.25rem;height:3.75rem;overflow:hidden}.product .benefits{font-size:.85rem;color:#555;margin:10px 0;flex-grow:1}.product .consumption{font-size:.85rem;color:var(--primary-color);font-style:italic;margin:10px 0}.price-section{margin:15px 0;text-align:center}.original-price{text-decoration:line-through;color:#999;font-size:1rem;margin-right:10px}.new-price{color:var(--secondary-color);font-weight:700;font-size:1.5rem}.product-points{font-size:.9rem;font-weight:600;color:var(--accent-color);text-align:center;margin-top:10px}.product-actions{margin-top:auto;display:flex;flex-direction:column;gap:10px}.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 15px;border-radius:50px;text-decoration:none;font-weight:700;border:none;cursor:pointer;transition:all .3s}.btn:disabled{background-color:#ccc;cursor:not-allowed}.btn-primary{background:var(--primary-color);color:var(--light-text)}.btn-primary:hover{background:#123e5a;transform:scale(1.05)}.btn-secondary{background:var(--light-gray);color:var(--primary-color);border:1px solid var(--primary-color)}.btn-secondary:hover{background:#e0e0e0}.featured-badge{position:absolute;top:0;right:0;background:var(--secondary-color);color:#fff;padding:5px 25px;transform:rotate(45deg) translate(25%,-65%);transform-origin:0 0;font-weight:700;font-size:.9rem;box-shadow:0 3px 10px rgba(0,0,0,.2);z-index:10;white-space:nowrap}.halal-badge{position:absolute;top:10px;left:10px;background-color:rgba(255,255,255,0.8);color:var(--accent-color);padding:3px 8px;border-radius:5px;font-size:.75rem;font-weight:700;border:1px solid rgba(39,174,96,0.3)}.floating-cart-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background-color:var(--primary-color);color:var(--light-text);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;box-shadow:0 4px 12px rgba(0,0,0,.25);cursor:pointer;z-index:1000;transition:transform .3s ease}.floating-cart-btn:hover{transform:scale(1.1)}#cart-count{position:absolute;top:-2px;right:-2px;background-color:var(--secondary-color);color:var(--light-text);border-radius:50%;padding:3px 8px;font-size:.8rem;font-weight:700;border:2px solid var(--light-text)}.modal{display:none;position:fixed;z-index:1001;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);align-items:center;justify-content:center;animation:fadeIn .4s ease}.modal-content{background-color:#fefefe;padding:30px;border-radius:var(--border-radius);width:90%;max-width:600px;animation:slideIn .4s ease;max-height:90vh;overflow-y:auto}.close{color:#aaa;float:right;font-size:28px;font-weight:700;cursor:pointer;transition:color .3s}.close:hover{color:#000}#cart-items{max-height:250px;overflow-y:auto;padding-right:10px;border-bottom:1px solid #eee;margin-bottom:15px}.cart-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0}.cart-item-details{flex-grow:1}.quantity-controls{display:flex;align-items:center;gap:8px;margin-top:5px}.quantity-btn{width:28px;height:28px;background:var(--light-gray);border:1px solid #ccc;border-radius:50%;cursor:pointer;font-weight:700}.quantity-display{font-weight:600;min-width:20px;text-align:center}.remove-item-btn{font-size:1.2rem;color:#c00;cursor:pointer;margin-left:15px}.cart-summary{margin-top:20px;font-size:1.1rem}.summary-line{display:flex;justify-content:space-between;padding:8px 0}.summary-line.total{font-weight:700;font-size:1.3rem;border-top:2px solid #333;margin-top:10px}.points-earned,.free-shipping-promo{background-color:#e0f2f1;color:var(--accent-color);padding:10px;border-radius:8px;text-align:center;margin-top:20px;font-weight:700}.customer-info-form input{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px}.discount-section{display:flex;gap:10px;margin-top:15px}.discount-section input{flex-grow:1;padding:10px;border:1px solid #ccc;border-radius:5px}.discount-section button{width:auto;padding:10px 15px;flex-shrink:0}#discount-status{font-size:.9rem;font-weight:600;margin-top:8px;min-height:18px;text-align:center}#consent-form{margin-top:20px;padding:15px;background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;font-size:.9rem}#consent-form label{display:flex;align-items:flex-start;gap:10px}#consent-form input[type=checkbox]{margin-top:3px}#consent-form a{color:var(--primary-color);font-weight:600}.checkout-btn{width:100%;margin-top:15px}.verification-step{margin-top:20px;padding:20px;background-color:var(--light-gray);border-radius:var(--border-radius);text-align:center;border:2px dashed #ddd}.verification-step.active{border-color:var(--primary-color);background-color:#eaf2f8}.verification-step.completed{border-color:var(--accent-color);background-color:#e8f8f5;opacity:.7}.verification-step h4{margin-top:0}.verification-step input[type=file],.verification-step input[type=text]{width:100%;padding:12px;margin:15px 0 10px;border:1px solid #ddd;border-radius:8px}#upload-status,#verification-status{margin-top:10px;font-weight:700;min-height:20px}footer{background:var(--primary-color);color:var(--light-text);padding:40px 20px;text-align:center;margin-top:30px}.disclaimer{margin-top:10px;background-color:#fff3cd;color:#856404;padding:15px;border-top:1px solid #ffeeba}
    .about-us-section{padding:40px;background-color:#fff;border-radius:var(--border-radius);box-shadow:var(--shadow)}.about-us-section .owner-profile{display:flex;align-items:center;gap:30px;flex-wrap:wrap}.about-us-section .owner-image{width:150px;height:150px;border-radius:50%;object-fit:cover;border:5px solid var(--primary-color)}.about-us-section .owner-details{flex:1;min-width:300px}.about-us-section ul {list-style: none; padding-left: 0;} .about-us-section ul li {margin-bottom: 10px;} .feedback-form select{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px} .feedback-form textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px;min-height:120px} #feedback-status{font-weight:bold;margin-top:15px;}
    .program-section{background:var(--light-text);padding:40px;border-radius:var(--border-radius);box-shadow:var(--shadow);margin-bottom:30px}.program-section h2{font-size:2.5rem;text-align:center}.program-section ul {list-style: none; padding-left: 0; margin-top: 30px;}.program-section ul li {background: #f9f9f9; border-left: 5px solid var(--accent-color); padding: 15px; margin-bottom: 10px; border-radius: 5px; text-align: left;}.program-section ul li strong {color: var(--primary-color); display: block; margin-bottom: 5px;}
    .cta-button{display:block;width:fit-content;margin:30px auto;background:linear-gradient(135deg,var(--secondary-color),#e67e22);color:var(--light-text);text-align:center;padding:15px 40px;border-radius:50px;font-weight:700;text-decoration:none;font-size:1.2rem;transition:all .3s;box-shadow:0 4px 8px rgba(0,0,0,.2)}.cta-button:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.3)}.rewards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}.reward-item{background:var(--light-gray);border:1px solid #ddd;border-radius:var(--border-radius);padding:20px;text-align:center;display:flex;flex-direction:column;position:relative}.reward-item img{max-width:100%;height:100px;object-fit:contain;margin-bottom:15px;border-radius:8px}.reward-item h4{margin:10px 0 5px}.reward-item .points-cost{font-weight:700;color:var(--accent-color);margin-bottom:15px}.coming-soon-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(255,255,255,.8);color:var(--primary-color);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;border-radius:var(--border-radius);backdrop-filter:blur(2px)}
    .original-cart-price{text-decoration:line-through;color:#999;font-size:.9rem;}.final-cart-price{font-weight:600}.summary-line small{font-size:.8rem;color:var(--accent-color);font-style:italic}
  </style>

  <!-- NEW: Festival Animations CSS -->
  <style id="festival-animations-style">
    #festival-animations-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; z-index: 0; }
    .festival-element { position: absolute; display: none; background-size: contain; background-repeat: no-repeat; will-change: transform, opacity; animation-timing-function: linear; animation-iteration-count: infinite;}
    body:not(.default-theme)::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; background-size: cover; animation: fadeIn 2s ease-in-out; }
    
    @keyframes fall { 0% { transform: translateY(-100%) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 95% { opacity: 1; } 100% { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
    @keyframes sway { 0% { transform: translateY(0) rotate(-8deg); } 50% { transform: translateY(-20px) rotate(8deg); } 100% { transform: translateY(0) rotate(-8deg); } }
    @keyframes twinkle { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.8; } }
    @keyframes firework-1 { 0%, 90%, 100% { opacity: 0; transform: scale(0.5) } 30% { opacity: 1; transform: scale(1.2); } }
    @keyframes firework-2 { 0%, 80%, 100% { opacity: 0; transform: scale(0.5) } 50% { opacity: 1; transform: scale(1); } }
    
    .theme-GrandOpening .confetti, .theme-GrandOpening .balloon { display: block; }
    .confetti { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10"><path d="M0 0h10v2H0z" fill="gold"/><path d="M0 4h10v2H0z" fill="tomato"/><path d="M0 8h10v2H0z" fill="dodgerblue"/></svg>'); animation-name: fall; }
    .balloon { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 125"><path fill="gold" d="M50 0C20 0 0 30 0 60c0 30 20 60 50 60s50-30 50-60C100 30 80 0 50 0z"/><path fill="%23d4af37" d="M50 110v10l-5 5h10l-5-5z"/></svg>'); animation-name: sway; animation-timing-function: ease-in-out; }
    .confetti-1 {width: 10px; height: 10px; left: 10%; animation-duration: 7s; animation-delay: 0s;} .confetti-2 {width: 15px; height: 15px; left: 30%; animation-duration: 5s; animation-delay: 2s;} .confetti-3 {width: 8px; height: 8px; left: 50%; animation-duration: 9s; animation-delay: 1s;} .confetti-4 {width: 12px; height: 12px; left: 70%; animation-duration: 6s; animation-delay: 4s;} .confetti-5 {width: 10px; height: 10px; left: 90%; animation-duration: 8s; animation-delay: 3s;}
    .balloon-1 { width: 80px; height: 100px; top: -120px; right: 5%; animation-duration: 15s; animation-delay: 1s; opacity: 0.7;}
    .balloon-2 { width: 100px; height: 125px; top: -140px; left: 10%; animation-duration: 20s; animation-delay: 4s; opacity: 0.8;}
    .theme-HariRaya .ketupat, .theme-HariRaya .pelita { display: block; animation-name: sway; animation-timing-function: ease-in-out; }
    .ketupat { background-image: url('https://svgshare.com/i/18bH.svg'); }
    .pelita { background-image: url('https://svgshare.com/i/18bL.svg'); filter: drop-shadow(0 0 10px #ffdd00); }
    .ketupat-1 { width: 100px; height: 100px; top: 5%; left: 10%; animation-duration: 12s; opacity: 0.8;}
    .pelita-1 { width: 70px; height: 70px; top: 40%; left: 85%; animation-duration: 10s; animation-delay: 1s; opacity: 0.9;}
    .ketupat-2 { width: 80px; height: 80px; top: 60%; left: 5%; animation-duration: 15s; animation-delay: 3s; opacity: 0.7;}
    .theme-Deepavali .diya, .theme-Deepavali .rangoli { display: block; }
    .diya { background-image: url('https://svgshare.com/i/18ae.svg'); animation-name: twinkle; }
    .rangoli { background-image: url('https://svgshare.com/i/18c5.svg'); animation-name: fadeIn; animation-duration: 8s; animation-timing-function: ease-in-out;}
    .diya-1 { width: 80px; height: 80px; bottom: 5%; left: 10%; animation-duration: 3s; } .diya-2 { width: 80px; height: 80px; bottom: 5%; right: 10%; animation-duration: 5s; animation-delay: 1s; }
    .rangoli-1 { width: 200px; height: 200px; top: 10%; right: 5%; opacity: 0.4; animation-delay: 1s;}
    .rangoli-2 { width: 150px; height: 150px; top: 60%; left: 5%; opacity: 0.3; animation-delay: 4s;}
    .theme-Christmas .snowflake, .theme-Christmas .giftbox { display: block; animation-name: fall; }
    .snowflake { background-image: url('https://svgshare.com/i/18ar.svg'); opacity: 0.7; }
    .giftbox { background-image: url('https://svgshare.com/i/18c6.svg'); }
    .snowflake-1 { width: 30px; height: 30px; left: 10%; animation-duration: 12s; } .snowflake-2 { width: 40px; height: 40px; left: 30%; animation-duration: 8s; animation-delay: 3s; } .snowflake-3 { width: 25px; height: 25px; left: 50%; animation-duration: 15s; animation-delay: 1s; } .snowflake-4 { width: 35px; height: 35px; left: 70%; animation-duration: 9s; animation-delay: 5s; } .snowflake-5 { width: 30px; height: 30px; left: 90%; animation-duration: 11s; animation-delay: 2s; }
    .giftbox-1 { width: 50px; height: 50px; left: 20%; animation-duration: 10s; animation-delay: 2s; }
    .giftbox-2 { width: 60px; height: 60px; left: 80%; animation-duration: 13s; animation-delay: 5s; }
    .theme-CNY .lantern, .theme-CNY .firework { display: block; }
    .lantern { background-image: url('https://svgshare.com/i/18bM.svg'); animation-name: sway; animation-timing-function: ease-in-out; filter: drop-shadow(0 0 15px #c0392b); }
    .firework { background-image: url('https://svgshare.com/i/18c7.svg'); }
    .lantern-1 { width: 150px; height: 150px; top: 5%; left: 15%; animation-duration: 8s; opacity: 0.9;}
    .lantern-2 { width: 120px; height: 120px; top: 10%; right: 10%; animation-duration: 10s; animation-delay: 2s; opacity: 0.8;}
    .firework-1 {width: 250px; height: 250px; top: 20%; left: 40%; animation-name: firework-1; animation-duration: 4s; animation-delay: 1s;}
    .firework-2 {width: 200px; height: 200px; top: 50%; right: 15%; animation-name: firework-2; animation-duration: 5s; animation-delay: 3s;}
    .theme-NationalDay .flag, .theme-MalaysiaDay .flag, .theme-NationalDay .firework-my, .theme-MalaysiaDay .firework-my { display: block; }
    .flag { background-image: url('https://svgshare.com/i/18aq.svg'); animation-name: sway; animation-duration: 10s; animation-timing-function: ease-in-out; }
    .firework-my { background-image: url('https://svgshare.com/i/18c7.svg'); }
    .flag-1 { width: 120px; height: 80px; top: 10%; left: 5%; animation-delay: 0s; opacity: 0.8; }
    .flag-2 { width: 150px; height: 100px; top: 30%; right: 5%; animation-delay: 2s; opacity: 0.9; }
    .firework-my-1 { width: 200px; height: 200px; top: 50%; left: 15%; animation-name: firework-2; animation-duration: 5s; animation-delay: 1s;}
    .firework-my-2 { width: 250px; height: 250px; top: 15%; right: 30%; animation-name: firework-1; animation-duration: 4s; animation-delay: 3s;}

  </style>
</head>
<body class="default-theme">

<!-- ALL STATIC HTML CONTENT IS UNCHANGED -->
<div id="festival-animations-container"></div>
<div id="store-wrapper">
  <header>
      <!-- ... Your header content ... -->
  </header>
  <div id="promo-running-banner">
      <div class="marquee-content" id="promo-banner-text"></div>
  </div>
  <nav>
      <!-- ... Your nav content ... -->
  </nav>
  <main id="main-content" class="container">
    <div id="products" class="tab-content active">
      <section class="hero-section" id="hero-section">
        <h2 id="hero-title"><i class="fa-solid fa-store"></i> Welcome to Our Store</h2>
        <p id="hero-subtitle">Enjoy high-quality wellness products for a healthier lifestyle.</p>
        <div id="countdown-timer" style="display:none;"></div>
      </section>
      <div class="search-container">
        <input type="text" id="product-search" onkeyup="filterProducts()" placeholder="Search for products by name...">
        <i class="fa-solid fa-search search-icon"></i>
      </div>
      <section class="ai-suggestion-box">
        <h3><i class="fa-solid fa-robot"></i> AI Product Suggester</h3>
        <p>Describe your health concern (e.g., "dry skin", "low energy") and our AI will suggest a product for you.</p>
        <input type="text" id="symptom-input" placeholder="Enter your symptom or concern...">
        <button id="suggest-btn" class="btn btn-primary" onclick="suggestProduct()">Get Suggestion</button>
        <div id="suggestion-result"></div>
      </section>
      <div id="product-list-container">
          <p style="text-align: center; width: 100%;">Loading products...</p>
      </div>
    </div>
    <div id="business" class="tab-content">
      <!-- ... Your business opportunity content ... -->
    </div>
    <div id="about" class="tab-content">
      <!-- ... Your about us content ... -->
    </div>
    <div id="rewards" class="tab-content">
      <!-- ... Your rewards content ... -->
    </div>
  </main>
  <footer class="footer">
      <!-- ... Your footer content ... -->
  </footer>
</div>
<div id="floating-cart" class="floating-cart-btn" onclick="toggleCart()">
  <i class="fa-solid fa-cart-shopping"></i>
  <span id="cart-count">0</span>
</div>
<div id="cart-modal" class="modal">
    <!-- ... Your entire modal content, unchanged ... -->
</div>
<!-- END OF STATIC HTML -->

<script>
    // =========================================================================
    // ===                 SECURE E-COMMERCE FRONTEND SCRIPT v1.1            ===
    // =========================================================================

    // --- CONFIGURATION ---
    // IMPORTANT: Make sure this is the correct URL from your Apps Script deployment
    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbyN0uaZdChWwJ5uEv4seo1wScU9oEjWtE1-KMFRXjYOy4M-tbVZz9vXDG_HKwAw5CLUSg/exec'; 
    
    // --- GLOBAL STATE (NOW FILLED BY BACKEND) ---
    let cart = [];
    let allProducts = []; // This will hold the master product list from the backend
    let activeFestival = null;
    let activePromotions = [];
    let shippingRules = {};
    let availableDiscountCodes = {};
    let appliedDiscount = null;

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', async function() {
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        
        try {
            const response = await fetch(googleScriptURL);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            
            if (data.status === 'success') {
                allProducts = data.products;
                activeFestival = data.activeFestival;
                activePromotions = data.activePromotions;
                shippingRules = data.shippingRules;
                availableDiscountCodes = data.discountCodes;
                
                initializeUI();
            } else {
                throw new Error(data.message || 'Failed to fetch initial data from server.');
            }
        } catch (error) {
            console.error("Error fetching dynamic data:", error);
            document.getElementById('product-list-container').innerHTML = `<p style="text-align:center; color:red;">Error loading store data. Please check your connection and try again later.</p>`;
        }
        
        if (sessionStorage.getItem('pendingOrder')) {
            toggleCart();
        } else {
            showTab('products');
        }
    });

    function initializeUI() {
        const body = document.body;
        body.className = 'default-theme';
        const festivalContainer = document.getElementById('festival-animations-container');
        
        if (activeFestival && activeFestival.theme) {
            body.classList.add(`theme-${activeFestival.theme}`);
            document.getElementById('hero-title').innerHTML = `<i class="fa-solid fa-gift"></i> ${activeFestival.name}`;
            document.getElementById('hero-subtitle').textContent = "Enjoy special festive offers!";
            const banner = document.getElementById('promo-running-banner');
            document.getElementById('promo-banner-text').textContent = `✨ ${activeFestival.name}! See special offers below! ✨`;
            banner.style.display = 'block';
            startCountdown(activeFestival.endDate);
            if(festivalContainer) festivalContainer.style.display = 'block';
        } else {
            document.getElementById('hero-title').innerHTML = `<i class="fa-solid fa-store"></i> Welcome to Our Store`;
            document.getElementById('hero-subtitle').textContent = "Enjoy high-quality wellness products for a healthier lifestyle.";
            if(festivalContainer) festivalContainer.style.display = 'none';
        }
        renderProducts();
    }

    // --- PRODUCT RENDERING ---
    function renderProducts() {
        const productListContainer = document.getElementById("product-list-container");
        if (!productListContainer) return;
        
        if (!allProducts || allProducts.length === 0) {
            productListContainer.innerHTML = "<p style='text-align:center;'>No products available at this time.</p>";
            return;
        }

        let html = `<section class="promo-section"><h2>All Products</h2><div class="product-list">`;
        allProducts.forEach(product => {
            html += renderSingleProduct(product);
        });
        html += `</div></section>`;
        
        productListContainer.innerHTML = html;
    }

    function renderSingleProduct(product) {
        let priceHTML = '';
        const isPromo = product.price < product.originalPrice;

        if (isPromo) {
            priceHTML = `<span class="original-price">RM ${product.originalPrice.toFixed(2)}</span>
                         <span class="new-price">RM ${product.price.toFixed(2)}</span>`;
        } else {
            priceHTML = `<span class="new-price">RM ${product.price.toFixed(2)}</span>`;
        }
        
        const safeProductString = JSON.stringify(product).replace(/'/g, "&apos;");

        return `
          <div class="product ${isPromo ? 'promo-highlight' : ''}">
            <div class="halal-badge">HALAL</div>
            ${isPromo ? '<div class="featured-badge">On Offer!</div>' : ''}
            <div class="product-image-container">
              <img src="${product.image || 'https://via.placeholder.com/200'}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/200x200?text=Image+Not+Found'">
            </div>
            <div class="product-info">
              <h3>${product.name}</h3>
              <div class="price-section">${priceHTML}</div>
              <div class="benefits"><strong>Benefits:</strong> ${product.benefits}</div>
              <div class="consumption"><strong>Usage:</strong> ${product.consumption}</div>
              <div class="product-actions">
                <button class="btn btn-primary" onclick='addToCart(${safeProductString})'>
                  <i class="fa-solid fa-cart-plus"></i> Add to Cart
                </button>
              </div>
            </div>
          </div>`;
    }

    // --- CART LOGIC ---
    function addToCart(product) {
        const existingItem = cart.find(item => item.id === product.id);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        updateCartDisplay();
    }

    function increaseQuantity(productId) { const item = cart.find(p => p.id === productId); if (item) { item.quantity++; updateCartDisplay(); } }
    function decreaseQuantity(productId) { const item = cart.find(p => p.id === productId); if (item) { item.quantity--; if (item.quantity <= 0) { removeItemFromCart(productId); } else { updateCartDisplay(); } } }
    function removeItemFromCart(productId) { cart = cart.filter(p => p.id !== productId); appliedDiscount = null; document.getElementById('discount-code-input').value = ""; document.getElementById('discount-status').textContent = ""; updateCartDisplay(); }
    function updateCartCount() { document.getElementById("cart-count").textContent = cart.reduce((total, item) => total + item.quantity, 0); }

    function applyDiscount() {
        const codeInput = document.getElementById("discount-code-input");
        const statusEl = document.getElementById("discount-status");
        const code = codeInput.value.trim().toUpperCase();
        if (!code) { statusEl.textContent = "Please enter a code."; statusEl.style.color = "orange"; return; }
        
        const discountData = availableDiscountCodes[code];
        if (discountData) {
            appliedDiscount = { code, ...discountData };
            statusEl.textContent = `Code "${code}" applied successfully!`;
            statusEl.style.color = "green";
        } else {
            appliedDiscount = null;
            statusEl.textContent = "Invalid or expired discount code.";
            statusEl.style.color = "red";
        }
        updateCartDisplay();
    }

    function calculateCartTotals() {
        let subtotal = 0;
        let originalSubtotal = 0;
        
        cart.forEach(item => {
            subtotal += item.price * item.quantity;
            originalSubtotal += item.originalPrice * item.quantity;
        });
        
        let discountValue = 0;
        if (appliedDiscount) {
            if (appliedDiscount.type === 'Percentage') {
                discountValue = subtotal * (parseFloat(appliedDiscount.value) / 100);
            } else { // Fixed
                discountValue = parseFloat(appliedDiscount.value);
            }
        }
        
        const subtotalAfterDiscount = subtotal - discountValue;
        const shippingFee = calculateShipping(subtotalAfterDiscount);
        const total = subtotalAfterDiscount + shippingFee;
        const totalPoints = Math.floor(subtotalAfterDiscount);
        
        return { subtotal, originalSubtotal, discountValue, shippingFee, total, totalPoints };
    }

    function calculateShipping(subtotal) {
        if (cart.length === 0) return 0;
        let fee = 0;
        let defaultFee = 14; 
        
        const rules = Object.values(shippingRules);
        const defaultRule = rules.find(r => r.isDefault);
        if (defaultRule) defaultFee = parseFloat(defaultRule.charge);
        
        fee = defaultFee;

        for (const rule of rules) {
            const minSpend = parseFloat(rule.minSpend);
            const maxSpend = parseFloat(rule.maxSpend);
            if (rule.type === 'Free shipping over X' && subtotal >= minSpend) { fee = 0; break; }
            if (rule.type === 'Tiered' && subtotal >= minSpend && subtotal <= maxSpend) { fee = parseFloat(rule.charge); break; }
        }
        return fee;
    }
    
    function updateCartDisplay() {
        const cartItemsEl = document.getElementById("cart-items");
        if (cart.length === 0) {
            cartItemsEl.innerHTML = "<p>Your cart is currently empty.</p>";
            document.getElementById("cart-subtotal").textContent = "RM 0.00";
            document.getElementById("cart-shipping").textContent = "RM 0.00";
            document.getElementById("cart-total").textContent = "RM 0.00";
            document.getElementById("discount-line").style.display = "none";
            document.getElementById("savings-line").style.display = "none";
            document.getElementById("points-earned-display").innerHTML = "";
            updateCartCount();
            return;
        }

        const { subtotal, originalSubtotal, discountValue, shippingFee, total, totalPoints } = calculateCartTotals();
        let itemsHTML = "";
        cart.forEach(item => {
            let priceDisplay = (item.price < item.originalPrice)
                ? `<span class="final-cart-price">RM ${item.price.toFixed(2)}</span><br><span class="original-cart-price">RM ${item.originalPrice.toFixed(2)}</span>`
                : `<span class="final-cart-price">RM ${item.price.toFixed(2)}</span>`;
            
            itemsHTML += `<div class="cart-item"><div class="cart-item-details"><strong>${item.name}</strong><div class="quantity-controls"><button class="quantity-btn" onclick="decreaseQuantity('${item.id}')">-</button><span class="quantity-display">${item.quantity}</span><button class="quantity-btn" onclick="increaseQuantity('${item.id}')">+</button></div></div><div style="text-align:right">${priceDisplay}</div></div>`;
        });
        
        cartItemsEl.innerHTML = itemsHTML;
        document.getElementById("cart-subtotal").textContent = `RM ${subtotal.toFixed(2)}`;
        document.getElementById("cart-shipping").textContent = shippingFee > 0 ? `RM ${shippingFee.toFixed(2)}` : 'FREE';
        document.getElementById("cart-total").textContent = `RM ${total.toFixed(2)}`;
        
        document.getElementById("discount-line").style.display = discountValue > 0 ? "flex" : "none";
        document.getElementById("cart-discount").textContent = `- RM ${discountValue.toFixed(2)}`;
        
        const totalSavings = (originalSubtotal - subtotal) + discountValue;
        document.getElementById("savings-line").style.display = totalSavings > 0 ? "flex" : "none";
        document.getElementById("cart-savings").textContent = `RM ${totalSavings.toFixed(2)}`;

        document.getElementById("points-earned-display").innerHTML = `<div class="points-earned"><i class="fa-solid fa-star"></i> Points to be Earned: ${totalPoints}</div>`;
        updateCartCount();
    }
    
    // --- CHECKOUT & VERIFICATION ---
    async function initiateCheckout() {
        if(!document.getElementById("consent-checkbox").checked) return alert("You must agree to the data collection consent before proceeding.");
        const customerInfo = {
            name: document.getElementById("customer-name").value.trim(), phone: document.getElementById("customer-phone").value.trim(),
            email: document.getElementById("customer-email").value.trim(), address1: document.getElementById("customer-address1").value.trim(),
            address2: document.getElementById("customer-address2").value.trim(), city: document.getElementById("customer-city").value.trim(),
            state: document.getElementById("customer-state").value.trim(), postcode: document.getElementById("customer-postcode").value.trim()
        };
        if(!customerInfo.name || !customerInfo.phone || !customerInfo.email || !customerInfo.address1 || !customerInfo.city || !customerInfo.state || !customerInfo.postcode) return alert("Please fill in all required customer and shipping information fields.");
        if(cart.length === 0) return alert("Your cart is empty.");

        // IMPORTANT: We send a simple cart to the backend (NO prices)
        const simplifiedCart = cart.map(item => ({ id: item.id.toString(), quantity: item.quantity }));
        const fullAddress = `${customerInfo.address1}, ${customerInfo.address2 ? customerInfo.address2 + ", " : ""}${customerInfo.postcode} ${customerInfo.city}, ${customerInfo.state}.`;
        const orderData = {
            customerName: customerInfo.name, customerPhone: customerInfo.phone, customerEmail: customerInfo.email, customerAddress: fullAddress,
            cart: simplifiedCart,
            discountCodeUsed: appliedDiscount ? appliedDiscount.code : "N/A"
        };
        
        sessionStorage.setItem("pendingOrder", JSON.stringify(orderData));
        
        const { total } = calculateCartTotals(); // Frontend total is for the WhatsApp message only. The backend calculates the REAL total.
        let message = `Hi, I would like to place an order for approx. RM ${total.toFixed(2)}.\n\n*Customer Details:*\nName: ${customerInfo.name}\nPhone: ${customerInfo.phone}\n\nPlease provide payment details. I will upload the proof on the website to finalize. Thank you!`;
        window.open(`https://wa.me/601111033154?text=${encodeURIComponent(message)}`, "_blank");
        
        document.getElementById("cart-view").style.display = "none";
        document.getElementById("verification-view").style.display = "block";
        updateVerificationUI();
    }

    async function uploadProof() {
        const proofFile = document.getElementById("payment-proof-upload").files[0];
        const uploadStatusEl = document.getElementById("upload-status");
        const uploadBtn = document.getElementById("upload-proof-btn");
        let pendingOrder = JSON.parse(sessionStorage.getItem("pendingOrder"));
        if (!proofFile || !pendingOrder) { uploadStatusEl.textContent = "Error: No pending order or file selected."; uploadStatusEl.style.color = "red"; return; }

        uploadBtn.disabled = true;
        uploadStatusEl.textContent = "Uploading...";
        
        try {
            const base64File = await getBase64(proofFile);
            const payload = {
                action: "logInitialOrderWithProof", ...pendingOrder,
                paymentProofFile: base64File.split(",")[1],
                paymentProofMimeType: proofFile.type,
                paymentProofFileName: `${pendingOrder.customerEmail.split("@")[0]}-${Date.now()}`
            };

            const response = await fetch(googleScriptURL, { method: "POST", body: JSON.stringify(payload) });
            const result = await response.json();
            if (result.status === 'success') {
                uploadStatusEl.textContent = "Proof uploaded successfully!";
                uploadStatusEl.style.color = "green";
                pendingOrder.proofUploaded = true;
                sessionStorage.setItem("pendingOrder", JSON.stringify(pendingOrder));
                updateVerificationUI();
            } else { throw new Error(result.message); }
        } catch (error) {
            uploadStatusEl.textContent = `Error: ${error.message}`;
            uploadStatusEl.style.color = "red";
            uploadBtn.disabled = false;
        }
    }

    async function finalizeOrder() {
        const codeInput = document.getElementById("verification-code").value.trim().toUpperCase();
        const finalizeBtn = document.getElementById("finalize-order-btn");
        const verificationStatusEl = document.getElementById("verification-status");
        let pendingOrder = JSON.parse(sessionStorage.getItem("pendingOrder"));
        if (!codeInput || !pendingOrder) { verificationStatusEl.textContent = "Error: No pending order or code provided."; verificationStatusEl.style.color = "red"; return; }

        finalizeBtn.disabled = true;
        verificationStatusEl.textContent = "Verifying...";
        
        try {
            const payload = { action: "finalizeOrder", usedCode: codeInput, ...pendingOrder };
            const response = await fetch(googleScriptURL, { method: "POST", body: JSON.stringify(payload) });
            const result = await response.json();

            if (result.status === 'success') {
                verificationStatusEl.textContent = "Order Verified! Your receipt is downloading...";
                const downloadLink = document.createElement("a");
                downloadLink.href = result.receiptUrl.replace("/file/d/", "/uc?export=download&id=").replace("/view?usp=drivesdk", "");
                downloadLink.download = `Receipt-${new Date().getTime()}.pdf`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                cart = [];
                sessionStorage.removeItem("pendingOrder");
                updateCartDisplay();
                setTimeout(() => { toggleCart(true); updateVerificationUI(true); }, 4000);
            } else { throw new Error(result.message); }
        } catch (error) {
            verificationStatusEl.textContent = `Error: ${error.message}`;
            finalizeBtn.disabled = false;
        }
    }

    // --- HELPER & UI FUNCTIONS ---
    function updateVerificationUI(reset = false){const proofStepEl=document.getElementById("proof-upload-step"),codeStepEl=document.getElementById("code-verification-step"),uploadBtn=document.getElementById("upload-proof-btn"),finalizeBtn=document.getElementById("finalize-order-btn"),codeInput=document.getElementById("verification-code"),uploadStatusEl=document.getElementById("upload-status"),verificationStatusEl=document.getElementById("verification-status");if(reset)return proofStepEl.classList.add("active"),proofStepEl.classList.remove("completed"),codeStepEl.classList.remove("active"),uploadBtn.disabled=!1,finalizeBtn.disabled=!0,codeInput.disabled=!0,uploadStatusEl.textContent="",verificationStatusEl.textContent="",document.getElementById("payment-proof-upload").value="",void(codeInput.value="");const pendingOrder=JSON.parse(sessionStorage.getItem("pendingOrder"));pendingOrder&& (pendingOrder.proofUploaded?(proofStepEl.classList.remove("active"),proofStepEl.classList.add("completed"),codeStepEl.classList.add("active"),uploadBtn.disabled=!0,finalizeBtn.disabled=!1,codeInput.disabled=!1,uploadStatusEl.textContent="Proof Uploaded Successfully!",uploadStatusEl.style.color="green"):(proofStepEl.classList.add("active"),proofStepEl.classList.remove("completed"),codeStepEl.classList.remove("active"),uploadBtn.disabled=!1,finalizeBtn.disabled=!0,codeInput.disabled=!0))}
    function cancelVerification(){if(confirm("Are you sure you want to cancel? This will remove your pending order and you will have to start over.")){sessionStorage.removeItem("pendingOrder");toggleCart(true);updateVerificationUI(true)}}
    function toggleCart(forceClose = false){const modal=document.getElementById("cart-modal");if(forceClose)return void(modal.style.display="none");if("flex"===modal.style.display)modal.style.display="none";else{modal.style.display="flex";const pendingOrder=JSON.parse(sessionStorage.getItem("pendingOrder"));pendingOrder?(document.getElementById("cart-view").style.display="none",document.getElementById("verification-view").style.display="block",updateVerificationUI()):(document.getElementById("cart-view").style.display="block",document.getElementById("verification-view").style.display="none",updateCartDisplay(),updateVerificationUI(true))}}
    function getBase64(file){return new Promise((resolve,reject)=>{const reader=new FileReader;reader.readAsDataURL(file);reader.onload=()=>resolve(reader.result);reader.onerror=error=>reject(error)})}
    function filterProducts(){const query=document.getElementById("product-search").value.toLowerCase();document.querySelectorAll(".product").forEach(productCard=>{const productName=productCard.querySelector("h3").textContent.toLowerCase();if(productName.includes(query)){productCard.style.display="flex"}else{productCard.style.display="none"}})}
    function suggestProduct(){const symptom=document.getElementById("symptom-input").value.toLowerCase().trim();const resultContainer=document.getElementById("suggestion-result");if(!symptom)return void(resultContainer.innerHTML='<p style="color:red">Please enter a symptom or health concern.</p>');const suggestionMap={'digestion':{keywords:['digestion','stomach'],ids:['aloe-vera-gel','aloe-berry-nectar','aloe-bits-n-peaches','fiber']},'immune':{keywords:['immune','sick','flu','cold'],ids:['aloe-vera-gel','bee-propolis','absorbent-c']},'energy':{keywords:['energy','tired','fatigue'],ids:['bee-pollen','royal-jelly','supergreens']},'weight':{keywords:['weight','diet','slim'],ids:['lite-vanilla','lite-choco','c9-lite-vanilla','c9-lite-choco']},'skin':{keywords:['skin','dry','acne','aging'],ids:['aloe-propolis-creme','aloe-vera-gelly','r3-factor-skin-defense']},'joint':{keywords:['joint','muscle','pain'],ids:['aloe-msm-gel','omega-3-plus','aloe-massage-lotion']}};const suggestedIds=new Set;const inputWords=symptom.split(" ");inputWords.forEach(word=>{for(const key in suggestionMap){if(suggestionMap[key].keywords.includes(word)){suggestionMap[key].ids.forEach(id=>suggestedIds.add(id))}}});if(suggestedIds.size>0){let html="<h4>Based on your concern, we suggest:</h4>";[...suggestedIds].slice(0,3).forEach(id=>{const product=allProducts.find(p=>p.id==id);if(product){const safeProductString=JSON.stringify(product).replace(/'/g,"&apos;");html+=`<div class="suggestion-product"><span><strong>${product.name}</strong> - ${product.benefits.split(",")[0]}</span><button class="btn btn-primary" style="width:auto;padding:8px 15px" onclick='addToCart(${safeProductString});toggleCart()'>Add</button></div>`}});resultContainer.innerHTML=html}else{resultContainer.innerHTML="<p>We could not find a specific match. Try searching for products directly.</p>"}}
    function startCountdown(endDateString){const countdownEl=document.getElementById("countdown-timer");if(!countdownEl||!endDateString)return;countdownEl.style.display="inline-block";const promoEndDate=(new Date(endDateString)).getTime();const interval=setInterval(()=>{const now=(new Date).getTime();const distance=promoEndDate-now;if(distance<0){clearInterval(interval);countdownEl.innerHTML="PROMOTION ENDED";return}const days=Math.floor(distance/864e5);const hours=Math.floor((distance%864e5)/36e5);const minutes=Math.floor((distance%36e5)/6e4);const seconds=Math.floor((distance%6e4)/1e3);countdownEl.innerHTML=`${days}d ${hours}h ${minutes}m ${seconds}s`},1000)}
    function showTab(tabId){document.querySelectorAll(".tab-content").forEach(el=>el.classList.remove("active"));const activeTab=document.getElementById(tabId);if(activeTab)activeTab.classList.add("active")}
    function toggleCheckoutButton(){document.getElementById("checkout-btn").disabled=!document.getElementById("consent-checkbox").checked}
    function sendFeedbackEmail(event){event.preventDefault();/* ... Your existing function ... */}

</script>
</body>
</html>
