<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forever Living by Muhd Arvind Isa</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root{--primary-color:#1a5276;--secondary-color:#f39c12;--accent-color:#27ae60;--light-gray:#f4f6f8;--dark-text:#333;--light-text:#fff;--border-radius:12px;--shadow:0 4px 15px rgba(0,0,0,.08);--font-family:'Poppins',sans-serif}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}@keyframes promoGlow{0%{box-shadow:0 0 5px rgba(243,156,18,.6)}50%{box-shadow:0 0 20px rgba(243,156,18,.9)}100%{box-shadow:0 0 5px rgba(243,156,18,.6)}}@keyframes marquee{0%{transform:translateX(0%)}100%{transform:translateX(-100%)}}
    *,::after,::before{box-sizing:border-box}
    body{font-family:var(--font-family);margin:0;padding:0;background-color:var(--light-gray);color:var(--dark-text);overflow-x:hidden;line-height:1.6;padding-top:45px; position: relative;}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}h1,h2,h3,h4{color:var(--primary-color);font-weight:600}
    .default-theme .hero-section{background:linear-gradient(135deg, #2c3e50, #4ca1af);color:var(--light-text);padding:80px 20px;text-align:center;border-radius:var(--border-radius);margin-bottom:30px;transition:all .5s ease;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .theme-HariRaya{background-color:#f0fff0}.theme-HariRaya .hero-section{background:linear-gradient(135deg, #006400, #daa520); border:4px dashed #FFD700;}.theme-HariRaya #promo-running-banner{background-color:#006400;color:#FFD700}
    .theme-Deepavali{background-color:#fff8e1}.theme-Deepavali .hero-section{background:linear-gradient(135deg, #ff6b6b, #feca57); border:4px dashed #ff9f43;}.theme-Deepavali #promo-running-banner{background-color:#e74c3c;color:#fff}
    .theme-Christmas{background-color:#f8f9fa}.theme-Christmas .hero-section{background:linear-gradient(135deg, #d32f2f, #388e3c); border:4px dashed #ffffff;}.theme-Christmas #promo-running-banner{background-color:#c62828;color:#fff}
    .theme-CNY{background-color:#fffbf0}.theme-CNY .hero-section{background:linear-gradient(135deg, #c0392b, #f1c40f); border:4px dashed #f1c40f;}.theme-CNY #promo-running-banner{background-color:#c0392b;color:#f1c40f}
    .theme-NationalDay .hero-section, .theme-MalaysiaDay .hero-section {background:linear-gradient(135deg, #000066, #cc0000); border:4px dashed #f1c40f;}
    .theme-Thaipusam .hero-section {background:linear-gradient(135deg, #ff9933, #ffffff); border:4px dashed #3366cc;}
    .theme-MooncakeFestival .hero-section {background:linear-gradient(135deg, #1a1a2e, #ff4e50); border:4px dashed #f9d423;}
    header{background-color:var(--light-text);padding:20px 0;text-align:center;border-bottom:1px solid #e0e0e0;position:relative}.header-content{display:flex;align-items:center;justify-content:center;gap:20px}.header-logo{width:80px;height:80px}.header-content h1{margin:0}.header-content h1 span{display:block}#promo-running-banner{color:var(--light-text);padding:10px 0;text-align:center;font-weight:700;font-size:1.1rem;position:fixed;top:0;left:0;width:100%;box-shadow:0 2px 5px rgba(0,0,0,.1);z-index:101;overflow:hidden;white-space:nowrap;display:none}#promo-running-banner .marquee-content{display:inline-block;padding-left:100%;animation:marquee 20s linear infinite}nav{background-color:var(--primary-color);position:sticky;top:45px;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.1)}nav ul{display:flex;list-style:none;padding:10px 0;margin:0;justify-content:center;flex-wrap:wrap}nav a{color:var(--light-text);text-decoration:none;font-weight:600;padding:10px 20px;display:inline-block;position:relative;transition:color .3s;cursor:pointer}nav a::after{content:'';position:absolute;bottom:5px;left:50%;transform:translateX(-50%);width:0;height:2px;background-color:var(--secondary-color);transition:width .3s}nav a:hover{color:#f1c40f}nav a:hover::after{width:60%}
    nav a.nav-disabled{color:#a9a9a9;pointer-events:none;cursor:not-allowed}nav a.nav-disabled:hover{color:#a9a9a9}nav a.nav-disabled::after{width:0!important}
    .tab-content{display:none;padding:20px 0}.tab-content.active{display:block;animation:fadeIn .5s}.hero-section h2{color:var(--light-text)}.ai-suggestion-box,.search-container{margin-bottom:30px;position:relative}
    #product-search{width:100%;padding:15px 50px 15px 25px;border:2px solid #ddd;border-radius:50px;font-size:1rem;outline:none;transition:all .3s}#product-search:focus{border-color:var(--primary-color);box-shadow:0 0 10px rgba(26,82,118,.2)}.search-icon{position:absolute;right:25px;top:50%;transform:translateY(-50%);color:var(--primary-color);font-size:1.2rem}
    .ai-suggestion-box{background:var(--light-text);padding:30px;border-radius:var(--border-radius);box-shadow:var(--shadow);text-align:center}#symptom-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;margin:10px 0}#suggest-btn{background:linear-gradient(135deg,var(--primary-color),var(--accent-color));color:var(--light-text);border:none;padding:12px 30px;border-radius:50px;cursor:pointer;font-weight:700;transition:all .3s;margin-top:10px}#suggest-btn:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.2)}#suggestion-result{margin-top:20px;text-align:left}.suggestion-product{background:#f8f9fa;padding:15px;border-radius:8px;margin:10px 0;display:flex;justify-content:space-between;align-items:center;border-left:4px solid var(--accent-color)}
    .promo-section h2 {font-size: 2rem; border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 25px; margin-top: 40px;}
    .product-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:30px}.product{background:var(--light-text);border-radius:var(--border-radius);box-shadow:var(--shadow);display:flex;flex-direction:column;position:relative;transition:all .3s ease;overflow:hidden}.product:hover{transform:translateY(-8px);box-shadow:0 10px 25px rgba(0,0,0,.12)}.product.promo-highlight{animation:promoGlow 2.5s infinite ease-in-out}.product-image-container{height:220px;padding:15px;display:flex;align-items:center;justify-content:center}.product img{max-width:100%;max-height:100%;object-fit:contain}.product-info{padding:20px;flex-grow:1;display:flex;flex-direction:column;text-align:left;position:relative}.product h3{margin:0 0 10px;font-size:1.25rem;height:3.75rem;overflow:hidden}.product .benefits{font-size:.85rem;color:#555;margin:10px 0;flex-grow:1}.product .consumption{font-size:.85rem;color:var(--primary-color);font-style:italic;margin:10px 0}.price-section{margin:15px 0;text-align:center}.original-price{text-decoration:line-through;color:#999;font-size:1rem;margin-right:10px}.new-price{color:var(--secondary-color);font-weight:700;font-size:1.5rem}.product-points{font-size:.9rem;font-weight:600;color:var(--accent-color);text-align:center;margin-top:10px}.product-actions{margin-top:auto;display:flex;flex-direction:column;gap:10px}.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 15px;border-radius:50px;text-decoration:none;font-weight:700;border:none;cursor:pointer;transition:all .3s}.btn:disabled{background-color:#ccc;cursor:not-allowed}.btn-primary{background:var(--primary-color);color:var(--light-text)}.btn-primary:hover{background:#123e5a;transform:scale(1.05)}.btn-secondary{background:var(--light-gray);color:var(--primary-color);border:1px solid var(--primary-color)}.btn-secondary:hover{background:#e0e0e0}.featured-badge{position:absolute;top:0;right:0;background:var(--secondary-color);color:#fff;padding:5px 25px;transform:rotate(45deg) translate(25%,-65%);transform-origin:0 0;font-weight:700;font-size:.9rem;box-shadow:0 3px 10px rgba(0,0,0,.2);z-index:10;white-space:nowrap}.halal-badge{position:absolute;top:10px;left:10px;background-color:rgba(255,255,255,0.8);color:var(--accent-color);padding:3px 8px;border-radius:5px;font-size:.75rem;font-weight:700;border:1px solid rgba(39,174,96,0.3)}.floating-cart-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background-color:var(--primary-color);color:var(--light-text);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;box-shadow:0 4px 12px rgba(0,0,0,.25);cursor:pointer;z-index:1000;transition:transform .3s ease}.floating-cart-btn:hover{transform:scale(1.1)}#cart-count{position:absolute;top:-2px;right:-2px;background-color:var(--secondary-color);color:var(--light-text);border-radius:50%;padding:3px 8px;font-size:.8rem;font-weight:700;border:2px solid var(--light-text)}.modal{display:none;position:fixed;z-index:1001;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);align-items:center;justify-content:center;animation:fadeIn .4s ease}.modal-content{background-color:#fefefe;padding:30px;border-radius:var(--border-radius);width:90%;max-width:600px;animation:slideIn .4s ease;max-height:90vh;overflow-y:auto}.close{color:#aaa;float:right;font-size:28px;font-weight:700;cursor:pointer;transition:color .3s}.close:hover{color:#000}#cart-items{max-height:250px;overflow-y:auto;padding-right:10px;border-bottom:1px solid #eee;margin-bottom:15px}.cart-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0}.cart-item-details{flex-grow:1}.quantity-controls{display:flex;align-items:center;gap:8px;margin-top:5px}.quantity-btn{width:28px;height:28px;background:var(--light-gray);border:1px solid #ccc;border-radius:50%;cursor:pointer;font-weight:700}.quantity-display{font-weight:600;min-width:20px;text-align:center}.remove-item-btn{font-size:1.2rem;color:#c00;cursor:pointer;margin-left:15px}.cart-summary{margin-top:20px;font-size:1.1rem}.summary-line{display:flex;justify-content:space-between;padding:8px 0}.summary-line.total{font-weight:700;font-size:1.3rem;border-top:2px solid #333;margin-top:10px}.points-earned,.free-shipping-promo{background-color:#e0f2f1;color:var(--accent-color);padding:10px;border-radius:8px;text-align:center;margin-top:20px;font-weight:700}.customer-info-form input{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px}.discount-section{display:flex;gap:10px;margin-top:15px}.discount-section input{flex-grow:1;padding:10px;border:1px solid #ccc;border-radius:5px}.discount-section button{width:auto;padding:10px 15px;flex-shrink:0}#discount-status{font-size:.9rem;font-weight:600;margin-top:8px;min-height:18px;text-align:center}#consent-form{margin-top:20px;padding:15px;background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;font-size:.9rem}#consent-form label{display:flex;align-items:flex-start;gap:10px}#consent-form input[type=checkbox]{margin-top:3px}#consent-form a{color:var(--primary-color);font-weight:600}.checkout-btn{width:100%;margin-top:15px}.verification-step{margin-top:20px;padding:20px;background-color:var(--light-gray);border-radius:var(--border-radius);text-align:center;border:2px dashed #ddd}.verification-step.active{border-color:var(--primary-color);background-color:#eaf2f8}.verification-step.completed{border-color:var(--accent-color);background-color:#e8f8f5;opacity:.7}.verification-step h4{margin-top:0}.verification-step input[type=file],.verification-step input[type=text]{width:100%;padding:12px;margin:15px 0 10px;border:1px solid #ddd;border-radius:8px}#upload-status,#verification-status{margin-top:10px;font-weight:700;min-height:20px}footer{background:var(--primary-color);color:var(--light-text);padding:40px 20px;text-align:center;margin-top:30px}.disclaimer{margin-top:10px;background-color:#fff3cd;color:#856404;padding:15px;border-top:1px solid #ffeeba}
    .about-us-section{padding:40px;background-color:#fff;border-radius:var(--border-radius);box-shadow:var(--shadow)}.about-us-section .owner-profile{display:flex;align-items:center;gap:30px;flex-wrap:wrap}.about-us-section .owner-image{width:150px;height:150px;border-radius:50%;object-fit:cover;border:5px solid var(--primary-color)}.about-us-section .owner-details{flex:1;min-width:300px}.about-us-section ul {list-style: none; padding-left: 0;} .about-us-section ul li {margin-bottom: 10px;} .feedback-form select{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px} .feedback-form textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px;min-height:120px} #feedback-status{font-weight:bold;margin-top:15px;}
    .program-section{background:var(--light-text);padding:40px;border-radius:var(--border-radius);box-shadow:var(--shadow);margin-bottom:30px}.program-section h2{font-size:2.5rem;text-align:center}.program-section ul {list-style: none; padding-left: 0; margin-top: 30px;}.program-section ul li {background: #f9f9f9; border-left: 5px solid var(--accent-color); padding: 15px; margin-bottom: 10px; border-radius: 5px; text-align: left;}.program-section ul li strong {color: var(--primary-color); display: block; margin-bottom: 5px;}
    .cta-button{display:block;width:fit-content;margin:30px auto;background:linear-gradient(135deg,var(--secondary-color),#e67e22);color:var(--light-text);text-align:center;padding:15px 40px;border-radius:50px;font-weight:700;text-decoration:none;font-size:1.2rem;transition:all .3s;box-shadow:0 4px 8px rgba(0,0,0,.2)}.cta-button:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.3)}.rewards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}.reward-item{background:var(--light-gray);border:1px solid #ddd;border-radius:var(--border-radius);padding:20px;text-align:center;display:flex;flex-direction:column;position:relative}.reward-item img{max-width:100%;height:100px;object-fit:contain;margin-bottom:15px;border-radius:8px}.reward-item h4{margin:10px 0 5px}.reward-item .points-cost{font-weight:700;color:var(--accent-color);margin-bottom:15px}.coming-soon-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(255,255,255,.8);color:var(--primary-color);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;border-radius:var(--border-radius);backdrop-filter:blur(2px)}
    .original-cart-price{text-decoration:line-through;color:#999;font-size:.9rem;margin-left:10px}.final-cart-price{font-weight:600}.summary-line small{font-size:.8rem;color:var(--accent-color);font-style:italic}
  </style>

  <!-- NEW: Festival Animations CSS -->
  <style id="festival-animations-style">
    #festival-animations-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; z-index: 0; }
    .festival-element { position: absolute; display: none; background-size: contain; background-repeat: no-repeat; will-change: transform, opacity; }
    body:not(.default-theme)::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; background-size: cover; animation: fadeIn 2s ease-in-out; }
    
    @keyframes drift { 0% { transform: translateY(0px) translateX(0px) rotate(0deg); opacity: 0; } 10% { opacity: 0.7; } 90% { opacity: 0.7; } 100% { transform: translateY(20px) translateX(10px) rotate(5deg); opacity: 0; } }
    .theme-HariRaya .ketupat, .theme-HariRaya .pelita { display: block; animation: drift 15s ease-in-out infinite alternate; }
    .ketupat { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%2327ae60" d="M50 0L100 50L50 100L0 50Z"/><path stroke="%23f1c40f" fill="none" stroke-width="2" d="M0 50L25 25L50 50L25 75Z M100 50L75 25L50 50L75 75Z"/></svg>'); }
    .pelita { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23daa520" d="M40 70h20v10H40z M30 80h40v10H30z"/><path d="M50 40 Q 55 20 50 10 Q 45 20 50 40" fill="%23f1c40f"/></svg>'); }
    .ketupat-1 { width: 80px; height: 80px; top: 10%; left: 5%; animation-duration: 20s; }
    .pelita-1 { width: 50px; height: 50px; top: 20%; right: 10%; animation-duration: 18s; animation-delay: 2s; }
    .ketupat-2 { width: 120px; height: 120px; top: 70%; left: 15%; animation-duration: 25s; animation-delay: 5s; }
    .pelita-2 { width: 60px; height: 60px; bottom: 10%; right: 5%; animation-duration: 16s; animation-delay: 8s; }

    @keyframes glow { 0%, 100% { filter: brightness(1) drop-shadow(0 0 2px gold); } 50% { filter: brightness(1.8) drop-shadow(0 0 10px gold); } }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .theme-Deepavali::before { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><defs><pattern id="p" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="%23ff9f43"/></pattern></defs><rect width="100%" height="100%" fill="url(%23p)"/></svg>');}
    .theme-Deepavali .diya, .theme-Deepavali .rangoli { display: block; }
    .diya { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23ff9f43" d="M20 70 C 40 90, 60 90, 80 70 L 70 80 L 30 80 Z"/> <path d="M50 40 Q 55 20 50 10 Q 45 20 50 40" fill="%23f1c40f"/></svg>'); animation: glow 5s ease-in-out infinite; }
    .rangoli { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="%23ff6b6b" stroke-width="4" fill="none"/><circle cx="50" cy="50" r="20" fill="%23feca57"/></svg>'); animation: spin 40s linear infinite; }
    .diya-1 { width: 60px; height: 60px; top: 15%; left: 80%; animation-delay: 1s; }
    .rangoli-1 { width: 150px; height: 150px; top: 70%; left: 5%; animation-duration: 50s; opacity: 0.5; }
    .diya-2 { width: 80px; height: 80px; bottom: 15%; right: 85%; animation-delay: 3s; }

    @keyframes fall { 0% { transform: translateY(-100px) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
    @keyframes fly-santa { 0% { left: -20%; transform: translateY(0); } 50% {transform: translateY(-20px);} 100% { left: 120%; transform: translateY(0); } }
    .theme-Christmas .snowflake, .theme-Christmas .santa { display: block; }
    .snowflake { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" opacity="0.6" d="M22.1 9.9L20 9l2.1-.9c.5-.2.9-.8.7-1.3L21.2 4c-.2-.5-.8-.9-1.3-.7L18 4l.9-2.1c.2-.5-.1-1.1-.7-1.3L14.8.1c-.5-.2-1.1.1-1.3.7L12.6 3 11.7.9c-.2-.5-.8-.9-1.3-.7L7 .7c-.5.2-.9.8-.7 1.3L7.2 4 5.1 4.9c-.5.2-.9.8-.7 1.3L6 9.6c.2.5.8.9 1.3.7L9.4 10l-.9 2.1c-.2.5.1 1.1.7 1.3l3.4 1.5c.5.2 1.1-.1 1.3-.7l.9-2.1 2.1.9c.5.2 1.1-.1 1.3-.7l1.5-3.4c.3-.5-.1-1.1-.6-1.3zM12 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>'); animation: fall 10s linear infinite; }
    .santa { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="%23d32f2f" d="M560 224c0-17.7-14.3-32-32-32h-16.7l-33-66c-4-8-12.2-13-21.2-13H448V32c0-17.7-14.3-32-32-32H160c-17.7 0-32 14.3-32 32v81H128c-9 0-17.2 5-21.2 13l-33 66H56c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32h16v64H32c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32h448c17.7 0 32-14.3 32-32v-32c0-17.7-14.3-32-32-32h-16v-64h16c17.7 0 32-14.3 32-32v-32z"/></svg>'); animation: fly-santa 20s linear infinite; top: 5%; width: 100px; height: 100px; animation-delay: 5s; opacity: 0.8;}
    .snowflake-1 { width: 20px; height: 20px; left: 10%; animation-duration: 12s; animation-delay: 0s; } .snowflake-2 { width: 30px; height: 30px; left: 30%; animation-duration: 8s; animation-delay: 3s; } .snowflake-3 { width: 15px; height: 15px; left: 50%; animation-duration: 15s; animation-delay: 1s; } .snowflake-4 { width: 25px; height: 25px; left: 70%; animation-duration: 9s; animation-delay: 5s; } .snowflake-5 { width: 20px; height: 20px; left: 90%; animation-duration: 11s; animation-delay: 2s; }

    @keyframes sway { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
    .theme-CNY .lantern, .theme-CNY .coin { display: block; }
    .lantern { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23c0392b" d="M30 20 C 10 30, 10 70, 30 80 H 70 C 90 70, 90 30, 70 20 Z" opacity="0.8"/><path fill="%23f1c40f" d="M35 80 H 65 V 90 H 35 Z M 45 90 H 55 V 100 H 45 Z" opacity="0.8"/></svg>'); animation: sway 8s ease-in-out infinite; }
    .coin { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23f1c40f" opacity="0.4"/><rect x="40" y="40" width="20" height="20" fill="%23fffbf0"/></svg>'); animation: fall 12s linear infinite; }
    .lantern-1 { width: 80px; height: 80px; top: 5%; left: 15%; animation-duration: 7s; }
    .lantern-2 { width: 100px; height: 100px; top: 10%; right: 10%; animation-duration: 9s; animation-delay: 2s; }
    .coin-1 { width: 25px; height: 25px; left: 25%; animation-duration: 10s; animation-delay: 1s; } .coin-2 { width: 30px; height: 30px; left: 55%; animation-duration: 15s; animation-delay: 4s; } .coin-3 { width: 20px; height: 20px; left: 85%; animation-duration: 9s; animation-delay: 6s; }
    
    .theme-NationalDay::before, .theme-MalaysiaDay::before { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23cc0000" d="M0 0h100v100H0z"/><path fill="white" d="M0 10h100v10H0zm0 20h100v10H0zm0 20h100v10H0zm0 20h100v10H0z"/><path fill="%23000066" d="M0 0h50v50H0z"/><circle cx="20" cy="25" r="10" fill="%23f1c40f"/><path fill="%23f1c40f" d="M25 12l2 6h6l-5 4 2 6-5-4-5 4 2-6-5-4h6z"/></svg>'); opacity: 0.1; }
    .theme-MooncakeFestival::before { background-color: #1a1a2e; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="80" cy="20" r="2" fill="white"/><circle cx="20" cy="30" r="1" fill="white"/><circle cx="50" cy="50" r="1.5" fill="white"/><circle cx="90" cy="70" r="1" fill="white"/></svg>'); }
    .theme-Thaipusam::before { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,10 C90,30 90,70 50,90 C10,70 10,30 50,10" fill="%233366cc" opacity="0.1"/><path d="M50,20 C80,40 80,60 50,80 C20,60 20,40 50,20" fill="%23ff9933" opacity="0.1"/><circle cx="50" cy="50" r="10" fill="%23ffffff" opacity="0.2"/></svg>'); }
  </style>
</head>
<body class="default-theme">

<!-- This is the container for the festive animations -->
<div id="festival-animations-container">
    <!-- Hari Raya -->
    <div class="festival-element ketupat ketupat-1"></div><div class="festival-element pelita pelita-1"></div>
    <div class="festival-element ketupat ketupat-2"></div><div class="festival-element pelita pelita-2"></div>
    <!-- Deepavali -->
    <div class="festival-element diya diya-1"></div><div class="festival-element rangoli rangoli-1"></div>
    <div class="festival-element diya diya-2"></div>
    <!-- Christmas -->
    <div class="festival-element santa"></div><div class="festival-element snowflake snowflake-1"></div>
    <div class="festival-element snowflake snowflake-2"></div><div class="festival-element snowflake snowflake-3"></div>
    <div class="festival-element snowflake snowflake-4"></div><div class="festival-element snowflake snowflake-5"></div>
    <!-- CNY -->
    <div class="festival-element lantern lantern-1"></div><div class="festival-element lantern lantern-2"></div>
    <div class="festival-element coin coin-1"></div><div class="festival-element coin coin-2"></div><div class="festival-element coin coin-3"></div>
</div>

<div id="store-wrapper">
  <header>
    <div class="container">
        <div class="header-content">
            <img src="FL.jpg" alt="Business Logo" class="header-logo" onerror="this.style.display='none'">
            <h1>
              FOREVER LIVING by Muhd Arvind Isa
              <span style="font-size: 1rem; color: #555; display: block; font-weight: 400;">Quality Wellness Products</span>
            </h1>
        </div>
    </div>
  </header>
  
  <div id="promo-running-banner">
      <div class="marquee-content" id="promo-banner-text"></div>
  </div>

  <nav>
    <div class="container">
        <ul id="main-nav">
          <li><a onclick="showTab('products')">Products</a></li>
          <li><a onclick="showTab('business')">Business Opportunity</a></li>
          <li><a onclick="showTab('about')">About Us</a></li>
          <li><a class="nav-disabled">Rewards</a></li>
          <li><a class="nav-disabled">My Forever Living</a></li>
        </ul>
    </div>
  </nav>

  <main id="main-content" class="container">
    <div id="products" class="tab-content active">
      <section class="hero-section" id="hero-section">
        <h2 id="hero-title"><i class="fa-solid fa-store"></i> Welcome to Our Store</h2>
        <p id="hero-subtitle">Enjoy high-quality wellness products for a healthier lifestyle.</p>
        <div id="countdown-timer" style="display:none;"></div>
      </section>

      <div class="search-container">
        <input type="text" id="product-search" onkeyup="filterProducts()" placeholder="Search for products by name...">
        <i class="fa-solid fa-search search-icon"></i>
      </div>

      <section class="ai-suggestion-box">
        <h3><i class="fa-solid fa-robot"></i> AI Product Suggester</h3>
        <p>Describe your health concern (e.g., "dry skin", "low energy") and our AI will suggest a product for you.</p>
        <input type="text" id="symptom-input" placeholder="Enter your symptom or concern...">
        <button id="suggest-btn" class="btn btn-primary" onclick="suggestProduct()">Get Suggestion</button>
        <div id="suggestion-result"></div>
      </section>

      <div id="product-list-container">
          <p style="text-align: center; width: 100%;">Loading products...</p>
      </div>
    </div>

    <div id="business" class="tab-content">
      <section class="program-section">
        <h2>Build Your Forever Business</h2>
        <p style="text-align: center; max-width: 800px; margin: 20px auto;">The Forever Living opportunity is more than just selling high-quality products; it's a chance to build a flexible, rewarding business on your own terms. Whether you're looking for extra income or a full-time career, Forever provides a proven path to success.</p>
        <h3 style="margin-top:40px;">How Does It Work?</h3>
        <ul>
            <li><strong>Become Your Own Boss:</strong> As a Forever Business Owner (FBO), you have the freedom to work from anywhere, set your own hours, and grow at your own pace. There are no large startup fees or required inventory purchases.</li>
            <li><strong>A Simple, Proven Model:</strong> The business is built on a simple cycle: Use the products yourself, share your experience and the products with others, and build a team of like-minded individuals to do the same.</li>
            <li><strong>Earn Generous Rewards:</strong> You earn income from your retail sales and from the sales of your team members. Forever offers one of the most generous compensation plans in the industry, including performance bonuses, the car plan (Earn While you Drive), and global travel incentives.</li>
            <li><strong>World-Class Support:</strong> You are never alone. You will receive mentorship, training materials, and support from our team at Rich Academy Global and the wider Forever community to help you achieve your goals.</li>
        </ul>
        <h3 style="margin-top:40px;">Ready to Start Your Journey?</h3>
        <p style="text-align: center;">Take the first step towards a healthier, wealthier life. Contact us today to learn more without any obligation.</p>
        <a href="https://wa.me/601111033154?text=Hi,%20I'm%20interested%20in%20learning%20more%20about%20the%20Forever%20Living%20business%20opportunity." class="cta-button" target="_blank"><i class="fab fa-whatsapp"></i> Click to Learn More on WhatsApp</a>
      </section>
    </div>

    <div id="about" class="tab-content">
      <section class="about-us-section">
        <h2>About Us</h2>
        <div class="owner-profile">
            <img src="owner.jpg" alt="Muhd Arvind Isa" class="owner-image" onerror="this.src='https://via.placeholder.com/150'">
            <div class="owner-details">
                <h3>Muhd Arvind Isa - Independent FBO</h3>
                <p>Welcome! I am an authorized Independent Forever Business Owner (FBO) dedicated to bringing you the highest quality health and wellness products from Forever Living. My mission is to empower individuals to lead healthier lives and to provide opportunities for financial well-being through the Forever business model.</p>
                <p><strong>Powered by:</strong> Rich Academy Global</p>
                <p><strong>Contact Information:</strong></p>
                <ul>
                    <li><strong><i class="fab fa-whatsapp"></i> WhatsApp:</strong> <a href="https://wa.me/601111033154">+6011 1103 3154</a></li>
                    <li><strong><i class="fa fa-envelope"></i> Email:</strong> <a href="mailto:cs.foreverlivingbymuhdarvindisa@gmail.com">cs.foreverlivingbymuhdarvindisa@gmail.com</a></li>
                </ul>
            </div>
        </div>
        <hr style="margin: 30px 0;">
        <h3>The Forever Living Legacy</h3>
        <p>Founded in 1978 by Rex Maughan, Forever Living Products is a multi-billion dollar company that manufactures and sells hundreds of wellness and beauty products all around the world. What makes Forever unique is its commitment to quality through a process called "from seed to product."</p>
        <ul>
            <li><strong>The Aloe Vera Company:</strong> Forever owns its own aloe vera plantations in Texas and the Dominican Republic, ensuring the purest and most potent aloe is used in its products. They control the entire process, from planting and harvesting to processing and manufacturing.</li>
            <li><strong>Global Presence:</strong> For over 40 years, Forever has grown to operate in more than 160 countries, demonstrating the universal appeal and effectiveness of its products and business model.</li>
            <li><strong>Our Commitment:</strong> We are committed to providing authentic Forever Living products, exceptional customer service, and reliable support for both our customers and business partners. All products are sourced directly from Forever Living Products and are guaranteed to be genuine.</li>
        </ul>
        <hr style="margin: 30px 0;">
        <h3>Feedback & Order Requests</h3>
        <p>Have a question, compliment, or suggestion? Or perhaps you'd like to place an order directly? Fill out the form below, and we'll get back to you as soon as possible.</p>
        <form class="feedback-form" onsubmit="sendFeedbackEmail(event)">
            <input type="text" id="feedback-name" placeholder="Your Name" required>
            <input type="email" id="feedback-email" placeholder="Your Email" required>
            <select id="feedback-subject" required>
                <option value="" disabled selected>Select a Subject...</option>
                <option value="General Enquiry">General Enquiry</option>
                <option value="Order Request">Order Request</option>
                <option value="Compliment">Compliment</option>
                <option value="Complaint">Complaint</option>
                <option value="Suggestion">Suggestion</option>
            </select>
            <textarea id="feedback-message" placeholder="Your Message" required></textarea>
            <button type="submit" id="feedback-submit-btn" class="btn btn-primary">Send Message</button>
            <p id="feedback-status"></p>
        </form>
      </section>
    </div>

    <div id="rewards" class="tab-content">
      <section class="program-section">
            <h2><i class="fa-solid fa-award"></i> Redeem Your Points</h2>
            <p style="text-align: center;">This feature is currently under development. Stay tuned for exciting rewards!</p>
            <div class="rewards-grid">
                <div class="reward-item">
                    <img src="rm5.jpg" alt="RM 5 Voucher" onerror="this.src='https://i.imgur.com/O9yP2aH.png'">
                    <h4>RM 5 Voucher</h4><p class="points-cost">500 Points</p><div class="coming-soon-overlay"><span>Coming Soon</span></div>
                </div>
                <div class="reward-item">
                    <img src="rm10.jpg" alt="RM 10 Voucher" onerror="this.src='https://i.imgur.com/sY2a2qG.png'">
                    <h4>RM 10 Voucher</h4><p class="points-cost">1000 Points</p><div class="coming-soon-overlay"><span>Coming Soon</span></div>
                </div>
            </div>
        </section>
    </div>
  </main>

  <footer class="footer">
      <div class="container">
        <p>© 2025 Forever Living by Muhd Arvind Isa. All rights reserved.</p>
        <div class="timestamp">Last updated: <span id="current-date"></span> <span style="font-weight:bold;">(v9.0)</span></div>
        <section class="disclaimer">
          <strong>Disclaimer:</strong> This website is operated by an independent FBO and is not the official site of Forever Living Products.
        </section>
      </div>
  </footer>
</div>

  <div id="floating-cart" class="floating-cart-btn" onclick="toggleCart()">
    <i class="fa-solid fa-cart-shopping"></i>
    <span id="cart-count">0</span>
  </div>

  <div id="cart-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="toggleCart(true)">×</span>
      <div id="cart-view">
        <h2>Your Shopping Cart</h2>
        <div id="cart-items"><p>Your cart is currently empty.</p></div>
        <div class="cart-summary">
          <div class="summary-line"><span>Subtotal</span><span id="cart-subtotal">RM 0.00</span></div>
          <div class="summary-line" id="discount-line" style="display:none;"><span>Discount</span><span id="cart-discount">RM 0.00</span></div>
          <div class="summary-line"><span>Shipping</span><span id="cart-shipping">RM 0.00</span></div>
          <div class="summary-line" id="savings-line" style="display:none; color: var(--accent-color); font-weight: bold;"><span>You Saved</span><span id="cart-savings">RM 0.00</span></div>
          <div class="summary-line total"><span>Total</span><span id="cart-total">RM 0.00</span></div>
          <div id="points-earned-display"></div>
        </div>
        <div class="discount-section">
            <input type="text" id="discount-code-input" placeholder="Enter Discount Code">
            <button class="btn btn-secondary" onclick="applyDiscount()">Apply</button>
        </div>
        <p id="discount-status"></p>
        <div class="customer-info-form">
          <h3 style="margin-top: 20px;">Customer & Shipping Information</h3>
          <input type="text" id="customer-name" placeholder="Your Full Name" required>
          <input type="tel" id="customer-phone" placeholder="Your WhatsApp Number (e.g., 60123456789)" required>
          <input type="email" id="customer-email" placeholder="Your Email Address (for receipt)" required>
          <input type="text" id="customer-address1" placeholder="Address Line 1" required>
          <input type="text" id="customer-address2" placeholder="Address Line 2 (Optional)">
          <input type="text" id="customer-city" placeholder="City" required>
          <input type="text" id="customer-state" placeholder="State" required>
          <input type="text" id="customer-postcode" placeholder="Postcode" required>
        </div>
        <div id="consent-form">
            <label for="consent-checkbox">
                <input type="checkbox" id="consent-checkbox" onchange="toggleCheckoutButton()">
                <span>I consent to the collection of my personal data for transaction purposes. You can request data deletion at any time via <a href="https://wa.me/601111033154?text=Hi,%20I%20would%20like%20to%20request%20my%20personal%20data%20to%20be%20deleted." target="_blank">WhatsApp</a> or <a href="mailto:cs.foreverlivingbymuhdarvindisa@gmail.com?subject=Request%20for%20Data%20Deletion">Email</a>.</span>
            </label>
        </div>
        <button class="btn btn-primary checkout-btn" id="checkout-btn" onclick="initiateCheckout()" disabled>Agree & Complete Order via WhatsApp</button>
      </div>
      <div id="verification-view" style="display: none;">
        <h2>Order Verification</h2>
        <p>Please complete the following steps to finalize your order.</p>
        <div id="proof-upload-step" class="verification-step active">
            <h4><i class="fa-solid fa-arrow-up-from-bracket"></i> Step 1: Upload Payment Proof</h4>
            <p style="font-size: 0.9rem; color: #555;">Upload a screenshot of your transaction receipt.</p>
            <input type="file" id="payment-proof-upload" accept="image/*">
            <button class="btn btn-primary" id="upload-proof-btn" onclick="uploadProof()">Upload and Proceed</button>
            <p id="upload-status"></p>
        </div>
        <div id="code-verification-step" class="verification-step">
            <h4><i class="fa-solid fa-key"></i> Step 2: Finalize with Code</h4>
            <p style="font-size: 0.9rem; color: #555;">Enter the verification code provided to you by the owner.</p>
            <input type="text" id="verification-code" placeholder="Enter Verification Code" disabled>
            <button class="btn btn-primary" id="finalize-order-btn" onclick="finalizeOrder()" disabled>Finalize Order & Get Receipt</button>
            <p id="verification-status"></p>
        </div>
        <button class="btn btn-secondary" style="margin-top: 20px;" onclick="cancelVerification()">Cancel Entire Order</button>
      </div>
    </div>
  </div>

<script>
    // --- CONFIGURATION ---
    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbwq0xe8DuQuTrWObYrz98IBGrIj_9bJwt03PBwiZqVQeWTQXsj1T8epXV3Fm7RZN3RtQg/exec';
    
    // --- DATA ---
    const products = [ { id: 1, name: "ALOE VERA GEL", price: 116.79, image: "aloe-vera-gel.jpg", benefits: "Supports healthy digestion, Promotes a healthy immune system, Enhances nutrient absorption, Helps maintain natural energy levels, Contains 99.7% pure inner-leaf aloe, Sugar-free & gluten-free.", consumption: "Take 30-60ml daily." }, { id: 2, name: "ALOE BERRY NECTAR", price: 116.79, image: "aloe-berry-nectar.jpg", benefits: "Supports urinary tract health, Contains powerful antioxidants, Promotes a healthy immune system, Natural source of Vitamin C, Aids in cleansing the digestive system, Has a sweet and tangy flavor.", consumption: "30-60ml daily." }, { id: 3, name: "ALOE BITS N' PEACHES", price: 116.79, image: "aloe-peaches.jpg", benefits: "Great taste for kids and families, Aids in digestive health, Supports the immune system, Provides valuable carotenoids and vitamins, Contains chunks of pure aloe vera, Supports skin health.", consumption: "30-60ml daily." }, { id: 4, name: "LITE VANILLA", price: 155.72, image: "lite-vanilla.jpg", benefits: "Rich in vitamins and minerals, A complete meal replacement, Supports weight management, Provides 17g of protein per serving, Low in carbs, Delicious vanilla flavor.", consumption: "Mix with milk or water." }, { id: 5, name: "LITE CHOCO", price: 155.72, image: "lite-choco.jpg", benefits: "Rich chocolate flavor, A complete meal replacement, Supports weight management goals, High in protein for muscle maintenance, Low in carbohydrates, Packed with essential nutrients.", consumption: "Mix with milk or water." }, { id: 6, name: "SUPERGREENS", price: 214.71, image: "supergreens.jpg", benefits: "Rich source of antioxidants, Supports pH balance, Boosts natural energy levels, Aids in detoxification, Contains over 20 fruits and vegetables, Supports a healthy immune system.", consumption: "Mix with water or juice." }, { id: 7, name: "FIBER", price: 124.44, image: "fiber.jpg", benefits: "Supports digestive health, Promotes feelings of fullness, Helps maintain healthy blood sugar levels, Quick-dissolving and grit-free, Provides 5g of fiber per stick pack, Supports cardiovascular health.", consumption: "Mix with water." }, { id: 8, name: "TONGKAT ALI", price: 19.90, image: "tongkat-ali.jpg", benefits: "Supports men's health and vitality, Boosts energy and stamina, May improve athletic performance, Traditional herb for male wellness, Supports healthy testosterone levels, Enhances overall physical strength.", consumption: "As per packaging." }, { id: 9, name: "WHITE COFFEE", price: 15.99, image: "white-coffee.jpg", benefits: "Rich and aromatic coffee experience, Smooth and creamy texture, Lower in acidity, A delightful alternative to regular coffee, Provides a gentle energy boost, Easy to prepare.", consumption: "Mix with hot water." }, { id: 10, name: "CHOCOLATE MALT DRINK", price: 27.90, image: "choco-malt.jpg", benefits: "Nutritious and delicious, Great source of energy for kids and adults, Rich in vitamins and minerals, Supports healthy growth, Comforting and satisfying taste, Can be enjoyed hot or cold.", consumption: "Mix with hot water or milk." }, { id: 11, name: "TEH TARIK HALIA", price: 25.90, image: "teh-tarik.jpg", benefits: "Warming ginger tea, Aids in digestion, Soothes the stomach, Aromatic and flavorful, Combines tea with the benefits of ginger, Traditional Malaysian comfort drink.", consumption: "Mix with hot water." }, { id: 12, name: "BEE HONEY", price: 132.57, image: "bee-honey.jpg", benefits: "Provides a quick boost of natural energy, Soothes coughs and sore throats, A healthy alternative to processed sugar, Contains beneficial enzymes and nutrients, Easily digestible, Sourced from high desert regions.", consumption: "1-2 teaspoons daily." }, { id: 13, name: "BEE POLLEN", price: 75.50, image: "bee-pollen.jpg", benefits: "Considered a natural multi-vitamin, Boosts energy and stamina, Supports cardiovascular health, Aids in digestion, Contains a wide spectrum of nutrients, Supports a healthy immune system.", consumption: "1 tablet 3 times daily." }, { id: 14, name: "BEE PROPOLIS", price: 139.21, image: "bee-propolis.jpg", benefits: "Acts as a natural antibiotic, Supports the body's defenses, Helps combat free radicals, A powerful antioxidant, Sourced from pollution-free regions, Fortified with royal jelly.", consumption: "1 tablet daily." }, { id: 15, name: "ROYAL GELLY", price: 139.21, image: "royal-jelly.jpg", benefits: "Boosts energy and reduces fatigue, Supports a healthy immune system, May improve brain function, Contains complex vitamins and minerals, Traditionally known as a 'superfood', Supports cell regeneration.", consumption: "1 tablet daily." }, { id: 16, name: "OMEGA 3 PLUS", price: 130.10, image: "arctic-sea.jpg", benefits: "Supports cardiovascular health, Promotes healthy brain function, Supports joint health and mobility, Sourced from pure deep-sea fish, Contains a balanced blend of EPA and DHA, Includes beneficial olive oil.", consumption: "2 softgels twice daily." }, { id: 17, name: "ABSORBENT-C", price: 75.50, image: "absorbent-c.jpg", benefits: "Powerful antioxidant, Supports a healthy immune system, Bonded with oat bran for maximum absorption, Promotes healthy skin, Helps combat free radicals, Necessary for collagen production.", consumption: "1-2 tablets daily." }, { id: 18, name: "FIELDS OF GREENS", price: 86.10, image: "fields-of-greens.jpg", benefits: "Excellent source of green food, Aids in detoxification and digestion, Contains beneficial phytonutrients, Helps combat nutrient deficiencies, An easy way to get your greens, Contains cayenne pepper and honey.", consumption: "1 tablet 3 times daily." }, { id: 19, name: "CALCIUM PLUS TABLET", price: 132.15, image: "calcium-plus.jpg", benefits: "Promotes strong and healthy bones, Contains Vitamin D for better absorption, Supports proper muscle function, Includes magnesium and zinc, Helps prevent osteoporosis, Vital for a healthy nervous system.", consumption: "2 tablets daily." }, { id: 20, name: "ALOE LIPS", price: 20.33, image: "aloe-lips.jpg", benefits: "Moisturizes and soothes dry, chapped lips, Contains aloe, jojoba, and beeswax, Creates a protective moisture barrier, Can be used as a first-aid stick for minor cuts, Great for all seasons, Compact and easy to carry.", consumption: "Apply as needed." }, { id: 21, name: "BRIGHT TOOTHGEL", price: 41.29, image: "bright-toothgel.jpg", benefits: "Fluoride-free formula, Gentle on gums and enamel, Contains bee propolis, Natural mint flavor, Whitens without bleaching agents, Fights plaque and promotes fresh breath.", consumption: "Brush teeth twice daily." }, { id: 22, name: "ALOE FIRST", price: 90.83, image: "aloe-first.jpg", benefits: "Soothes minor skin irritations, burns, and sunburn, Easy-to-apply spray formula, pH-balanced for sensitive skin, Contains bee propolis and eleven plant extracts, A great addition to any first-aid kit, Can be used on hair to protect from elements.", consumption: "Spray on skin as needed." }, { id: 23, name: "DEODORANT STICK", price: 50.73, image: "forever-deodorant.jpg", benefits: "Provides effective, all-day protection against odor, Contains no aluminum salts, Does not stain clothes, Can be used after shaving or waxing without irritation, Fresh and clean scent, Gentle aloe-based formula.", consumption: "Apply daily." }, { id: 24, name: "AVOCADO SOAP", price: 30.68, image: "avocado-soap.jpg", benefits: "Gentle cleansing for face, hands, and body, Made with 100% pure avocado butter, Rich in vitamins A, B, D, and E, Moisturizes as it cleans, Fresh citrus scent, Suitable for all skin types.", consumption: "Use daily." }, { id: 25, name: "ALOE LIQUID SOAP", price: 120.91, image: "aloe-liquid-soap.jpg", benefits: "Moisturizing hand and face wash, Gentle, pearlescent formula, Creates a luxurious lather, pH-balanced and non-irritating, Cleanses without stripping natural oils, Suitable for the whole family.", consumption: "Use daily." }, { id: 26, name: "JOJOBA SHAMPOO", price: 105.93, image: "aloe-jojoba-shampoo.jpg", benefits: "Nourishes hair and scalp, pH-balanced and sulfate-free, Strengthens hair with jojoba oil, Creates a soft, manageable mane, Suitable for all hair types, Fresh, clean scent.", consumption: "Massage into wet hair." }, { id: 27, name: "JOJOBA CONDITIONER", price: 117.70, image: "aloe-jojoba-conditioner.jpg", benefits: "Moisturizes and strengthens hair, Softens and smooths frizz, Lightweight formula that doesn't weigh hair down, Coats the hair shaft to eliminate split ends, pH-balanced for healthy hair, Complements the Aloe-Jojoba Shampoo perfectly.", consumption: "Apply after shampoo." }, { id: 28, name: "ALOE BODY WASH", price: 120.91, image: "aloe-body-wash.jpg", benefits: "Gentle, moisturizing body wash, Creates a rich, creamy foam, Cleanses without stripping moisture, Contains skin-conditioning aloe and argan oil, Leaves skin feeling soft and refreshed, Fresh, invigorating scent.", consumption: "Use daily in shower." }, { id: 29, name: "ALOE BODY LOTION", price: 112.35, image: "aloe-body-lotion.jpg", benefits: "Fast-absorbing, non-greasy formula, Hydrates and softens the skin, Promotes a healthy, youthful glow, Contains aloe, argan oil, and jojoba esters, Suitable for daily use, Light, floral scent.", consumption: "Apply to body as needed." }, { id: 30, name: "ALOE PROPOLIS CREME", price: 90.83, image: "aloe-propolis-creme.jpg", benefits: "Soothes and moisturizes dry skin, Excellent for rough patches, Contains aloe vera and bee propolis, Rich in vitamins A and E, Helps maintain a healthy skin tone, A popular all-purpose skin cream.", consumption: "Apply generously." }, { id: 31, name: "ALOE VERA GELLY", price: 70.78, image: "aloe-vera-gelly.jpg", benefits: "Essentially identical to the aloe vera inner leaf, Soothes minor skin irritations and sunburn, Quickly absorbed without staining clothes, A must-have for any first-aid kit, Can be used as a calming aftershave, Lubricates and moisturizes sensitive tissue.", consumption: "Apply to affected area." }, { id: 32, name: "ALOE MOISTURIZING", price: 70.78, image: "aloe-moisturizing.jpg", benefits: "Hydrates face and body, Contains collagen and elastin, Helps maintain skin's smooth, supple feel, Can be used as a makeup base, Fights signs of aging, Excellent for hands and body.", consumption: "Apply as needed." }, { id: 33, name: "ALOE MASSAGE LOTION", price: 70.78, image: "aloe-massage-lotion.jpg", benefits: "Soothing lotion for massage and tired muscles, Provides a warming and relaxing sensation, pH-balanced and skin-conditioning, Eases away the stresses of the day, Great after sports or a heavy workout, Helps relieve joint discomfort.", consumption: "Massage into skin." }, { id: 34, name: "ALOE MSM GEL", price: 86.00, image: "aloe-msm-gel.jpg", benefits: "Soothes joints, muscles, and connective tissues, Non-staining, clear gel formula, Contains pure MSM and aloe vera, Can be applied liberally, Provides fast-acting relief, Also includes herbal extracts.", consumption: "Apply to affected areas." }, { id: 35, name: "ALOE SUNSCREEN", price: 89.07, image: "aloe-sunscreen.jpg", benefits: "Broad spectrum SPF 20 protection, Soothes and moisturizes skin with aloe, Water-resistant for up to 80 minutes, Protects against UVA and UVB rays, Non-greasy and applies smoothly, Suitable for the whole family.", consumption: "Apply before sun exposure." }, { id: 36, name: "ALOE SCRUB", price: 77.86, image: "aloe-scrub.jpg", benefits: "Gently exfoliates skin, Removes dead skin cells, Contains jojoba microspheres, Gentle enough for daily use, Reveals brighter, healthier-looking skin, Prepares skin for moisturization.", consumption: "Use 2-3 times a week." }, { id: 37, name: "MASK POWDER", price: 102.90, image: "mask-powder.jpg", benefits: "Cleanses, tightens, and refines pores, Designed to be mixed with Aloe Activator, Contains albumen and corn starch, Smoothes and conditions the skin, A fantastic at-home facial treatment, Removes dead skin cells and impurities.", consumption: "Mix with Aloe Activator." }, { id: 38, name: "R3 FACTOR-SKIN DEFENSE", price: 160.97, image: "r3-factor.jpg", benefits: "Helps skin Retain, Restore, and Renew, Fights the harsh effects of time, Contains alpha hydroxy acids (AHAs), Helps exfoliate dead skin cells, Fortified with vitamins A and E, Defends against free radicals.", consumption: "Apply to face and neck." }, { id: 39, name: "FOREVER ALPHA-E FACTOR", price: 144.90, image: "alpha-e-factor.jpg", benefits: "Nourishes and restores skin, A rich elixir of antioxidants, Combats free radical damage, Delivers deep moisturization, Enhances skin elasticity, Soothes and calms sensitive skin.", consumption: "Apply a few drops to face." }, { id: 40, name: "INFINITE HYDRATING CLEANSER", price: 131.20, image: "infinite-cleanser.jpg", benefits: "Gentle, hydrating cleanser, Washes away dirt and oil without drying, Increases skin hydration, Contains apple extracts and amino acids, Sulfate-free formula, Leaves skin feeling soft and clean.", consumption: "Use morning and night." }, { id: 41, name: "INFINITE FIRMING SERUM", price: 190.47, image: "infinite-serum.jpg", benefits: "Reduces the appearance of fine lines and wrinkles, Targets aging from the outside in, Clinically tested to improve elasticity, Boosts the power of aloe, A key part of the anti-aging regimen, Supports healthy collagen synthesis.", consumption: "Apply to face." }, { id: 42, name: "INFINITE RESTORING CREME", price: 221.56, image: "infinite-creme.jpg", benefits: "Deeply moisturizes and restores skin, Contains over 15 skin-conditioning ingredients, Fast-absorbing and non-greasy, Seals in moisture for lasting hydration, Helps reinforce the skin's natural barrier, Combats signs of aging.", consumption: "Apply to face and neck." }, { id: 43, name: "BALANCING TONER", price: 106.18, image: "balancing-toner.jpg", benefits: "Refreshes, soothes, and rehydrates skin, Minimizes the appearance of pores, Contains a unique blend of seaweed extract, Alcohol-free formula, Softens and smoothes skin texture, Supports a youthful appearance.", consumption: "Apply after cleansing." }, { id: 44, name: "AWAKENING EYE CREAM", price: 89.66, image: "eye-cream.jpg", benefits: "Reduces the appearance of puffiness and dark circles, Visibly firms and smoothes the under-eye area, Contains marine collagen, Fights wrinkles and fine lines, Features a peptide technology, Supports healthy skin hydration.", consumption: "Pat gently around eyes." }, { id: 45, name: "ALOE ACTIVATOR", price: 80.59, image: "aloe-activator.jpg", benefits: "Contains over 98% aloe vera gel, Can be used as a cleanser, freshener, or with Mask Powder, Gentle enough for the entire face, including the eye area, Conditions and moisturizes the skin, A superb moisturizing agent, Supports skin cell vitality.", consumption: "Use with Mask Powder or as a toner." }, { id: 46, name: "HYDRATING SERUM", price: 156.56, image: "hydrating-serum.jpg", benefits: "Boosts skin hydration, Absorbs quickly into the skin, Reduces the appearance of fine lines, Shields against environmental stressors, Contains four types of hyaluronic acid, Enhances the benefits of your moisturizer.", consumption: "Apply to face." }, { id: 47, name: "S.REFRESHING G.CLEANSER", price: 115.61, image: "refreshing-cleanser.jpg", benefits: "Gentle gel cleanser for combination skin, Uses amino acids from apples for a soft lather, Washes away dirt and oil effectively, Helps control shine, Soothes skin while cleansing, Leaves skin feeling refreshed.", consumption: "Use morning and night." }, { id: 48, name: "S. IILUMINATING GEL", price: 107.35, image: "illuminating-gel.jpg", benefits: "Brightens skin appearance, Evens skin tone, Reduces the appearance of large pores, Contains five Asian botanicals, Gives skin a soft, smooth texture, Promotes a healthy, natural glow.", consumption: "Apply to face." }, { id: 49, name: "S. REFINING GEL MASK", price: 115.61, image: "refining-mask.jpg", benefits: "A cool gel mask that refines pores, Moisturizes and brightens the skin, Supports a balanced skin tone, Fights the effects of pollution, A fun, easy-to-use overnight mask, Infused with a bouquet of botanicals.", consumption: "Use 2-3 times a week." }, { id: 50, name: "S.SMOOTHING GEL MOISTURIZER", price: 115.76, image: "smoothing-moisturizer.jpg", benefits: "Lightweight gel moisturizer, Absorbs quickly for a light-as-air feel, Delivers moisture and nutrients, Supports a healthy, youthful complexion, Contains over 10 natural plant extracts, Helps control oil and even skin tone.", consumption: "Apply to face." }, { id: 51, name: "ALOE BIO-CELLULOSE MASK", price: 146.00, image: "bio-cellulose-mask.jpg", benefits: "Provides deep, powerful hydration, Rejuvenates dull skin, Reduces the appearance of redness, Unveils soft, supple skin, Fuses aloe and seagrass into the mask fibers, Easy to apply and fits every face shape.", consumption: "Use once a week." }, { id: 52, name: "REPLENISHING SKIN OIL", price: 132.00, image: "skin-oil.jpg", benefits: "Nourishes with a blend of natural oils, Restores and balances skin's moisture, Non-greasy and easily absorbed, Contains vitamins A, C, and E, Soothes and calms the skin, A great addition to any skincare routine.", consumption: "Apply a few drops to face." }, { id: 53, name: "PROTECTING DAY LOTION", price: 167.99, image: "day-lotion.jpg", benefits: "Moisturizes and protects with broad spectrum SPF 20, Shields against harmful UV rays, Defends against environmental damage, Features a blend of skin-conditioning oils, Goes on smooth and sheer, A perfect daily-use face lotion.", consumption: "Apply in the morning." }, ];
    
    // --- GLOBAL STATE ---
    let cart = []; let activeFestival = null; let activePromotions = []; let shippingRules = {}; let availableDiscountCodes = {}; let appliedDiscount = null;

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', async function() {
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        try {
            const response = await fetch(googleScriptURL);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            if (data.status === 'success') {
                activeFestival = data.activeFestival; activePromotions = data.activePromotions; shippingRules = data.shippingRules; availableDiscountCodes = data.discountCodes;
                initializeUI();
            } else { throw new Error(data.message || 'Failed to fetch initial data from server.'); }
        } catch (error) { console.error("Error fetching dynamic data:", error); initializeUI(); }
        if (sessionStorage.getItem('pendingOrder')) { toggleCart(); } else { showTab('products'); }
    });

    function initializeUI() {
        const body = document.body; body.className = 'default-theme';
        const festivalContainer = document.getElementById('festival-animations-container');
        if (activeFestival) {
            body.classList.add(`theme-${activeFestival.theme}`);
            document.getElementById('hero-title').innerHTML = `<i class="fa-solid fa-gift"></i> ${activeFestival.name}`;
            document.getElementById('hero-subtitle').textContent = "Enjoy special festive offers!";
            const banner = document.getElementById('promo-running-banner');
            document.getElementById('promo-banner-text').textContent = `✨ ${activeFestival.name}! See special offers below! ✨`;
            banner.style.display = 'block'; startCountdown(activeFestival.endDate);
            if(festivalContainer) festivalContainer.style.display = 'block';
        } else {
            document.getElementById('hero-title').innerHTML = `<i class="fa-solid fa-store"></i> Welcome to Our Store`;
            document.getElementById('hero-subtitle').textContent = "Enjoy high-quality wellness products for a healthier lifestyle.";
            if(festivalContainer) festivalContainer.style.display = 'none';
        }
        renderProducts();
    }
    
    function renderProducts(){
        const productListContainer = document.getElementById("product-list-container");
        if (!productListContainer) return;
        let html = "";
        let remainingProducts = [...products];
        activePromotions.forEach(promo => {
            let productsInPromo = [];
            remainingProducts.forEach(p => { if (promo.productIDs.includes(p.id)) { productsInPromo.push(p); } });
            if (productsInPromo.length > 0) {
                html += `<section class="promo-section"><h2>${promo.description}</h2><div class="product-list">`;
                productsInPromo.forEach(product => { html += renderSingleProduct(product, promo); });
                html += `</div></section>`;
                remainingProducts = remainingProducts.filter(p => !promo.productIDs.includes(p.id));
            }
        });
        if (remainingProducts.length > 0) {
            html += `<section class="promo-section"><h2>All Products</h2><div class="product-list">`;
            remainingProducts.forEach(product => { html += renderSingleProduct(product, null); });
            html += `</div></section>`;
        }
        productListContainer.innerHTML = html;
    }

    function renderSingleProduct(product, promo) {
        let priceHTML = `<span class="new-price">RM ${product.price.toFixed(2)}</span>`;
        let finalPrice = product.price;
        if (promo) {
            if (promo.type === 'B2G200') {
                priceHTML = `<span class="original-price">RM ${product.price.toFixed(2)}</span><span class="new-price" style="font-size: 1.2rem; color: var(--primary-color); display: block; margin-top: 5px;">Buy Any 2 for RM 200.00</span><div style="font-size: 0.9rem; color: var(--accent-color); font-weight: bold; margin-top: 5px;"><i class="fa-solid fa-truck-fast"></i> FREE Shipping!</div>`;
            } else if (promo.type === 'PERCENT') {
                const discountedPrice = product.price * (1 - parseFloat(promo.value) / 100);
                priceHTML = `<span class="original-price">RM ${product.price.toFixed(2)}</span><span class="new-price">RM ${discountedPrice.toFixed(2)}</span>`;
                finalPrice = discountedPrice;
            } else if (promo.type === 'FIXED') {
                const discountedPrice = product.price - parseFloat(promo.value);
                priceHTML = `<span class="original-price">RM ${product.price.toFixed(2)}</span><span class="new-price">RM ${discountedPrice.toFixed(2)}</span>`;
                finalPrice = discountedPrice;
            }
        }
        return `<div class="product ${promo ? 'promo-highlight' : ''}"><div class="halal-badge">HALAL</div>${promo ? '<div class="featured-badge">On Offer!</div>' : ''}<div class="product-image-container"><img src="${product.image || 'https://via.placeholder.com/200'}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/200x200?text=Image+Not+Found'"></div><div class="product-info"><h3>${product.name}</h3><div class="price-section">${priceHTML}</div><div class="benefits"><strong>Benefits:</strong> ${product.benefits}</div><div class="consumption"><strong>Usage:</strong> ${product.consumption}</div><div class="product-actions"><button class="btn btn-primary" onclick="addToCart(${product.id}, ${finalPrice})"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button></div></div></div>`;
    }
    
    function startCountdown(endDateString){const countdownEl=document.getElementById("countdown-timer");if(!countdownEl||!endDateString)return;countdownEl.style.display="inline-block";const promoEndDate=(new Date(endDateString)).getTime(),interval=setInterval(()=>{const now=(new Date).getTime(),distance=promoEndDate-now;if(distance<0)return clearInterval(interval),void(countdownEl.innerHTML="PROMOTION ENDED");const days=Math.floor(distance/864e5),hours=Math.floor(distance%864e5/36e5),minutes=Math.floor(distance%36e5/6e4),seconds=Math.floor(distance%6e4/1e3);countdownEl.innerHTML=`${days}d ${hours}h ${minutes}m ${seconds}s`},1e3)}
    function showTab(tabId){document.querySelectorAll(".tab-content").forEach(el=>el.classList.remove("active"));const activeTab=document.getElementById(tabId);activeTab&&activeTab.classList.add("active")}
    function toggleCheckoutButton(){document.getElementById("checkout-btn").disabled=!document.getElementById("consent-checkbox").checked}
    
    function addToCart(productId, finalPrice){
        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            const productData = products.find(p => p.id === productId);
            cart.push({ id: productData.id, name: productData.name, quantity: 1, basePrice: productData.price, finalPrice: finalPrice });
        }
        updateCartDisplay();
    }

    function increaseQuantity(productId){const item=cart.find(p=>p.id===productId);if(item){item.quantity++;updateCartDisplay()}}
    function decreaseQuantity(productId){const item=cart.find(p=>p.id===productId);if(item){item.quantity--;if(item.quantity<=0)removeItemFromCart(productId);else updateCartDisplay()}}
    function removeItemFromCart(productId){appliedDiscount=null;document.getElementById('discount-code-input').value="";document.getElementById('discount-status').textContent="";cart=cart.filter(p=>p.id!==productId);updateCartDisplay()}
    function updateCartCount(){document.getElementById("cart-count").textContent=cart.reduce((total,item)=>total+item.quantity,0)}
    function applyDiscount(){const codeInput=document.getElementById("discount-code-input"),statusEl=document.getElementById("discount-status"),code=codeInput.value.trim().toUpperCase();if(!code)return statusEl.textContent="Please enter a code.",void(statusEl.style.color="orange");const discountData=availableDiscountCodes[code];discountData?(appliedDiscount={code,...discountData},statusEl.textContent=`Code "${code}" applied successfully!`,statusEl.style.color="green"):(appliedDiscount=null,statusEl.textContent="Invalid or expired discount code.",statusEl.style.color="red"),updateCartDisplay()}
    
    function calculateCartTotals() {
        let subtotal = 0;
        let originalSubtotal = 0;
        let promoShippingRuleId = null;
        const itemFinalPrices = {};
        
        const cartWithDetails = cart.map(item => {
            const details = products.find(p => p.id === item.id);
            return {...item, details};
        });

        cartWithDetails.forEach(item => {
            originalSubtotal += item.details.price * item.quantity;
            itemFinalPrices[item.id] = item.details.price;
            item.isB2G200 = false;
        });

        const b2g200Promo = activePromotions.find(p => p.type === 'B2G200');
        if (b2g200Promo) {
            const productsInPromo = cartWithDetails.filter(item => b2g200Promo.productIDs.includes(item.details.id));
            if(productsInPromo.length > 0) {
                productsInPromo.forEach(item => { item.isB2G200 = true; });
                if (b2g200Promo.shippingRuleId) promoShippingRuleId = b2g200Promo.shippingRuleId;
            }
        }
        
        activePromotions.filter(p => p.type !== 'B2G200').forEach(promo => {
            const productsInPromo = cartWithDetails.filter(item => promo.productIDs.includes(item.details.id) && !item.isB2G200);
            if(productsInPromo.length > 0) {
                 if (promo.shippingRuleId) promoShippingRuleId = promo.shippingRuleId;
                productsInPromo.forEach(item => {
                    let finalPrice = item.details.price;
                    if (promo.type === 'PERCENT') { finalPrice = item.details.price * (1 - parseFloat(promo.value) / 100); } 
                    else if (promo.type === 'FIXED') { finalPrice = item.details.price - parseFloat(promo.value); }
                    itemFinalPrices[item.id] = finalPrice;
                });
            }
        });
        
        const b2g200Items = cartWithDetails.filter(item => item.isB2G200);
        let b2g200Subtotal = 0;
        if(b2g200Items.length > 0){
            const count = b2g200Items.reduce((sum, item) => sum + item.quantity, 0);
            const numPairs = Math.floor(count/2);
            const remaining = count % 2;
            b2g200Subtotal = (numPairs * 200) + (remaining * b2g200Items[0].details.price);
        }

        const otherSubtotal = cartWithDetails.filter(item => !item.isB2G200)
            .reduce((sum, item) => sum + (itemFinalPrices[item.id] * item.quantity), 0);
        
        subtotal = b2g200Subtotal + otherSubtotal;
        
        let discountValue = 0;
        if (appliedDiscount) {
            if (appliedDiscount.type === 'Fixed') { discountValue = parseFloat(appliedDiscount.value); } 
            else if (appliedDiscount.type === 'Percentage') { discountValue = subtotal * (parseFloat(appliedDiscount.value) / 100); } 
            else if (appliedDiscount.type === 'FreeShipping') {
                const freeShipRule = Object.keys(shippingRules).find(id => "Free" === shippingRules[id].type);
                if (freeShipRule) promoShippingRuleId = freeShipRule;
            }
        }
        const subtotalAfterDiscount = subtotal - discountValue;
        const shipping = calculateShipping(cart, subtotalAfterDiscount, promoShippingRuleId);
        const total = subtotalAfterDiscount + shipping.fee;
        const totalPoints = Math.floor(subtotalAfterDiscount);

        return { subtotal, originalSubtotal, discountValue, shipping, total, totalPoints, itemFinalPrices };
    }

    function calculateShipping(cart,subtotal,promoShippingRuleId){if(cart.length===0)return{fee:0,message:"RM 0.00"};let ruleToApply=null;if(promoShippingRuleId&&shippingRules[promoShippingRuleId]){ruleToApply=shippingRules[promoShippingRuleId];ruleToApply.reason="Promotional Shipping!"}else{const defaultRules=Object.values(shippingRules).filter(r=>r.isDefault&&"Tiered"===r.type).sort((a,b)=>a.minSpend-b.minSpend);for(const rule of defaultRules)if(subtotal>=rule.minSpend&&subtotal<=rule.maxSpend){ruleToApply=rule;ruleToApply.reason=`Spend over RM${rule.minSpend}`}}if(!ruleToApply)return{fee:14,message:"RM 14.00"};if(ruleToApply.type==='Free')return{fee:0,message:"FREE",reason:ruleToApply.reason||"Promotional Free Shipping!"};if(ruleToApply.type==='FlatRate')return{fee:parseFloat(ruleToApply.charge),message:`RM ${parseFloat(ruleToApply.charge).toFixed(2)}`};if(ruleToApply.type==='Tiered'){const fee=parseFloat(ruleToApply.charge);return{fee:fee,message:0===fee?"FREE":`RM ${fee.toFixed(2)}`,reason:0===fee?`Free shipping for orders over RM ${ruleToApply.minSpend}!`:"Standard Shipping"}}return{fee:14,message:"RM 14.00"}}
    
    function updateCartDisplay(){const cartItemsEl=document.getElementById("cart-items"),subtotalEl=document.getElementById("cart-subtotal"),discountLine=document.getElementById("discount-line"),discountEl=document.getElementById("cart-discount"),shippingEl=document.getElementById("cart-shipping"),totalEl=document.getElementById("cart-total"),pointsEl=document.getElementById("points-earned-display"),savingsLine=document.getElementById("savings-line"),savingsEl=document.getElementById("cart-savings");if(cart.length===0){cartItemsEl.innerHTML="<p>Your cart is currently empty.</p>";subtotalEl.textContent="RM 0.00";shippingEl.textContent="RM 0.00";totalEl.textContent="RM 0.00";pointsEl.innerHTML="";discountLine.style.display="none";savingsLine.style.display="none";updateCartCount();return}const{subtotal:calculatedSubtotal,originalSubtotal:originalSubtotal,discountValue:calculatedDiscount,shipping:shipping,total:total,totalPoints:totalPoints,itemFinalPrices:itemFinalPrices}=calculateCartTotals();let itemsHTML="";cart.forEach(item=>{const productData=products.find(p=>p.id===item.id),finalPrice=itemFinalPrices[item.id]||productData.price;let priceDisplay=`<span class="final-cart-price">RM ${finalPrice.toFixed(2)}</span>`;finalPrice<productData.price&&(priceDisplay+=`<span class="original-cart-price">RM ${productData.price.toFixed(2)}</span>`);itemsHTML+=`<div class="cart-item"><div class="cart-item-details"><strong>${item.name}</strong><div class="quantity-controls"><button class="quantity-btn" onclick="decreaseQuantity(${item.id})">-</button><span class="quantity-display">${item.quantity}</span><button class="quantity-btn" onclick="increaseQuantity(${item.id})">+</button></div></div><div style="text-align:right">${priceDisplay}</div></div>`});const totalSavings=originalSubtotal-calculatedSubtotal+calculatedDiscount;cartItemsEl.innerHTML=itemsHTML;subtotalEl.textContent=`RM ${calculatedSubtotal.toFixed(2)}`;if(calculatedDiscount>0){discountEl.textContent=`- RM ${calculatedDiscount.toFixed(2)}`;discountLine.style.display="flex"}else{discountLine.style.display="none"}if(shipping.message==="FREE"){shippingEl.innerHTML=`<span style="color:var(--accent-color);font-weight:700"><i class="fa-solid fa-truck-fast"></i> FREE! <small>(${shipping.reason})</small></span>`}else{shippingEl.innerHTML=shipping.message}if(totalSavings>0){savingsEl.textContent=`RM ${totalSavings.toFixed(2)}`;savingsLine.style.display="flex"}else{savingsLine.style.display="none"}totalEl.textContent=`RM ${total.toFixed(2)}`;pointsEl.innerHTML=`<div class="points-earned"><i class="fa-solid fa-star"></i> Points to be Earned: ${totalPoints}</div>`;updateCartCount()}
    
    function initiateCheckout(){if(!document.getElementById("consent-checkbox").checked)return void alert("You must agree to the data collection consent before proceeding.");const name=document.getElementById("customer-name").value.trim(),phone=document.getElementById("customer-phone").value.trim(),email=document.getElementById("customer-email").value.trim(),address1=document.getElementById("customer-address1").value.trim(),address2=document.getElementById("customer-address2").value.trim(),city=document.getElementById("customer-city").value.trim(),state=document.getElementById("customer-state").value.trim(),postcode=document.getElementById("customer-postcode").value.trim();if(!name||!phone||!email||!address1||!city||!state||!postcode)return void alert("Please fill in all required customer and shipping information fields.");if(0===cart.length)return void alert("Your cart is empty.");const{subtotal:subtotal,discountValue:discount,shipping:shipping,total:total,totalPoints:totalPoints,itemFinalPrices:itemFinalPrices}=calculateCartTotals(),fullAddress=`${address1}, ${address2?address2+", ":""}${postcode} ${city}, ${state}.`,pendingOrder={customerName:name,customerPhone:phone,customerEmail:email,customerAddress:fullAddress,cart:cart.map(item=>({id:item.id,name:item.name,quantity:item.quantity,finalPrice:itemFinalPrices[item.id]})),totalAmount:total.toFixed(2),shippingFee:shipping.fee.toFixed(2),discountApplied:appliedDiscount?`${appliedDiscount.code} - RM ${discount.toFixed(2)}`:"N/A",discountCodeUsed:appliedDiscount?appliedDiscount.code:"N/A",totalPointsForThisPurchase:totalPoints};sessionStorage.setItem("pendingOrder",JSON.stringify(pendingOrder));let message=`Hi, I would like to place an order:\n\n*Customer Details:*\nName: ${name}\nPhone: ${phone}\nEmail: ${email}\nAddress: ${fullAddress}\n\n--- ORDER SUMMARY ---\nSubtotal: RM ${subtotal.toFixed(2)}${discount>0?`\nDiscount: - RM ${discount.toFixed(2)}`:""}\nShipping: ${shipping.message}\n*TOTAL: RM ${total.toFixed(2)}*\n\nPlease provide payment details. After payment, I will upload the proof and verification code on your website to finalize the order. Thank you!`;window.open(`https://wa.me/601111033154?text=${encodeURIComponent(message)}`,"_blank"),document.getElementById("cart-view").style.display="none",document.getElementById("verification-view").style.display="block",updateVerificationUI()}
    
    async function uploadProof(){const proofFile=document.getElementById("payment-proof-upload").files[0],uploadStatusEl=document.getElementById("upload-status"),uploadBtn=document.getElementById("upload-proof-btn");let pendingOrder=JSON.parse(sessionStorage.getItem("pendingOrder"));if(!proofFile)return uploadStatusEl.textContent="Please select a file to upload.",void(uploadStatusEl.style.color="red");if(!pendingOrder)return uploadStatusEl.textContent="Error: No pending order found.",void(uploadStatusEl.style.color="red");uploadBtn.disabled=!0,uploadStatusEl.textContent="Uploading...",uploadStatusEl.style.color="blue";try{const base64File=await getBase64(proofFile),payload={action:"logInitialOrderWithProof",date:(new Date).toLocaleString("en-GB"),customerName:pendingOrder.customerName,customerEmail:pendingOrder.customerEmail,customerPhone:pendingOrder.customerPhone,customerAddress:pendingOrder.customerAddress,itemsPurchased:pendingOrder.cart.map(item=>`${item.name} (x${item.quantity})`).join("; "),discountApplied:pendingOrder.discountApplied,totalAmount:pendingOrder.totalAmount,shippingFee:pendingOrder.shippingFee,totalPointsForThisPurchase:pendingOrder.totalPointsForThisPurchase,paymentProofFile:base64File.split(",")[1],paymentProofMimeType:proofFile.type,paymentProofFileName:`${pendingOrder.customerEmail.split("@")[0]}-${Date.now()}`},response=await fetch(googleScriptURL,{method:"POST",body:JSON.stringify(payload)}),result=await response.json();if("success"===result.status)uploadStatusEl.textContent="Proof uploaded successfully!",uploadStatusEl.style.color="green",pendingOrder.proofUploaded=!0,sessionStorage.setItem("pendingOrder",JSON.stringify(pendingOrder)),updateVerificationUI();else throw new Error(result.message)}catch(error){uploadStatusEl.textContent=`Error: ${error.message}`,uploadStatusEl.style.color="red",uploadBtn.disabled=!1}}
    
    async function finalizeOrder(){const codeInput=document.getElementById("verification-code").value.trim().toUpperCase(),finalizeBtn=document.getElementById("finalize-order-btn"),verificationStatusEl=document.getElementById("verification-status");let pendingOrder=JSON.parse(sessionStorage.getItem("pendingOrder"));if(!codeInput)return verificationStatusEl.textContent="Please enter the verification code.",void(verificationStatusEl.style.color="red");if(!pendingOrder)return verificationStatusEl.textContent="Error: No pending order found.",void(verificationStatusEl.style.color="red");finalizeBtn.disabled=!0,verificationStatusEl.textContent="Verifying...",verificationStatusEl.style.color="blue";try{const payload={action:"finalizeOrder",usedCode:codeInput,customerName:pendingOrder.customerName,customerEmail:pendingOrder.customerEmail,customerPhone:pendingOrder.customerPhone,customerAddress:pendingOrder.customerAddress,cart:pendingOrder.cart,totalAmount:pendingOrder.totalAmount,shippingFee:pendingOrder.shippingFee,discountApplied:pendingOrder.discountApplied,discountCodeUsed:pendingOrder.discountCodeUsed,totalPointsForThisPurchase:pendingOrder.totalPointsForThisPurchase},response=await fetch(googleScriptURL,{method:"POST",body:JSON.stringify(payload)}),result=await response.json();if("success"===result.status){verificationStatusEl.textContent="Order Verified! Your receipt is downloading...";verificationStatusEl.style.color="green";const downloadLink=document.createElement("a");downloadLink.href=result.receiptUrl.replace("/file/d/","/uc?export=download&id=").replace("/view?usp=drivesdk",""),downloadLink.download=`Receipt-Order-${(new Date).getTime()}.pdf`,document.body.appendChild(downloadLink),downloadLink.click(),document.body.removeChild(downloadLink),cart=[],sessionStorage.removeItem("pendingOrder"),updateCartCount(),appliedDiscount=null,document.getElementById('discount-code-input').value="",document.getElementById('discount-status').textContent="",setTimeout(()=>{toggleCart(!0),updateVerificationUI(!0)},4e3)}else throw new Error(result.message)}catch(error){verificationStatusEl.textContent=`Error: ${error.message}`,verificationStatusEl.style.color="red",finalizeBtn.disabled=!1}}
    
    function updateVerificationUI(reset=!1){const proofStepEl=document.getElementById("proof-upload-step"),codeStepEl=document.getElementById("code-verification-step"),uploadBtn=document.getElementById("upload-proof-btn"),finalizeBtn=document.getElementById("finalize-order-btn"),codeInput=document.getElementById("verification-code"),uploadStatusEl=document.getElementById("upload-status"),verificationStatusEl=document.getElementById("verification-status");if(reset)return proofStepEl.classList.add("active"),proofStepEl.classList.remove("completed"),codeStepEl.classList.remove("active"),uploadBtn.disabled=!1,finalizeBtn.disabled=!0,codeInput.disabled=!0,uploadStatusEl.textContent="",verificationStatusEl.textContent="",document.getElementById("payment-proof-upload").value="",void(codeInput.value="");const pendingOrder=JSON.parse(sessionStorage.getItem("pendingOrder"));pendingOrder&& (pendingOrder.proofUploaded?(proofStepEl.classList.remove("active"),proofStepEl.classList.add("completed"),codeStepEl.classList.add("active"),uploadBtn.disabled=!0,finalizeBtn.disabled=!1,codeInput.disabled=!1,uploadStatusEl.textContent="Proof Uploaded Successfully!",uploadStatusEl.style.color="green"):(proofStepEl.classList.add("active"),proofStepEl.classList.remove("completed"),codeStepEl.classList.remove("active"),uploadBtn.disabled=!1,finalizeBtn.disabled=!0,codeInput.disabled=!0))}
    
    function cancelVerification(){confirm("Are you sure you want to cancel? This will remove your pending order and you will have to start over.")&&(sessionStorage.removeItem("pendingOrder"),toggleCart(!0),updateVerificationUI(!0))}
    function toggleCart(forceClose=!1){const modal=document.getElementById("cart-modal");if(forceClose)return void(modal.style.display="none");if("flex"===modal.style.display)modal.style.display="none";else{modal.style.display="flex";const pendingOrder=JSON.parse(sessionStorage.getItem("pendingOrder"));pendingOrder?(document.getElementById("cart-view").style.display="none",document.getElementById("verification-view").style.display="block",updateVerificationUI()):(document.getElementById("cart-view").style.display="block",document.getElementById("verification-view").style.display="none",updateCartDisplay(),updateVerificationUI(!0))}}
    function getBase64(file){return new Promise((resolve,reject)=>{const reader=new FileReader;reader.readAsDataURL(file),reader.onload=()=>resolve(reader.result),reader.onerror=error=>reject(error)})}
    function filterProducts(){const query=document.getElementById("product-search").value.toLowerCase();document.querySelectorAll(".product").forEach(productCard=>{const productName=productCard.querySelector("h3").textContent.toLowerCase();productCard.style.display=productName.includes(query)?"flex":"none"})}
    
    function suggestProduct(){const symptom=document.getElementById("symptom-input").value.toLowerCase().trim(),resultContainer=document.getElementById("suggestion-result");if(!symptom)return void(resultContainer.innerHTML='<p style="color:red">Please enter a symptom or health concern.</p>');const suggestionMap={'digestion':{keywords:['digestion','stomach','tummy','bloated','indigestion','constipation'],ids:[1,2,3,7,11,18]},'immune':{keywords:['immune','sick','flu','cold','cough','fever','infection'],ids:[1,2,14,15,17]},'energy':{keywords:['energy','tired','fatigue','stamina','lethargic','weak'],ids:[12,13,15,8]},'weight':{keywords:['weight','diet','slim','lose weight','kurus'],ids:[4,5,6,7]},'skin':{keywords:['skin','dry','acne','eczema','sunburn','aging','wrinkles','kulit'],ids:[30,32,29,39,52,24,21,22,31,38,41]},'joint':{keywords:['joint','muscle','pain','sore','arthritis','sakit','otot'],ids:[34,16,33]},'heart':{keywords:['heart','cholesterol','blood pressure','jantung'],ids:[16]},'bone':{keywords:['bone','calcium','osteoporosis','tulang'],ids:[19]},'headache':{keywords:['headache','migraine','pening','sakit kepala'],ids:[33]}},suggestedIds=new Set,inputWords=symptom.split(" ");inputWords.forEach(word=>{for(const key in suggestionMap)suggestionMap[key].keywords.includes(word)&&suggestionMap[key].ids.forEach(id=>suggestedIds.add(id))});if(suggestedIds.size>0){let html="<h4>Based on your concern, we suggest:</h4>";[...suggestedIds].slice(0,3).forEach(id=>{const product=products.find(p=>p.id===id),promo=activePromotions.find(p=>p.productIDs.includes(id));let finalPrice=product.price;"PERCENT"===promo?.type?finalPrice=product.price*(1-parseFloat(promo.value)/100):"FIXED"===promo?.type&&(finalPrice=product.price-parseFloat(promo.value)),html+=`<div class="suggestion-product"><span><strong>${product.name}</strong> - ${product.benefits.split(",")[0]}</span><button class="btn btn-primary" style="width:auto;padding:8px 15px" onclick="addToCart(${product.id}, ${finalPrice});toggleCart()">Add</button></div>`}),resultContainer.innerHTML=html}else resultContainer.innerHTML="<p>We could not find a specific match. Try searching for products directly.</p>"}
    
    function sendFeedbackEmail(event) {
        event.preventDefault(); 
        const submitBtn = document.getElementById('feedback-submit-btn');
        const statusEl = document.getElementById('feedback-status');

        const serviceID = 'YOUR_SERVICE_ID';
        const templateID = 'YOUR_TEMPLATE_ID';
        const userID = 'YOUR_USER_ID';

        if (serviceID === 'YOUR_SERVICE_ID' || templateID === 'YOUR_TEMPLATE_ID' || userID === 'YOUR_USER_ID') {
            statusEl.textContent = "Feedback form is not configured. Please contact owner directly.";
            statusEl.style.color = "red";
            return;
        }

        submitBtn.disabled = true;
        statusEl.textContent = "Sending...";
        statusEl.style.color = "blue";

        const templateParams = {
            from_name: document.getElementById('feedback-name').value,
            from_email: document.getElementById('feedback-email').value,
            subject: document.getElementById('feedback-subject').value,
            message: document.getElementById('feedback-message').value
        };

        emailjs.send(serviceID, templateID, templateParams)
            .then(function(response) {
               statusEl.textContent = "Thank you! Your message has been sent successfully.";
               statusEl.style.color = "green";
               submitBtn.disabled = false;
               event.target.reset(); 
            }, function(error) {
               statusEl.textContent = "Error: Could not send message. Please try again later.";
               statusEl.style.color = "red";
               submitBtn.disabled = false;
               console.log('EMAILJS FAILED...', error);
            });
    }

</script>
</body>
</html>
