<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forever Living by Mohd Arvinsd Isa - Grand Opening Special</title>
  
  <!-- Google Fonts & Font Awesome Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #1a5276;
      --secondary-color: #f39c12;
      --accent-color: #27ae60;
      --light-gray: #f4f6f8;
      --dark-text: #333;
      --light-text: #fff;
      --border-radius: 12px;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      --font-family: 'Poppins', sans-serif;
    }

    /* --- Keyframes for Animations --- */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes promoGlow {
      0% { box-shadow: 0 0 5px rgba(39, 174, 96, 0.5); }
      50% { box-shadow: 0 0 20px rgba(39, 174, 96, 0.8); }
      100% { box-shadow: 0 0 5px rgba(39, 174, 96, 0.5); }
    }

    /* --- Base Styles --- */
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: var(--font-family);
      margin: 0;
      padding: 0;
      background-color: var(--light-gray);
      color: var(--dark-text);
      overflow-x: hidden;
      line-height: 1.6;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    h1, h2, h3, h4 { color: var(--primary-color); font-weight: 600; }

    /* --- Header & Navigation --- */
    header {
      background-color: var(--light-text);
      padding: 20px 0;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
      position: relative;
    }
    .header-account-links {
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
    }
    .header-account-links a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
    }
    .header-account-links a:hover { color: var(--accent-color); }

    nav {
      background-color: var(--primary-color);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    nav ul { display: flex; list-style: none; padding: 10px 0; margin: 0; justify-content: center; flex-wrap: wrap; }
    nav a { color: var(--light-text); text-decoration: none; font-weight: 600; padding: 10px 20px; display: inline-block; position: relative; transition: color 0.3s; cursor: pointer; }
    nav a::after { content: ''; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); width: 0; height: 2px; background-color: var(--secondary-color); transition: width 0.3s; }
    nav a:hover { color: #f1c40f; }
    nav a:hover::after { width: 60%; }

    /* --- Tab Content & Hero --- */
    .tab-content { display: none; padding: 20px 0; }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    .hero-section {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: var(--light-text);
      padding: 60px 20px;
      text-align: center;
      border-radius: var(--border-radius);
      margin-bottom: 30px;
    }
    .hero-section h2 { color: var(--light-text); }
    .hero-section .promo-period {
        background-color: rgba(255, 255, 255, 0.15);
        padding: 10px 20px;
        border-radius: 50px;
        display: inline-block;
        font-weight: 600;
    }

    /* --- Product List & Cards --- */
    .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
    .product {
      background: var(--light-text);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      position: relative;
      transition: all 0.3s ease;
      overflow: hidden;
    }
    .product:hover { transform: translateY(-8px); box-shadow: 0 10px 25px rgba(0,0,0,0.12); }
    .product.promo-highlight { animation: promoGlow 2.5s infinite ease-in-out; }
    .product-image-container { height: 220px; padding: 15px; display: flex; align-items: center; justify-content: center; }
    .product img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .product-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; text-align: left; }
    .product h3 { margin: 0 0 10px; font-size: 1.25rem; height: 3.75rem; overflow: hidden; }
    .product .benefits { font-size: 0.85rem; color: #555; margin: 10px 0; flex-grow: 1; }
    .product .consumption { font-size: 0.85rem; color: var(--primary-color); font-style: italic; margin: 10px 0; }
    .price-section { margin: 15px 0; text-align: center; }
    .original-price { text-decoration: line-through; color: #999; font-size: 1rem; margin-right: 10px; }
    .new-price { color: var(--secondary-color); font-weight: bold; font-size: 1.5rem; }
    .product-points { font-size: 0.9rem; font-weight: 600; color: var(--accent-color); text-align: center; margin-top: 10px; }
    .product-actions { margin-top: auto; display: flex; flex-direction: column; gap: 10px; }
    .btn {
        display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; padding: 12px 15px; border-radius: 50px; text-decoration: none;
        font-weight: bold; border: none; cursor: pointer; transition: all 0.3s;
    }
    .btn-primary { background: var(--primary-color); color: var(--light-text); }
    .btn-primary:hover { background: #123e5a; transform: scale(1.05); }
    .btn-secondary { background: var(--light-gray); color: var(--primary-color); border: 1px solid var(--primary-color); }
    .btn-secondary:hover { background: #e0e0e0; }
    .featured-badge {
      position: absolute; top: 15px; right: -40px; background: var(--secondary-color);
      color: white; padding: 5px 40px; transform: rotate(45deg);
      font-weight: bold; font-size: 0.9rem; box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    /* --- Rewards Section --- */
    .rewards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .reward-item { background: var(--light-gray); border: 1px solid #ddd; border-radius: var(--border-radius); padding: 20px; text-align: center; display: flex; flex-direction: column; }
    .reward-item img { max-width: 100%; height: 100px; object-fit: contain; margin-bottom: 15px; border-radius: 8px; }
    .reward-item h4 { margin: 10px 0 5px; }
    .reward-item .points-cost { font-weight: bold; color: var(--accent-color); margin-bottom: 15px; }
    .reward-item .btn { margin-top: auto; }
    .reward-item .btn:disabled { background-color: #ccc; cursor: not-allowed; }

    /* --- Login & User Dashboard --- */
    #auth-page, #dashboard-page { display: none; }
    .dashboard-layout { display: flex; gap: 30px; align-items: flex-start; margin-top: 30px; }
    .dashboard-nav { flex: 0 0 250px; }
    .dashboard-nav a { display: block; background: var(--light-text); border: 1px solid #ddd; padding: 15px 20px; border-radius: 8px; text-decoration: none; color: var(--primary-color); font-weight: 600; margin-bottom: 10px; cursor: pointer; }
    .dashboard-nav a.active { background: var(--primary-color); color: var(--light-text); border-color: var(--primary-color); }
    .dashboard-content { flex-grow: 1; background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
    .user-tab-content { display: none; }
    .user-tab-content.active { display: block; animation: fadeIn 0.5s; }
    .form-container { max-width: 500px; margin: 40px auto; padding: 30px; background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); }
    .form-container input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; }
    .history-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .history-table th, .history-table td { padding: 12px; border: 1px solid #ddd; text-align: left; }
    .history-table th { background-color: var(--primary-color); color: white; }

    /* --- Floating Cart Button --- */
    .floating-cart-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background-color: var(--primary-color);
        color: var(--light-text);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        cursor: pointer;
        z-index: 1000;
        transition: transform 0.3s ease;
    }
    .floating-cart-btn:hover { transform: scale(1.1); }
    #cart-count {
        position: absolute;
        top: -2px;
        right: -2px;
        background-color: var(--secondary-color);
        color: var(--light-text);
        border-radius: 50%;
        padding: 3px 8px;
        font-size: 0.8rem;
        font-weight: bold;
        border: 2px solid var(--light-text);
    }

    /* --- Modal & Cart Styles --- */
    .modal {
      display: none; position: fixed; z-index: 1001; left: 0; top: 0;
      width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
      align-items: center; justify-content: center; animation: fadeIn 0.4s ease;
    }
    .modal-content {
      background-color: #fefefe; padding: 30px; border-radius: var(--border-radius);
      width: 90%; max-width: 600px; animation: slideIn 0.4s ease;
    }
    .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s; }
    .close:hover { color: black; }
    #cart-items { max-height: 250px; overflow-y: auto; padding-right: 10px; border-bottom: 1px solid #eee; margin-bottom: 15px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; }
    .cart-item-details { flex-grow: 1; }
    .quantity-controls { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
    .quantity-btn {
        width: 28px; height: 28px; background: var(--light-gray); border: 1px solid #ccc;
        border-radius: 50%; cursor: pointer; font-weight: bold;
    }
    .quantity-display { font-weight: 600; min-width: 20px; text-align: center; }
    .remove-item-btn { font-size: 1.2rem; color: #cc0000; cursor: pointer; margin-left: 15px; }
    .cart-summary { margin-top: 20px; font-size: 1.1rem; }
    .summary-line { display: flex; justify-content: space-between; padding: 8px 0; }
    .summary-line.total { font-weight: bold; font-size: 1.3rem; border-top: 2px solid #333; margin-top: 10px; }
    .points-earned {
        background-color: #fff3cd; color: #856404; padding: 10px;
        border-radius: 8px; text-align: center; margin-top: 15px; font-weight: bold;
    }
    .guest-remark {
        background-color: #f8d7da; color: #721c24; padding: 10px;
        border-radius: 8px; text-align: center; margin-top: 15px; font-weight: bold;
    }
    .free-shipping-promo {
        background-color: #e0f2f1; color: var(--accent-color); padding: 10px;
        border-radius: 8px; text-align: center; margin-top: 20px; font-weight: bold;
    }
    .checkout-btn { width: 100%; margin-top: 15px; }
    
    /* --- Footer & Disclaimer --- */
    footer { background: var(--primary-color); color: var(--light-text); padding: 40px 20px; text-align: center; margin-top: 30px; }
    .disclaimer {
        margin-top: 10px;
        background-color: #fff3cd;
        color: #856404;
        padding: 15px;
        border-top: 1px solid #ffeeba;
    }
  </style>
</head>
<body>

<div id="store-wrapper">
  <header>
    <div class="container">
        <h1>
          FOREVER LIVING by Mohd Arvind Isa
          <span style="font-size: 1rem; color: #555; display: block; font-weight: 400;">Quality Wellness Products</span>
        </h1>
        <div class="header-account-links">
            <a id="account-link" onclick="showAuthPage()">Login</a>
        </div>
    </div>
  </header>

  <nav>
    <div class="container">
        <ul id="main-nav">
          <li><a onclick="showTab('products')">Products</a></li>
          <li><a onclick="showTab('cds')">Cabaran Detox Sihat</a></li>
          <li><a onclick="showTab('business')">Business Opportunity</a></li>
          <li><a onclick="showTab('rewards')">Rewards</a></li>
        </ul>
    </div>
  </nav>

  <main id="main-content" class="container">
    <div id="products" class="tab-content active">
      <section class="hero-section">
        <h2><i class="fa-solid fa-gift"></i> GRAND OPENING SPECIAL</h2>
        <p>Enjoy 5% OFF on our top 10 bestselling products!</p>
        <div class="promo-period">
            Promotion Period: 21/7/2025 - 24/8/2025
        </div>
      </section>
      <div id="product-list" class="product-list"></div>
    </div>
    <div id="cds" class="tab-content">
      <section class="program-section"><h2>Cabaran Detox Sihat (CDS)</h2></section>
    </div>
    <div id="business" class="tab-content">
      <section class="program-section"><h2>Build Your Forever Business</h2></section>
    </div>
    <div id="rewards" class="tab-content">
        <section class="program-section">
            <h2><i class="fa-solid fa-award"></i> Redeem Your Points</h2>
            <div class="rewards-grid">
                <div class="reward-item">
                    <img src="https://i.imgur.com/O9yP2aH.png" alt="RM 5 Voucher">
                    <h4>RM 5 Voucher</h4>
                    <p class="points-cost">500 Points</p>
                    <button class="btn btn-primary redeem-btn">Redeem</button>
                </div>
                <div class="reward-item">
                    <img src="https://i.imgur.com/sY2a2qG.png" alt="RM 10 Voucher">
                    <h4>RM 10 Voucher</h4>
                    <p class="points-cost">1000 Points</p>
                    <button class="btn btn-primary redeem-btn">Redeem</button>
                </div>
                <div class="reward-item">
                    <img src="https://i.imgur.com/Jz4Y8fW.png" alt="RM 20 Voucher">
                    <h4>RM 20 Voucher</h4>
                    <p class="points-cost">2000 Points</p>
                    <button class="btn btn-primary redeem-btn">Redeem</button>
                </div>
            </div>
        </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>Â© 2025 Forever Living by Mohd Arvind Isa. Powered by Rich Academy Global. All rights reserved.</p>
      <div class="timestamp">Last updated: <span id="current-date"></span></div>
      <section class="disclaimer">
        <strong>Disclaimer:</strong> This website is operated by an independent Registered Forever Business Owner (FBO) under Rich Academy Global and is not the official site of Forever Living Products. Product names, trademarks, and registered trademarks are property of Forever Living Products International, Inc.
      </section>
    </div>
  </footer>
</div>

<div id="auth-page">
    <div class="form-container">
        <div id="login-form-container">
            <h2>Login to Your Account</h2>
            <input type="email" id="login-email" placeholder="Email Address">
            <input type="password" id="login-password" placeholder="Password">
            <button class="btn btn-primary" onclick="login()">Login</button>
            <p style="margin-top: 20px; font-size: 0.9rem;">Don't have an account? <a href="#" onclick="toggleAuthForms()">Register here</a></p>
        </div>
        <div id="register-form-container" style="display: none;">
            <h2>Create a New Account</h2>
            <input type="text" id="register-name" placeholder="Full Name">
            <input type="email" id="register-email" placeholder="Email Address">
            <input type="password" id="register-password" placeholder="Password">
            <button class="btn btn-primary" onclick="registerUser()">Register</button>
            <p style="margin-top: 20px; font-size: 0.9rem;">Already have an account? <a href="#" onclick="toggleAuthForms()">Login here</a></p>
        </div>
        <button class="btn btn-secondary" style="margin-top: 20px;" onclick="showStorePage()">Continue as Guest</button>
    </div>
</div>

<div id="dashboard-page">
    <header>
        <div class="container">
            <h1>My Account</h1>
            <div class="header-account-links">
                <a onclick="logout()">Logout</a>
            </div>
        </div>
    </header>
    <div class="container dashboard-layout">
        <nav class="dashboard-nav">
            <a href="#" class="active" onclick="showUserTab('profile', this)">My Profile</a>
            <a href="#" onclick="showUserTab('update-profile', this)">Update Profile</a>
            <a href="#" onclick="showUserTab('purchase-history', this)">Purchase History</a>
            <a href="#" onclick="showUserTab('points-history', this)">Points History</a>
            <a href="#" onclick="showUserTab('wishlist', this)">My Wishlist</a>
        </nav>
        <div class="dashboard-content">
            <div id="profile" class="user-tab-content active">
                <h3>Personal Details</h3>
                <p><strong>Name:</strong> <span id="dash-name"></span></p>
                <p><strong>Email:</strong> <span id="dash-email"></span></p>
                <p><strong>Phone:</strong> <span id="dash-phone"></span></p>
                <p><strong>Total Points:</strong> <span id="dash-points"></span></p>
            </div>
            <div id="update-profile" class="user-tab-content">
                <h3>Update Your Profile</h3>
                <input type="text" id="update-name" placeholder="Full Name">
                <input type="tel" id="update-phone" placeholder="Phone Number">
                <button class="btn btn-primary" onclick="updateProfile()">Save Changes</button>
            </div>
            <div id="purchase-history" class="user-tab-content">
                <h3>Purchase History</h3>
                <table class="history-table">
                    <thead><tr><th>Order ID</th><th>Date</th><th>Total</th><th>Status</th></tr></thead>
                    <tbody id="dash-purchase-history"></tbody>
                </table>
            </div>
            <div id="points-history" class="user-tab-content">
                <h3>Points History</h3>
                <table class="history-table">
                    <thead><tr><th>Date</th><th>Description</th><th>Points</th></tr></thead>
                    <tbody id="dash-points-history"></tbody>
                </table>
            </div>
            <div id="wishlist" class="user-tab-content">
                <h3>My Wishlist</h3>
                <div id="dash-wishlist" class="product-list"></div>
            </div>
        </div>
    </div>
</div>

  <!-- Floating Cart Button -->
  <div id="floating-cart" class="floating-cart-btn" onclick="toggleCart()">
    <i class="fa-solid fa-cart-shopping"></i>
    <span id="cart-count">0</span>
  </div>

  <!-- Cart Modal -->
  <div id="cart-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="toggleCart()">Ã—</span>
      <h2>Your Shopping Cart</h2>
      <div id="cart-items"><p>Your cart is currently empty.</p></div>
      <div class="cart-summary">
        <div class="summary-line"><span>Subtotal</span><span id="cart-subtotal">RM 0.00</span></div>
        <div class="summary-line"><span>Shipping</span><span id="cart-shipping">RM 0.00</span></div>
        <div class="summary-line total"><span>Total</span><span id="cart-total">RM 0.00</span></div>
      </div>
      <div id="points-container"></div>
      <div class="customer-info-form">
        <h3 style="margin-top: 20px;">Customer Information</h3>
        <input type="text" id="customer-name" placeholder="Your Full Name" required>
        <input type="tel" id="customer-phone" placeholder="Your WhatsApp Number" required>
        <button class="btn btn-primary checkout-btn" onclick="checkout()">Complete Order via WhatsApp</button>
      </div>
      <div class="free-shipping-promo">ðŸšš FREE NATIONWIDE DELIVERY for orders RM 250 and above!</div>
    </div>
  </div>

  <script>
    // --- DATA (Restored to full list) ---
    const products = [
      { id: 1, name: "Aloe Vera Gel", price: 116.79, image: "aloe-vera-gel.jpg", benefits: "Supports digestion, boosts immunity, promotes skin health, enhances nutrient absorption, helps detoxify the body.", consumption: "Take 30-60ml daily, preferably on empty stomach.", bestSeller: true, grandOpeningSpecial: true },
      { id: 2, name: "Aloe Berry Nectar", price: 116.79, image: "aloe-berry-nectar.jpg", benefits: "Antioxidant support, immune system booster, natural energy, supports urinary health, rich in vitamin C.", consumption: "30-60ml daily, can be mixed with water or juice.", bestSeller: true, grandOpeningSpecial: true },
      { id: 3, name: "Bee Honey", price: 132.57, image: "bee-honey.jpg", benefits: "Natural energy, soothes throat, antioxidant properties, supports digestion, promotes wound healing.", consumption: "1-2 teaspoons daily, can be added to drinks.", bestSeller: true, grandOpeningSpecial: true },
      { id: 4, name: "Royal Jelly", price: 139.21, image: "royal-jelly.jpg", benefits: "Energy booster, supports immune system, anti-aging, hormone balance, supports skin renewal.", consumption: "1 tablet daily, preferably in the morning.", bestSeller: true, grandOpeningSpecial: true },
      { id: 5, name: "Bee Propolis", price: 139.21, image: "bee-propolis.jpg", benefits: "Immune support, natural antibiotic, throat health, anti-inflammatory, promotes oral health.", consumption: "1 tablet daily or as needed.", bestSeller: true, grandOpeningSpecial: true },
      { id: 6, name: "Arctic Sea", price: 130.10, image: "arctic-sea.jpg", benefits: "Heart health, joint support, brain function, supports vision, reduces inflammation.", consumption: "2 softgels twice daily with meals.", bestSeller: true, grandOpeningSpecial: true },
      { id: 7, name: "Fields of Greens", price: 86.10, image: "fields-of-greens.jpg", benefits: "Detoxification, digestion, alkalizing, supports weight management, rich in chlorophyll.", consumption: "1 tablet 3 times daily with water.", bestSeller: true, grandOpeningSpecial: true },
      { id: 8, name: "Aloe First", price: 93.40, image: "aloe-first.jpg", benefits: "Skin hydration, cooling relief, wound soothing, relieves sunburn, pre-hair treatment spray.", consumption: "Spray directly on skin as needed.", bestSeller: true, grandOpeningSpecial: true },
      { id: 9, name: "Aloe Propolis Creme", price: 92.08, image: "aloe-propolis-creme.jpg", benefits: "Skin repair, moisturizing, protective barrier, soothes irritated skin, supports healing of minor cuts.", consumption: "Apply generously on dry or irritated areas.", bestSeller: true, grandOpeningSpecial: true },
      { id: 10, name: "Forever Bright Toothgel", price: 31.62, image: "bright-toothgel.jpg", benefits: "Fluoride-free, fresh breath, aloe-based care, gentle on gums, whitens teeth naturally.", consumption: "Brush teeth twice daily.", bestSeller: true, grandOpeningSpecial: true },
      { id: 11, name: "Aloe Peaches", price: 116.79, image: "aloe-peaches.jpg", benefits: "Digestive health, vitamin C source, natural detoxification, maintains healthy skin, supports kidney function.", consumption: "30-60ml daily, refrigerate after opening." },
      { id: 12, name: "Bee Pollen", price: 75.50, image: "bee-pollen.jpg", benefits: "Natural multivitamin, energy enhancement, allergy relief, improves stamina, supports cardiovascular health.", consumption: "1 tablet 3 times daily with meals." },
      { id: 13, name: "Absorbent-C", price: 75.50, image: "absorbent-c.jpg", benefits: "Immune support, collagen production, antioxidant, helps iron absorption, supports healthy skin.", consumption: "1-2 tablets daily with meals." },
      { id: 14, name: "Calcium Plus", price: 132.15, image: "calcium-plus.jpg", benefits: "Bone support, muscle health, calcium + vitamin D, supports nerve function, helps prevent osteoporosis.", consumption: "2 tablets daily with meals." },
      { id: 15, name: "Aloe Liquid Soap", price: 54.72, image: "aloe-liquid-soap.jpg", benefits: "Gentle cleansing, moisturizes skin, aloe-based formula, suitable for sensitive skin, pH-balanced.", consumption: "Use daily for face and body cleansing." },
      { id: 16, name: "Aloe Jojoba Shampoo", price: 91.66, image: "aloe-jojoba-shampoo.jpg", benefits: "Hair nourishment, scalp care, sulfate-free, promotes hair strength, natural shine.", consumption: "Massage into wet hair, rinse thoroughly." },
      { id: 17, name: "Aloe Jojoba Conditioner", price: 91.66, image: "aloe-jojoba-conditioner.jpg", benefits: "Moisturizing, smooth finish, aloe + jojoba, strengthens hair strands, prevents breakage.", consumption: "Apply after shampoo, leave 1-2 minutes, rinse." },
      { id: 18, name: "Aloe Sunscreen", price: 84.91, image: "aloe-sunscreen.jpg", benefits: "UV protection, aloe-based, water-resistant, suitable for sensitive skin, prevents sunburn.", consumption: "Apply 15 minutes before sun exposure." },
      { id: 19, name: "Aloe MPD 2X Ultra", price: 114.47, image: "aloe-mp-lotion.jpg", benefits: "Multi-purpose cleaner, concentrated, eco-friendly, gentle on skin, biodegradable formula.", consumption: "Dilute as needed for laundry, dishes or surfaces." },
      { id: 20, name: "Avocado Face & Body Soap", price: 23.40, image: "avocado-soap.jpg", benefits: "Softens skin, gentle cleansing, avocado oil-rich, suitable for all skin types, non-drying.", consumption: "Use daily for face and body." },
      { id: 21, name: "Aloe Lips", price: 17.92, image: "aloe-lips.jpg", benefits: "Lip protection, moisturizes, healing balm, soothes cracked lips, non-greasy finish.", consumption: "Apply on lips as needed throughout the day." },
      { id: 22, name: "Forever Deodorant Stick", price: 34.91, image: "forever-deodorant.jpg", benefits: "Natural fragrance, aloe soothing, easy glide, long-lasting protection, non-staining.", consumption: "Use after shower daily." },
      { id: 23, name: "Teh Tarik Halia", price: 25.90, image: "teh-tarik.jpg", benefits: "Warming effect, digestion aid, ginger-infused, improves circulation, relieves bloating.", consumption: "Mix sachet with hot water and stir well." },
      { id: 24, name: "Choco Malt Drink", price: 27.90, image: "choco-malt.jpg", benefits: "Rich in B vitamins, iron for red blood cell production, supports metabolism, promotes growth, aids recovery after fatigue.", consumption: "Mix 2-3 tablespoons in 150â€“200ml hot water or milk." }
    ];
    let cart = [];

    // --- LOGIC (Updated) ---

    function applyGrandOpeningDiscount(products) {
      const discountRate = 0.05;
      return products.map(product => {
        if (product.grandOpeningSpecial) {
          return { ...product, originalPrice: product.price, price: product.price * (1 - discountRate) };
        }
        return product;
      });
    }

    function renderProducts() {
      const productList = document.getElementById('product-list');
      if (!productList) return;
      const discountedProducts = applyGrandOpeningDiscount(products);
      const isLoggedIn = !!sessionStorage.getItem('loggedInUser');
      
      productList.innerHTML = discountedProducts.map(product => {
        const isFeatured = product.grandOpeningSpecial;
        const hasDiscount = product.originalPrice !== undefined;
        const points = Math.floor(product.price);
        const wishlistBtn = isLoggedIn ? `<button class="btn btn-secondary" onclick="addToWishlist(${product.id})"><i class="fa-solid fa-heart"></i> Add to Wishlist</button>` : '';
        
        return `
          <div class="product ${isFeatured ? 'promo-highlight' : ''}">
            ${isFeatured ? '<div class="featured-badge">Offer!</div>' : ''}
            <div class="product-image-container"><img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/200x200?text=Image+Not+Found'"></div>
            <div class="product-info">
                <h3>${product.name}</h3>
                <div class="price-section">
                    ${hasDiscount ? `<span class="original-price">RM ${product.originalPrice.toFixed(2)}</span><span class="new-price">RM ${product.price.toFixed(2)}</span>` : `<span class="new-price">RM ${product.price.toFixed(2)}</span>`}
                </div>
                <div class="benefits"><strong>Benefits:</strong> ${product.benefits}</div>
                <div class="consumption"><strong>Usage:</strong> ${product.consumption}</div>
                <div class="product-points"><i class="fa-solid fa-star"></i> Earn ${points} Points</div>
                <div class="product-actions">
                    <button class="btn btn-primary" onclick="addToCart(${product.id})"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
                    ${wishlistBtn}
                </div>
            </div>
          </div>`;
      }).join('');
    }

    function showTab(tabId) {
      document.querySelectorAll('#main-content .tab-content').forEach(el => el.classList.remove('active'));
      const activeTab = document.getElementById(tabId);
      if(activeTab) activeTab.classList.add('active');
    }

    function toggleCart() {
      const modal = document.getElementById('cart-modal');
      modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
      if (modal.style.display === 'flex') updateCartDisplay();
    }

    function addToCart(productId) {
      const existingItem = cart.find(item => item.id === productId);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        const productData = products.find(p => p.id === productId);
        const discountedData = applyGrandOpeningDiscount([productData])[0];
        cart.push({ id: discountedData.id, name: discountedData.name, price: discountedData.price, quantity: 1 });
      }
      updateCartCount();
    }

    function increaseQuantity(productId) {
        const item = cart.find(p => p.id === productId);
        if (item) { item.quantity++; updateCartDisplay(); updateCartCount(); }
    }

    function decreaseQuantity(productId) {
        const item = cart.find(p => p.id === productId);
        if (item) {
            item.quantity--;
            if (item.quantity <= 0) removeItemFromCart(productId);
            else { updateCartDisplay(); updateCartCount(); }
        }
    }

    function removeItemFromCart(productId) {
        cart = cart.filter(p => p.id !== productId);
        updateCartDisplay();
        updateCartCount();
    }

    function calculateShipping(cart, subtotal) {
        if (subtotal >= 250) return { fee: 0, message: "FREE" };
        if (cart.length === 0) return { fee: 0, message: "RM 0.00" };
        const baseShipping = 14.00, reductionPerItem = 0.30;
        const finalFee = baseShipping * (1 - (reductionPerItem * (cart.length - 1)));
        const calculatedFee = Math.max(0, finalFee);
        return { fee: calculatedFee, message: `RM ${calculatedFee.toFixed(2)}` };
    }
    
    function updateCartDisplay() {
      const cartItemsEl = document.getElementById('cart-items');
      const subtotalEl = document.getElementById('cart-subtotal');
      const shippingEl = document.getElementById('cart-shipping');
      const totalEl = document.getElementById('cart-total');
      const pointsContainer = document.getElementById('points-container');
      
      if (cart.length === 0) {
        cartItemsEl.innerHTML = '<p>Your cart is empty</p>';
        subtotalEl.textContent = 'RM 0.00';
        shippingEl.textContent = 'RM 0.00';
        totalEl.textContent = 'RM 0.00';
        pointsContainer.innerHTML = '';
        return;
      }
      
      let itemsHTML = '';
      const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      
      cart.forEach(item => {
        itemsHTML += `
          <div class="cart-item">
            <div class="cart-item-details">
                <strong>${item.name}</strong>
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="decreaseQuantity(${item.id})">-</button>
                    <span class="quantity-display">${item.quantity}</span>
                    <button class="quantity-btn" onclick="increaseQuantity(${item.id})">+</button>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span>RM ${(item.price * item.quantity).toFixed(2)}</span>
                <span class="remove-item-btn" onclick="removeItemFromCart(${item.id})">Ã—</span>
            </div>
          </div>`;
      });
      
      const shipping = calculateShipping(cart, subtotal);
      const total = subtotal + shipping.fee;
      const points = Math.floor(subtotal);
      const isLoggedIn = !!sessionStorage.getItem('loggedInUser');

      cartItemsEl.innerHTML = itemsHTML;
      subtotalEl.textContent = `RM ${subtotal.toFixed(2)}`;
      shippingEl.textContent = shipping.message;
      totalEl.textContent = `RM ${total.toFixed(2)}`;
      
      if (isLoggedIn) {
          pointsContainer.innerHTML = `<div class="points-earned"><i class="fa-solid fa-star"></i> Points Earned: <span id="points-earned">${points}</span></div>`;
      } else {
          pointsContainer.innerHTML = `<div class="guest-remark">Register or login to earn points on this purchase!</div>`;
      }
    }

    function updateCartCount() {
      const count = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById('cart-count').textContent = count;
    }

    function checkout() {
      const name = document.getElementById('customer-name').value.trim();
      const phone = document.getElementById('customer-phone').value.trim();
      if (!name || !phone) { alert('Please enter your name and phone number'); return; }
      if (cart.length === 0) { alert('Your cart is empty'); return; }
      
      const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      const shipping = calculateShipping(cart, subtotal);
      const total = subtotal + shipping.fee;
      const points = Math.floor(subtotal);
      
      const loggedInUserEmail = sessionStorage.getItem('loggedInUser');
      if (loggedInUserEmail) {
          let users = JSON.parse(localStorage.getItem('users')) || [];
          const userIndex = users.findIndex(u => u.email === loggedInUserEmail);
          if (userIndex !== -1) {
              const newPurchase = { id: `#${Date.now().toString().slice(-4)}`, date: new Date().toLocaleDateString('en-GB'), total: total.toFixed(2), status: 'Processing' };
              const newPoints = { date: new Date().toLocaleDateString('en-GB'), description: `Order ${newPurchase.id}`, points: `+${points}` };
              users[userIndex].purchaseHistory.push(newPurchase);
              users[userIndex].pointsHistory.push(newPoints);
              users[userIndex].totalPoints += points;
              localStorage.setItem('users', JSON.stringify(users));
          }
      }

      let message = `Hi, I would like to place an order:\n\nName: ${name}\nPhone: ${phone}\n\n--- ORDER DETAILS ---\n`;
      cart.forEach(item => { message += `- ${item.name} (x${item.quantity}) - RM ${(item.price * item.quantity).toFixed(2)}\n`; });
      message += `\n--- SUMMARY ---\nSubtotal: RM ${subtotal.toFixed(2)}\nShipping: ${shipping.message}\nTOTAL: RM ${total.toFixed(2)}\n`;
      if (loggedInUserEmail) message += `Points Earned: ${points}\n\n`;
      message += `Please confirm my order. Thank you!`;
      
      window.open(`https://wa.me/601111033154?text=${encodeURIComponent(message)}`, '_blank');
      
      cart = [];
      updateCartCount();
      toggleCart();
    }

    function closeFestivalModal() {
      localStorage.setItem('festivalPopupClosed', 'true');
      document.getElementById('festival-modal').style.display = 'none';
    }

    // --- User Account Functions ---
    function showPage(pageId) {
        document.getElementById('store-wrapper').style.display = 'none';
        document.getElementById('auth-page').style.display = 'none';
        document.getElementById('dashboard-page').style.display = 'none';
        document.getElementById(pageId).style.display = 'block';
    }
    
    function showAuthPage() { showPage('auth-page'); }
    function showStorePage() { showPage('store-wrapper'); }
    function showDashboardPage() { showPage('dashboard-page'); }

    function toggleAuthForms() {
        const loginForm = document.getElementById('login-form-container');
        const registerForm = document.getElementById('register-form-container');
        loginForm.style.display = loginForm.style.display === 'none' ? 'block' : 'none';
        registerForm.style.display = registerForm.style.display === 'none' ? 'block' : 'none';
    }

    function registerUser() {
        const name = document.getElementById('register-name').value.trim();
        const email = document.getElementById('register-email').value.trim();
        const password = document.getElementById('register-password').value.trim();
        if (!name || !email || !password) { alert('Please fill in all fields.'); return; }

        let users = JSON.parse(localStorage.getItem('users')) || [];
        if (users.find(user => user.email === email)) { alert('An account with this email already exists.'); return; }

        users.push({ name, email, password, phone: '', totalPoints: 0, purchaseHistory: [], pointsHistory: [], redemptionHistory: [], myVouchers: [], wishlist: [] });
        localStorage.setItem('users', JSON.stringify(users));
        alert('Registration successful! Please login.');
        toggleAuthForms();
    }

    function login() {
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value.trim();
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const user = users.find(u => u.email === email && u.password === password);

        if (user) {
            sessionStorage.setItem('loggedInUser', user.email);
            document.getElementById('account-link').textContent = 'My Account';
            document.getElementById('account-link').setAttribute('onclick', 'showDashboardPage()');
            renderDashboard(user);
            showDashboardPage();
            renderProducts(); // Re-render to show wishlist buttons
            updateRedeemButtonsState();
        } else {
            alert('Invalid email or password.');
        }
    }

    function logout() {
        sessionStorage.removeItem('loggedInUser');
        document.getElementById('account-link').textContent = 'Login';
        document.getElementById('account-link').setAttribute('onclick', 'showAuthPage()');
        showStorePage();
        renderProducts(); // Re-render to hide wishlist buttons
        updateRedeemButtonsState();
    }

    function renderDashboard(user) {
        document.getElementById('dash-name').textContent = user.name;
        document.getElementById('dash-email').textContent = user.email;
        document.getElementById('dash-phone').textContent = user.phone || 'Not set';
        document.getElementById('dash-points').textContent = user.totalPoints;
        
        document.getElementById('update-name').value = user.name;
        document.getElementById('update-phone').value = user.phone || '';

        const purchaseHistoryBody = document.getElementById('dash-purchase-history');
        purchaseHistoryBody.innerHTML = user.purchaseHistory.length ? user.purchaseHistory.map(p => `<tr><td>${p.id}</td><td>${p.date}</td><td>RM ${p.total}</td><td>${p.status}</td></tr>`).join('') : '<tr><td colspan="4">No purchases yet.</td></tr>';

        const pointsHistoryBody = document.getElementById('dash-points-history');
        pointsHistoryBody.innerHTML = user.pointsHistory.length ? user.pointsHistory.map(p => `<tr><td>${p.date}</td><td>${p.description}</td><td style="color: green;">${p.points}</td></tr>`).join('') : '<tr><td colspan="3">No points history.</td></tr>';
        
        const wishlistContainer = document.getElementById('dash-wishlist');
        wishlistContainer.innerHTML = user.wishlist.length ? user.wishlist.map(productId => {
            const product = products.find(p => p.id === productId);
            return product ? `<div class="product"><h3>${product.name}</h3><img src="${product.image}" style="height:100px; object-fit:contain;"><button class="btn btn-primary" onclick="addToCart(${product.id}); toggleCart();">Add to Cart</button></div>` : '';
        }).join('') : '<p>Your wishlist is empty.</p>';
    }

    function updateProfile() {
        const loggedInUserEmail = sessionStorage.getItem('loggedInUser');
        if (!loggedInUserEmail) return;
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const userIndex = users.findIndex(u => u.email === loggedInUserEmail);

        if (userIndex !== -1) {
            users[userIndex].name = document.getElementById('update-name').value.trim();
            users[userIndex].phone = document.getElementById('update-phone').value.trim();
            localStorage.setItem('users', JSON.stringify(users));
            alert('Profile updated successfully!');
            renderDashboard(users[userIndex]);
            showUserTab('profile', document.querySelector('.dashboard-nav a'));
        }
    }

    function addToWishlist(productId) {
        const loggedInUserEmail = sessionStorage.getItem('loggedInUser');
        if (!loggedInUserEmail) { alert('Please login to add items to your wishlist.'); return; }
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const userIndex = users.findIndex(u => u.email === loggedInUserEmail);

        if (userIndex !== -1) {
            if (!users[userIndex].wishlist.includes(productId)) {
                users[userIndex].wishlist.push(productId);
                localStorage.setItem('users', JSON.stringify(users));
                alert('Item added to your wishlist!');
            } else {
                alert('This item is already in your wishlist.');
            }
        }
    }

    function showUserTab(tabId, element) {
        document.querySelectorAll('.user-tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('.dashboard-nav a').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }

    function updateRedeemButtonsState() {
        const isLoggedIn = !!sessionStorage.getItem('loggedInUser');
        document.querySelectorAll('.redeem-btn').forEach(btn => {
            btn.disabled = !isLoggedIn;
            btn.title = isLoggedIn ? "" : "You must be logged in to redeem.";
        });
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      renderProducts();
      showTab('products');
      updateRedeemButtonsState();
      if (localStorage.getItem('festivalPopupClosed') === 'true') {
        document.getElementById('festival-modal').style.display = 'none';
      }
    });
  </script>
</body>
</html>
