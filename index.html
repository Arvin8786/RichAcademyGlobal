<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forever Living by Mohd Arvinsd Isa - Grand Opening Special</title>
  
  <!-- Google Fonts & Font Awesome Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #1a5276;
      --secondary-color: #f39c12;
      --accent-color: #27ae60;
      --light-gray: #f4f6f8;
      --dark-text: #333;
      --light-text: #fff;
      --border-radius: 12px;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      --font-family: 'Poppins', sans-serif;
    }

    /* --- Keyframes for Animations --- */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes promoGlow {
      0% { box-shadow: 0 0 5px rgba(243, 156, 18, 0.6); }
      50% { box-shadow: 0 0 20px rgba(243, 156, 18, 0.9); }
      100% { box-shadow: 0 0 5px rgba(243, 156, 18, 0.6); }
    }
    @keyframes confetti-fall {
        0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* --- Base Styles --- */
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: var(--font-family);
      margin: 0;
      padding: 0;
      background-color: var(--light-gray);
      color: var(--dark-text);
      overflow-x: hidden;
      line-height: 1.6;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    h1, h2, h3, h4 { color: var(--primary-color); font-weight: 600; }

    /* --- Grand Opening Theme --- */
    body.grand-opening-active {
        background: linear-gradient(45deg, #fff1e7, #e6f7ff);
    }
    .grand-opening-active .hero-section {
        border: 4px dashed var(--secondary-color);
    }
    .confetti {
        position: fixed;
        width: 10px;
        height: 15px;
        opacity: 0.8;
        animation: confetti-fall 5s linear infinite;
        z-index: 9999;
        pointer-events: none;
    }
    #countdown-timer {
        background-color: rgba(0,0,0,0.2);
        padding: 15px 30px; /* Increased padding */
        border-radius: 50px;
        margin-top: 20px;
        display: inline-block;
        font-size: 1.8rem; /* Made bigger */
        font-weight: 700;
        color: #fff;
        border: 2px solid #fff;
    }

    /* --- Header & Navigation --- */
    header {
      background-color: var(--light-text);
      padding: 20px 0;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
      position: relative;
    }
    .header-account-links {
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
    }
    .header-account-links a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
    }
    .header-account-links a:hover { color: var(--accent-color); }

    nav {
      background-color: var(--primary-color);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    nav ul { display: flex; list-style: none; padding: 10px 0; margin: 0; justify-content: center; flex-wrap: wrap; }
    nav a { color: var(--light-text); text-decoration: none; font-weight: 600; padding: 10px 20px; display: inline-block; position: relative; transition: color 0.3s; cursor: pointer; }
    nav a::after { content: ''; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); width: 0; height: 2px; background-color: var(--secondary-color); transition: width 0.3s; }
    nav a:hover { color: #f1c40f; }
    nav a:hover::after { width: 60%; }

    /* --- Tab Content & Hero --- */
    .tab-content { display: none; padding: 20px 0; }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    .hero-section {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: var(--light-text);
      padding: 60px 20px;
      text-align: center;
      border-radius: var(--border-radius);
      margin-bottom: 30px;
    }
    .hero-section h2 { color: var(--light-text); }
    .hero-section .promo-period {
        background-color: rgba(255, 255, 255, 0.15);
        padding: 10px 20px;
        border-radius: 50px;
        display: inline-block;
        font-weight: 600;
    }

    /* --- Search & AI Suggestion --- */
    .search-container { margin-bottom: 30px; position: relative; }
    #product-search { width: 100%; padding: 15px 50px 15px 25px; border: 2px solid #ddd; border-radius: 50px; font-size: 1rem; outline: none; transition: all 0.3s; }
    #product-search:focus { border-color: var(--primary-color); box-shadow: 0 0 10px rgba(26, 82, 118, 0.2); }
    .search-icon { position: absolute; right: 25px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 1.2rem; }
    .ai-suggestion-box { background: var(--light-text); padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 30px; text-align: center; }
    #symptom-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin: 10px 0; }
    #suggest-btn { background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color: var(--light-text); border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; transition: all 0.3s; margin-top: 10px; }
    #suggest-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    #suggestion-result { margin-top: 20px; text-align: left; }
    .suggestion-product { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--accent-color); }

    /* --- Product List & Cards --- */
    .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
    .product {
      background: var(--light-text);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      position: relative;
      transition: all 0.3s ease;
      overflow: hidden;
    }
    .product:hover { transform: translateY(-8px); box-shadow: 0 10px 25px rgba(0,0,0,0.12); }
    .product.promo-highlight { animation: promoGlow 2.5s infinite ease-in-out; }
    .product-image-container { height: 220px; padding: 15px; display: flex; align-items: center; justify-content: center; }
    .product img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .product-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; text-align: left; }
    .product h3 { margin: 0 0 10px; font-size: 1.25rem; height: 3.75rem; overflow: hidden; }
    .product .benefits { font-size: 0.85rem; color: #555; margin: 10px 0; flex-grow: 1; }
    .product .consumption { font-size: 0.85rem; color: var(--primary-color); font-style: italic; margin: 10px 0; }
    .price-section { margin: 15px 0; text-align: center; }
    .original-price { text-decoration: line-through; color: #999; font-size: 1rem; margin-right: 10px; }
    .new-price { color: var(--secondary-color); font-weight: bold; font-size: 1.5rem; }
    .product-points { font-size: 0.9rem; font-weight: 600; color: var(--accent-color); text-align: center; margin-top: 10px; }
    .product-actions { margin-top: auto; display: flex; flex-direction: column; gap: 10px; }
    .btn {
        display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; padding: 12px 15px; border-radius: 50px; text-decoration: none;
        font-weight: bold; border: none; cursor: pointer; transition: all 0.3s;
    }
    .btn-primary { background: var(--primary-color); color: var(--light-text); }
    .btn-primary:hover { background: #123e5a; transform: scale(1.05); }
    .btn-secondary { background: var(--light-gray); color: var(--primary-color); border: 1px solid var(--primary-color); }
    .btn-secondary:hover { background: #e0e0e0; }
    .featured-badge {
      position: absolute; top: 15px; right: -40px; background: var(--secondary-color);
      color: white; padding: 5px 40px; transform: rotate(45deg);
      font-weight: bold; font-size: 0.9rem; box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    /* --- CDS & Business Sections --- */
    .program-section { background: var(--light-text); padding: 40px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 30px; }
    .program-section h2 { font-size: 2.5rem; text-align: center; }
    .program-highlights { display: flex; flex-wrap: wrap; justify-content: space-around; margin: 30px 0; gap: 20px; }
    .highlight-card { flex: 1; min-width: 280px; background: var(--light-gray); border: 1px solid #e0e0e0; border-radius: var(--border-radius); padding: 20px; transition: transform 0.3s, box-shadow 0.3s; }
    .highlight-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
    .highlight-card h3 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
    .highlight-card ul { list-style: none; padding: 0; }
    .highlight-card li { margin-bottom: 10px; display: flex; align-items: flex-start; }
    .highlight-card .fa-solid { color: var(--accent-color); margin-right: 10px; margin-top: 5px; }
    .testimonial { background: #f0f8f0; padding: 20px; border-left: 4px solid var(--accent-color); margin: 20px 0; font-style: italic; border-radius: 0 8px 8px 0; }
    .testimonial-author { text-align: right; font-weight: bold; color: var(--primary-color); }
    .cta-button { display: block; width: fit-content; margin: 30px auto; background: linear-gradient(135deg, var(--secondary-color), #e67e22); color: var(--light-text); text-align: center; padding: 15px 40px; border-radius: 50px; font-weight: bold; text-decoration: none; font-size: 1.2rem; transition: all 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .cta-button:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.3); }

    /* --- Rewards Section --- */
    .rewards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .reward-item { background: var(--light-gray); border: 1px solid #ddd; border-radius: var(--border-radius); padding: 20px; text-align: center; display: flex; flex-direction: column; }
    .reward-item img { max-width: 100%; height: 100px; object-fit: contain; margin-bottom: 15px; border-radius: 8px; }
    .reward-item h4 { margin: 10px 0 5px; }
    .reward-item .points-cost { font-weight: bold; color: var(--accent-color); margin-bottom: 15px; }
    .reward-item .btn { margin-top: auto; }
    .reward-item .btn:disabled { background-color: #ccc; cursor: not-allowed; }

    /* --- Login & User Dashboard --- */
    #auth-page, #dashboard-page { display: none; }
    .dashboard-layout { display: flex; gap: 30px; align-items: flex-start; margin-top: 30px; }
    .dashboard-nav { flex: 0 0 250px; }
    .dashboard-nav a { display: block; background: var(--light-text); border: 1px solid #ddd; padding: 15px 20px; border-radius: 8px; text-decoration: none; color: var(--primary-color); font-weight: 600; margin-bottom: 10px; cursor: pointer; }
    .dashboard-nav a.active { background: var(--primary-color); color: var(--light-text); border-color: var(--primary-color); }
    .dashboard-content { flex-grow: 1; background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
    .user-tab-content { display: none; }
    .user-tab-content.active { display: block; animation: fadeIn 0.5s; }
    .form-container { max-width: 500px; margin: 40px auto; padding: 30px; background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); }
    .form-container input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; }
    .history-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .history-table th, .history-table td { padding: 12px; border: 1px solid #ddd; text-align: left; }
    .history-table th { background-color: var(--primary-color); color: white; }

    /* --- Floating Cart Button --- */
    .floating-cart-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background-color: var(--primary-color);
        color: var(--light-text);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        cursor: pointer;
        z-index: 1000;
        transition: transform 0.3s ease;
    }
    .floating-cart-btn:hover { transform: scale(1.1); }
    #cart-count {
        position: absolute;
        top: -2px;
        right: -2px;
        background-color: var(--secondary-color);
        color: var(--light-text);
        border-radius: 50%;
        padding: 3px 8px;
        font-size: 0.8rem;
        font-weight: bold;
        border: 2px solid var(--light-text);
    }

    /* --- Modal & Cart Styles --- */
    .modal {
      display: none; position: fixed; z-index: 1001; left: 0; top: 0;
      width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
      align-items: center; justify-content: center; animation: fadeIn 0.4s ease;
    }
    .modal-content {
      background-color: #fefefe; padding: 30px; border-radius: var(--border-radius);
      width: 90%; max-width: 600px; animation: slideIn 0.4s ease;
    }
    .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s; }
    .close:hover { color: black; }
    #cart-items { max-height: 250px; overflow-y: auto; padding-right: 10px; border-bottom: 1px solid #eee; margin-bottom: 15px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; }
    .cart-item-details { flex-grow: 1; }
    .quantity-controls { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
    .quantity-btn {
        width: 28px; height: 28px; background: var(--light-gray); border: 1px solid #ccc;
        border-radius: 50%; cursor: pointer; font-weight: bold;
    }
    .quantity-display { font-weight: 600; min-width: 20px; text-align: center; }
    .remove-item-btn { font-size: 1.2rem; color: #cc0000; cursor: pointer; margin-left: 15px; }
    .cart-summary { margin-top: 20px; font-size: 1.1rem; }
    .summary-line { display: flex; justify-content: space-between; padding: 8px 0; }
    .summary-line.total { font-weight: bold; font-size: 1.3rem; border-top: 2px solid #333; margin-top: 10px; }
    .points-earned {
        background-color: #fff3cd; color: #856404; padding: 10px;
        border-radius: 8px; text-align: center; margin-top: 15px; font-weight: bold;
    }
    .guest-remark {
        background-color: #f8d7da; color: #721c24; padding: 10px;
        border-radius: 8px; text-align: center; margin-top: 15px; font-weight: bold;
    }
    .free-shipping-promo {
        background-color: #e0f2f1; color: var(--accent-color); padding: 10px;
        border-radius: 8px; text-align: center; margin-top: 20px; font-weight: bold;
    }
    .checkout-btn { width: 100%; margin-top: 15px; }
    
    /* --- Footer & Disclaimer --- */
    footer { background: var(--primary-color); color: var(--light-text); padding: 40px 20px; text-align: center; margin-top: 30px; }
    .disclaimer {
        margin-top: 10px;
        background-color: #fff3cd;
        color: #856404;
        padding: 15px;
        border-top: 1px solid #ffeeba;
    }
  </style>
</head>
<body>

<div id="store-wrapper">
  <header>
    <div class="container">
        <h1>
          FOREVER LIVING by Mohd Arvind Isa
          <span style="font-size: 1rem; color: #555; display: block; font-weight: 400;">Quality Wellness Products</span>
        </h1>
        <div class="header-account-links">
            <a id="account-link" onclick="showAuthPage()">Login</a>
        </div>
    </div>
  </header>

  <nav>
    <div class="container">
        <ul id="main-nav">
          <li><a onclick="showTab('products')">Products</a></li>
          <li><a onclick="showTab('cds')">Cabaran Detox Sihat</a></li>
          <li><a onclick="showTab('business')">Business Opportunity</a></li>
          <li><a onclick="showTab('rewards')">Rewards</a></li>
        </ul>
    </div>
  </nav>

  <main id="main-content" class="container">
    <div id="products" class="tab-content active">
      <section class="hero-section">
        <h2><i class="fa-solid fa-gift"></i> GRAND OPENING SPECIAL</h2>
        <p>Enjoy special promotional prices on all our products!</p>
        <div id="promo-details">
            <div class="promo-period">
                Promotion Ends: 2 August 2025
            </div>
            <div id="countdown-timer"></div>
        </div>
      </section>
      <div id="product-list" class="product-list"></div>
    </div>
    <div id="cds" class="tab-content">
      <section class="program-section"><h2>Cabaran Detox Sihat (CDS)</h2></section>
    </div>
    <div id="business" class="tab-content">
      <section class="program-section"><h2>Build Your Forever Business</h2></section>
    </div>
    <div id="rewards" class="tab-content">
        <section class="program-section">
            <h2><i class="fa-solid fa-award"></i> Redeem Your Points</h2>
            <div class="rewards-grid">
                <div class="reward-item">
                    <img src="https://i.imgur.com/O9yP2aH.png" alt="RM 5 Voucher">
                    <h4>RM 5 Voucher</h4>
                    <p class="points-cost">500 Points</p>
                    <button class="btn btn-primary redeem-btn">Redeem</button>
                </div>
                <div class="reward-item">
                    <img src="https://i.imgur.com/sY2a2qG.png" alt="RM 10 Voucher">
                    <h4>RM 10 Voucher</h4>
                    <p class="points-cost">1000 Points</p>
                    <button class="btn btn-primary redeem-btn">Redeem</button>
                </div>
                <div class="reward-item">
                    <img src="https://i.imgur.com/Jz4Y8fW.png" alt="RM 20 Voucher">
                    <h4>RM 20 Voucher</h4>
                    <p class="points-cost">2000 Points</p>
                    <button class="btn btn-primary redeem-btn">Redeem</button>
                </div>
            </div>
        </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>© 2025 Forever Living by Mohd Arvind Isa. All rights reserved.</p>
      <div class="timestamp">Last updated: <span id="current-date"></span></div>
      <section class="disclaimer">
        <strong>Disclaimer:</strong> This website is operated by an independent Forever Business Owner.
      </section>
    </div>
  </footer>
</div>

<div id="auth-page" style="display: none;">
    <div class="form-container">
        <div id="login-form-container">
            <h2>Login to Your Account</h2>
            <input type="email" id="login-email" placeholder="Email Address">
            <input type="password" id="login-password" placeholder="Password">
            <button class="btn btn-primary" onclick="login()">Login</button>
            <p style="margin-top: 20px; font-size: 0.9rem;">Don't have an account? <a href="#" onclick="toggleAuthForms()">Register here</a></p>
        </div>
        <div id="register-form-container" style="display: none;">
            <h2>Create a New Account</h2>
            <input type="text" id="register-name" placeholder="Full Name">
            <input type="email" id="register-email" placeholder="Email Address">
            <input type="password" id="register-password" placeholder="Password">
            <button class="btn btn-primary" onclick="registerUser()">Register</button>
            <p style="margin-top: 20px; font-size: 0.9rem;">Already have an account? <a href="#" onclick="toggleAuthForms()">Login here</a></p>
        </div>
        <button class="btn btn-secondary" style="margin-top: 20px;" onclick="showStorePage()">Continue as Guest</button>
    </div>
</div>

<div id="dashboard-page" style="display: none;">
    <header>
        <div class="container">
            <h1>My Account</h1>
            <div class="header-account-links">
                <a onclick="logout()">Logout</a>
            </div>
        </div>
    </header>
    <div class="container dashboard-layout">
        <nav class="dashboard-nav">
            <a href="#" class="active" onclick="showUserTab('profile', this)">My Profile</a>
            <a href="#" onclick="showUserTab('update-profile', this)">Update Profile</a>
            <a href="#" onclick="showUserTab('purchase-history', this)">Purchase History</a>
            <a href="#" onclick="showUserTab('points-history', this)">Points History</a>
            <a href="#" onclick="showUserTab('wishlist', this)">My Wishlist</a>
        </nav>
        <div class="dashboard-content">
            <div id="profile" class="user-tab-content active">
                <h3>Personal Details</h3>
                <p><strong>Name:</strong> <span id="dash-name"></span></p>
                <p><strong>Email:</strong> <span id="dash-email"></span></p>
                <p><strong>Phone:</strong> <span id="dash-phone"></span></p>
                <p><strong>Total Points:</strong> <span id="dash-points"></span></p>
            </div>
            <div id="update-profile" class="user-tab-content">
                <h3>Update Your Profile</h3>
                <input type="text" id="update-name" placeholder="Full Name">
                <input type="tel" id="update-phone" placeholder="Phone Number">
                <button class="btn btn-primary" onclick="updateProfile()">Save Changes</button>
            </div>
            <div id="purchase-history" class="user-tab-content">
                <h3>Purchase History</h3>
                <table class="history-table">
                    <thead><tr><th>Order ID</th><th>Date</th><th>Total</th><th>Status</th></tr></thead>
                    <tbody id="dash-purchase-history"></tbody>
                </table>
            </div>
            <div id="points-history" class="user-tab-content">
                <h3>Points History</h3>
                <table class="history-table">
                    <thead><tr><th>Date</th><th>Description</th><th>Points</th></tr></thead>
                    <tbody id="dash-points-history"></tbody>
                </table>
            </div>
            <div id="wishlist" class="user-tab-content">
                <h3>My Wishlist</h3>
                <div id="dash-wishlist" class="product-list"></div>
            </div>
        </div>
    </div>
</div>

  <!-- Floating Cart Button -->
  <div id="floating-cart" class="floating-cart-btn" onclick="toggleCart()">
    <i class="fa-solid fa-cart-shopping"></i>
    <span id="cart-count">0</span>
  </div>

  <!-- Cart Modal -->
  <div id="cart-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="toggleCart()">×</span>
      <h2>Your Shopping Cart</h2>
      <div id="cart-items"><p>Your cart is currently empty.</p></div>
      <div class="cart-summary">
        <div class="summary-line"><span>Subtotal</span><span id="cart-subtotal">RM 0.00</span></div>
        <div class="summary-line"><span>Shipping</span><span id="cart-shipping">RM 0.00</span></div>
        <div class="summary-line total"><span>Total</span><span id="cart-total">RM 0.00</span></div>
      </div>
      <div id="points-container"></div>
      <div class="customer-info-form">
        <h3 style="margin-top: 20px;">Customer Information</h3>
        <input type="text" id="customer-name" placeholder="Your Full Name" required>
        <input type="tel" id="customer-phone" placeholder="Your WhatsApp Number" required>
        <button class="btn btn-primary checkout-btn" onclick="checkout()">Complete Order via WhatsApp</button>
      </div>
      <div class="free-shipping-promo">🚚 FREE NATIONWIDE DELIVERY for orders RM 250 and above!</div>
    </div>
  </div>

  <script>
    // --- DATA (Updated with all 58 products and promo prices) ---
    const products = [
        { id: 1, name: "ALOE VERA GEL", price: 116.79, promoPrice: 85.84, image: "aloe-vera-gel.jpg", benefits: "Supports digestion, boosts immunity.", consumption: "Take 30-60ml daily." },
        { id: 2, name: "ALOE BERRY NECTAR", price: 116.79, promoPrice: 85.84, image: "aloe-berry-nectar.jpg", benefits: "Antioxidant support, immune system booster.", consumption: "30-60ml daily." },
        { id: 3, name: "ALOE BITS N' PEACHES", price: 116.79, promoPrice: 85.84, image: "aloe-peaches.jpg", benefits: "Digestive health, vitamin C source.", consumption: "30-60ml daily." },
        { id: 4, name: "LITE VANILLA", price: 155.72, promoPrice: 114.45, image: "lite-vanilla.jpg", benefits: "Meal replacement for weight management.", consumption: "Mix with milk or water." },
        { id: 5, name: "LITE CHOCO", price: 155.72, promoPrice: 114.45, image: "lite-choco.jpg", benefits: "Meal replacement for weight management.", consumption: "Mix with milk or water." },
        { id: 6, name: "SUPERGREENS", price: 214.71, promoPrice: 157.82, image: "supergreens.jpg", benefits: "Rich in antioxidants and nutrients.", consumption: "Mix with water or juice." },
        { id: 7, name: "FIBER", price: 124.44, promoPrice: 91.47, image: "fiber.jpg", benefits: "Supports digestive health.", consumption: "Mix with water." },
        { id: 8, name: "TONGKAT ALI", price: 19.90, promoPrice: 18.80, image: "tongkat-ali.jpg", benefits: "Supports men's health and vitality.", consumption: "As per packaging." },
        { id: 9, name: "WHITE COFFEE", price: 15.99, promoPrice: 15.11, image: "white-coffee.jpg", benefits: "Rich and aromatic coffee.", consumption: "Mix with hot water." },
        { id: 10, name: "CHOCOLATE MALT DRINK", price: 27.90, promoPrice: 24.94, image: "choco-malt.jpg", benefits: "Nutritious chocolate malt drink.", consumption: "Mix with hot water or milk." },
        { id: 11, name: "TEH TARIK HALIA", price: 25.90, promoPrice: 23.15, image: "teh-tarik.jpg", benefits: "Ginger tea for warmth and digestion.", consumption: "Mix with hot water." },
        { id: 12, name: "BEE HONEY", price: 132.57, promoPrice: 97.44, image: "bee-honey.jpg", benefits: "Natural energy and soothes throat.", consumption: "1-2 teaspoons daily." },
        { id: 13, name: "BEE POLLEN", price: 75.50, promoPrice: 55.49, image: "bee-pollen.jpg", benefits: "Natural multivitamin and energy booster.", consumption: "1 tablet 3 times daily." },
        { id: 14, name: "BEE PROPOLIS", price: 139.21, promoPrice: 102.32, image: "bee-propolis.jpg", benefits: "Immune support, natural antibiotic.", consumption: "1 tablet daily." },
        { id: 15, name: "ROYAL GELLY", price: 139.21, promoPrice: 102.32, image: "royal-jelly.jpg", benefits: "Energy booster, supports immune system.", consumption: "1 tablet daily." },
        { id: 16, name: "OMEGA 3 PLUS", price: 130.10, promoPrice: 95.62, image: "arctic-sea.jpg", benefits: "Supports heart and brain health.", consumption: "2 softgels twice daily." },
        { id: 17, name: "ABSORBENT-C", price: 75.50, promoPrice: 55.49, image: "absorbent-c.jpg", benefits: "Immune support, antioxidant.", consumption: "1-2 tablets daily." },
        { id: 18, name: "FIELDS OF GREENS", price: 86.10, promoPrice: 63.28, image: "fields-of-greens.jpg", benefits: "Detoxification and digestion support.", consumption: "1 tablet 3 times daily." },
        { id: 19, name: "CALCIUM PLUS TABLET", price: 132.15, promoPrice: 97.14, image: "calcium-plus.jpg", benefits: "Supports bone health.", consumption: "2 tablets daily." },
        { id: 20, name: "ALOE LIPS", price: 20.33, promoPrice: 14.94, image: "aloe-lips.jpg", benefits: "Moisturizes and protects lips.", consumption: "Apply as needed." },
        { id: 21, name: "BRIGHT TOOTHGEL", price: 41.29, promoPrice: 30.35, image: "bright-toothgel.jpg", benefits: "Fluoride-free, gentle on gums.", consumption: "Brush teeth twice daily." },
        { id: 22, name: "ALOE FIRST", price: 90.83, promoPrice: 66.76, image: "aloe-first.jpg", benefits: "Soothes skin irritations.", consumption: "Spray on skin as needed." },
        { id: 23, name: "DEODORANT STICK", price: 50.73, promoPrice: 37.29, image: "forever-deodorant.jpg", benefits: "Long-lasting protection.", consumption: "Apply daily." },
        { id: 24, name: "AVOCADO SOAP", price: 30.68, promoPrice: 22.55, image: "avocado-soap.jpg", benefits: "Gentle cleansing for face and body.", consumption: "Use daily." },
        { id: 25, name: "ALOE LIQUID SOAP", price: 120.91, promoPrice: 88.87, image: "aloe-liquid-soap.jpg", benefits: "Moisturizing hand and face wash.", consumption: "Use daily." },
        { id: 26, name: "JOJOBA SHAMPOO", price: 105.93, promoPrice: 77.86, image: "aloe-jojoba-shampoo.jpg", benefits: "Nourishes hair and scalp.", consumption: "Massage into wet hair." },
        { id: 27, name: "JOJOBA CONDITIONER", price: 117.70, promoPrice: 86.51, image: "aloe-jojoba-conditioner.jpg", benefits: "Moisturizes and strengthens hair.", consumption: "Apply after shampoo." },
        { id: 28, name: "ALOE BODY WASH", price: 120.91, promoPrice: 88.87, image: "aloe-body-wash.jpg", benefits: "Gentle, moisturizing body wash.", consumption: "Use daily in shower." },
        { id: 29, name: "ALOE BODY LOTION", price: 112.35, promoPrice: 82.58, image: "aloe-body-lotion.jpg", benefits: "Hydrates and softens skin.", consumption: "Apply to body as needed." },
        { id: 30, name: "ALOE PROPOLIS CREME", price: 90.83, promoPrice: 66.76, image: "aloe-propolis-creme.jpg", benefits: "Soothes and moisturizes dry skin.", consumption: "Apply generously." },
        { id: 31, name: "ALOE VERA GELLY", price: 70.78, promoPrice: 52.03, image: "aloe-vera-gelly.jpg", benefits: "Soothes minor skin irritations.", consumption: "Apply to affected area." },
        { id: 32, name: "ALOE MOISTURIZING", price: 70.78, promoPrice: 52.03, image: "aloe-moisturizing.jpg", benefits: "Hydrates face and body.", consumption: "Apply as needed." },
        { id: 33, name: "ALOE MASSAGE LOTION", price: 70.78, promoPrice: 52.03, image: "aloe-massage-lotion.jpg", benefits: "Soothing lotion for massage.", consumption: "Massage into skin." },
        { id: 34, name: "ALOE MSM GEL", price: 86.00, promoPrice: 63.21, image: "aloe-msm-gel.jpg", benefits: "Soothes joints and muscles.", consumption: "Apply to affected areas." },
        { id: 35, name: "ALOE SUNSCREEN", price: 89.07, promoPrice: 65.47, image: "aloe-sunscreen.jpg", benefits: "UV protection with aloe.", consumption: "Apply before sun exposure." },
        { id: 36, name: "ALOE SCRUB", price: 77.86, promoPrice: 57.23, image: "aloe-scrub.jpg", benefits: "Gently exfoliates skin.", consumption: "Use 2-3 times a week." },
        { id: 37, name: "MASK POWDER", price: 102.90, promoPrice: 75.63, image: "mask-powder.jpg", benefits: "Cleanses and tightens pores.", consumption: "Mix with Aloe Activator." },
        { id: 38, name: "R3 FACTOR-SKIN DEFENSE", price: 160.97, promoPrice: 118.31, image: "r3-factor.jpg", benefits: "Helps skin retain moisture.", consumption: "Apply to face and neck." },
        { id: 39, name: "FOREVER ALPHA-E FACTOR", price: 144.90, promoPrice: 106.50, image: "alpha-e-factor.jpg", benefits: "Nourishes and restores skin.", consumption: "Apply a few drops to face." },
        { id: 40, name: "INFINITE HYDRATING CLEANSER", price: 131.20, promoPrice: 96.43, image: "infinite-cleanser.jpg", benefits: "Gentle, hydrating cleanser.", consumption: "Use morning and night." },
        { id: 41, name: "INFINITE FIRMING SERUM", price: 190.47, promoPrice: 140.00, image: "infinite-serum.jpg", benefits: "Reduces appearance of fine lines.", consumption: "Apply to face." },
        { id: 42, name: "INFINITE RESTORING CREME", price: 221.56, promoPrice: 162.86, image: "infinite-creme.jpg", benefits: "Deeply moisturizes and restores skin.", consumption: "Apply to face and neck." },
        { id: 43, name: "BALANCING TONER", price: 106.18, promoPrice: 78.05, image: "balancing-toner.jpg", benefits: "Refreshes and balances skin.", consumption: "Apply after cleansing." },
        { id: 44, name: "AWAKENING EYE CREAM", price: 89.66, promoPrice: 65.90, image: "eye-cream.jpg", benefits: "Reduces puffiness and dark circles.", consumption: "Pat gently around eyes." },
        { id: 45, name: "ALOE ACTIVATOR", price: 80.59, promoPrice: 59.23, image: "aloe-activator.jpg", benefits: "Cleanses, soothes and refreshes.", consumption: "Use with Mask Powder." },
        { id: 46, name: "HYDRATING SERUM", price: 156.56, promoPrice: 115.07, image: "hydrating-serum.jpg", benefits: "Boosts skin hydration.", consumption: "Apply to face." },
        { id: 47, name: "S.REFRESHING G.CLEANSER", price: 115.61, promoPrice: 84.98, image: "refreshing-cleanser.jpg", benefits: "Gentle gel cleanser.", consumption: "Use morning and night." },
        { id: 48, name: "S. IILUMINATING GEL", price: 107.35, promoPrice: 78.91, image: "illuminating-gel.jpg", benefits: "Brightens skin appearance.", consumption: "Apply to face." },
        { id: 49, name: "S. REFINING GEL MASK", price: 115.61, promoPrice: 84.98, image: "refining-mask.jpg", benefits: "Refines pores and moisturizes.", consumption: "Use 2-3 times a week." },
        { id: 50, name: "S.SMOOTHING GEL MOISTURIZER", price: 115.76, promoPrice: 85.08, image: "smoothing-moisturizer.jpg", benefits: "Lightweight gel moisturizer.", consumption: "Apply to face." },
        { id: 51, name: "ALOE BIO-CELLULOSE MASK", price: 146.00, promoPrice: 107.31, image: "bio-cellulose-mask.jpg", benefits: "Deeply hydrates and conditions skin.", consumption: "Use once a week." },
        { id: 52, name: "REPLENISHING SKIN OIL", price: 132.00, promoPrice: 97.02, image: "skin-oil.jpg", benefits: "Nourishes with a blend of oils.", consumption: "Apply a few drops to face." },
        { id: 53, name: "PROTECTING DAY LOTION", price: 167.99, promoPrice: 123.47, image: "day-lotion.jpg", benefits: "Moisturizes and protects with SPF.", consumption: "Apply in the morning." },
        { id: 54, name: "C9 LITE VANILLA with FIBER", price: 749.02, promoPrice: 550.53, image: "c9-vanilla.jpg", benefits: "9-day nutritional reset program.", consumption: "Follow included guide." },
        { id: 55, name: "C9 LITE CHOCO with FIBER", price: 749.02, promoPrice: 550.53, image: "c9-choco.jpg", benefits: "9-day nutritional reset program.", consumption: "Follow included guide." },
        { id: 56, name: "DAILY NUTRITION PACK", price: 542.07, promoPrice: 398.42, image: "daily-nutrition-pack.jpg", benefits: "Daily supplement pack.", consumption: "Take one pack daily." },
        { id: 57, name: "SYJP PACK #1", price: 1613.36, promoPrice: null, image: "syjp-pack1.jpg", benefits: "Business starter pack.", consumption: "N/A" },
        { id: 58, name: "SYJP PACK #2", price: 1613.98, promoPrice: null, image: "syjp-pack2.jpg", benefits: "Business starter pack.", consumption: "N/A" }
    ];
    let cart = [];
    const promoEndDate = new Date("August 2, 2025 23:59:59").getTime();

    // --- LOGIC (Updated) ---

    function isPromoActive() {
        return new Date().getTime() < promoEndDate;
    }

    function renderProducts() {
      const productList = document.getElementById('product-list');
      if (!productList) return;
      const isLoggedIn = !!sessionStorage.getItem('loggedInUser');
      const promoActive = isPromoActive();
      
      productList.innerHTML = products.map(product => {
        const finalPrice = promoActive && product.promoPrice ? product.promoPrice : product.price;
        const hasDiscount = promoActive && product.promoPrice;
        const points = Math.floor(finalPrice);
        const wishlistBtn = isLoggedIn ? `<button class="btn btn-secondary" onclick="addToWishlist(${product.id})"><i class="fa-solid fa-heart"></i> Add to Wishlist</button>` : '';
        
        return `
          <div class="product ${hasDiscount ? 'promo-highlight' : ''}">
            ${hasDiscount ? '<div class="featured-badge">Promo!</div>' : ''}
            <div class="product-image-container"><img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/200x200?text=Image+Not+Found'"></div>
            <div class="product-info">
                <h3>${product.name}</h3>
                <div class="price-section">
                    ${hasDiscount ? `<span class="original-price">RM ${product.price.toFixed(2)}</span><span class="new-price">RM ${finalPrice.toFixed(2)}</span>` : `<span class="new-price">RM ${finalPrice.toFixed(2)}</span>`}
                </div>
                <div class="benefits"><strong>Benefits:</strong> ${product.benefits}</div>
                <div class="consumption"><strong>Usage:</strong> ${product.consumption}</div>
                <div class="product-points"><i class="fa-solid fa-star"></i> Earn ${points} Points</div>
                <div class="product-actions">
                    <button class="btn btn-primary" onclick="addToCart(${product.id})"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
                    ${wishlistBtn}
                </div>
            </div>
          </div>`;
      }).join('');
    }

    function showTab(tabId) {
      document.querySelectorAll('#main-content .tab-content').forEach(el => el.classList.remove('active'));
      const activeTab = document.getElementById(tabId);
      if(activeTab) activeTab.classList.add('active');
    }

    function toggleCart() {
      const modal = document.getElementById('cart-modal');
      modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
      if (modal.style.display === 'flex') updateCartDisplay();
    }

    function addToCart(productId) {
      const existingItem = cart.find(item => item.id === productId);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        const productData = products.find(p => p.id === productId);
        const finalPrice = isPromoActive() && productData.promoPrice ? productData.promoPrice : productData.price;
        cart.push({ id: productData.id, name: productData.name, price: finalPrice, quantity: 1 });
      }
      updateCartCount();
    }

    function increaseQuantity(productId) {
        const item = cart.find(p => p.id === productId);
        if (item) { item.quantity++; updateCartDisplay(); updateCartCount(); }
    }

    function decreaseQuantity(productId) {
        const item = cart.find(p => p.id === productId);
        if (item) {
            item.quantity--;
            if (item.quantity <= 0) removeItemFromCart(productId);
            else { updateCartDisplay(); updateCartCount(); }
        }
    }

    function removeItemFromCart(productId) {
        cart = cart.filter(p => p.id !== productId);
        updateCartDisplay();
        updateCartCount();
    }

    function calculateShipping(cart, subtotal) {
        if (subtotal >= 250) return { fee: 0, message: "FREE" };
        if (cart.length === 0) return { fee: 0, message: "RM 0.00" };
        const baseShipping = 14.00, reductionPerItem = 0.30;
        const finalFee = baseShipping * (1 - (reductionPerItem * (cart.length - 1)));
        const calculatedFee = Math.max(0, finalFee);
        return { fee: calculatedFee, message: `RM ${calculatedFee.toFixed(2)}` };
    }
    
    function updateCartDisplay() {
      const cartItemsEl = document.getElementById('cart-items');
      const subtotalEl = document.getElementById('cart-subtotal');
      const shippingEl = document.getElementById('cart-shipping');
      const totalEl = document.getElementById('cart-total');
      const pointsContainer = document.getElementById('points-container');
      
      if (cart.length === 0) {
        cartItemsEl.innerHTML = '<p>Your cart is empty</p>';
        subtotalEl.textContent = 'RM 0.00';
        shippingEl.textContent = 'RM 0.00';
        totalEl.textContent = 'RM 0.00';
        pointsContainer.innerHTML = '';
        return;
      }
      
      let itemsHTML = '';
      const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      
      cart.forEach(item => {
        itemsHTML += `
          <div class="cart-item">
            <div class="cart-item-details">
                <strong>${item.name}</strong>
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="decreaseQuantity(${item.id})">-</button>
                    <span class="quantity-display">${item.quantity}</span>
                    <button class="quantity-btn" onclick="increaseQuantity(${item.id})">+</button>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span>RM ${(item.price * item.quantity).toFixed(2)}</span>
                <span class="remove-item-btn" onclick="removeItemFromCart(${item.id})">×</span>
            </div>
          </div>`;
      });
      
      const shipping = calculateShipping(cart, subtotal);
      const total = subtotal + shipping.fee;
      const points = Math.floor(subtotal);
      const isLoggedIn = !!sessionStorage.getItem('loggedInUser');

      cartItemsEl.innerHTML = itemsHTML;
      subtotalEl.textContent = `RM ${subtotal.toFixed(2)}`;
      shippingEl.textContent = shipping.message;
      totalEl.textContent = `RM ${total.toFixed(2)}`;
      
      if (isLoggedIn) {
          pointsContainer.innerHTML = `<div class="points-earned"><i class="fa-solid fa-star"></i> Points Earned: <span id="points-earned">${points}</span></div>`;
      } else {
          pointsContainer.innerHTML = `<div class="guest-remark">Register or login to earn points on this purchase!</div>`;
      }
    }

    function updateCartCount() {
      const count = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById('cart-count').textContent = count;
    }

    function checkout() {
      const name = document.getElementById('customer-name').value.trim();
      const phone = document.getElementById('customer-phone').value.trim();
      if (!name || !phone) { alert('Please enter your name and phone number'); return; }
      if (cart.length === 0) { alert('Your cart is empty'); return; }
      
      const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      const shipping = calculateShipping(cart, subtotal);
      const total = subtotal + shipping.fee;
      const points = Math.floor(subtotal);
      
      const loggedInUserEmail = sessionStorage.getItem('loggedInUser');
      if (loggedInUserEmail) {
          let users = JSON.parse(localStorage.getItem('users')) || [];
          const userIndex = users.findIndex(u => u.email === loggedInUserEmail);
          if (userIndex !== -1) {
              const newPurchase = { id: `#${Date.now().toString().slice(-4)}`, date: new Date().toLocaleDateString('en-GB'), total: total.toFixed(2), status: 'Processing' };
              const newPoints = { date: new Date().toLocaleDateString('en-GB'), description: `Order ${newPurchase.id}`, points: `+${points}` };
              users[userIndex].purchaseHistory.push(newPurchase);
              users[userIndex].pointsHistory.push(newPoints);
              users[userIndex].totalPoints += points;
              localStorage.setItem('users', JSON.stringify(users));
          }
      }

      let message = `Hi, I would like to place an order:\n\nName: ${name}\nPhone: ${phone}\n\n--- ORDER DETAILS ---\n`;
      cart.forEach(item => { message += `- ${item.name} (x${item.quantity}) - RM ${(item.price * item.quantity).toFixed(2)}\n`; });
      message += `\n--- SUMMARY ---\nSubtotal: RM ${subtotal.toFixed(2)}\nShipping: ${shipping.message}\nTOTAL: RM ${total.toFixed(2)}\n`;
      if (loggedInUserEmail) message += `Points Earned: ${points}\n\n`;
      message += `Please confirm my order. Thank you!`;
      
      window.open(`https://wa.me/601111033154?text=${encodeURIComponent(message)}`, '_blank');
      
      cart = [];
      updateCartCount();
      toggleCart();
    }

    // --- User Account Functions ---
    function showPage(pageId) {
        document.getElementById('store-wrapper').style.display = 'none';
        document.getElementById('auth-page').style.display = 'none';
        document.getElementById('dashboard-page').style.display = 'none';
        document.getElementById(pageId).style.display = 'block';
    }
    
    function showAuthPage() { showPage('auth-page'); }
    function showStorePage() { showPage('store-wrapper'); }
    function showDashboardPage() { showPage('dashboard-page'); }

    function toggleAuthForms() {
        const loginForm = document.getElementById('login-form-container');
        const registerForm = document.getElementById('register-form-container');
        loginForm.style.display = loginForm.style.display === 'none' ? 'block' : 'none';
        registerForm.style.display = registerForm.style.display === 'none' ? 'block' : 'none';
    }

    function registerUser() {
        const name = document.getElementById('register-name').value.trim();
        const email = document.getElementById('register-email').value.trim();
        const password = document.getElementById('register-password').value.trim();
        if (!name || !email || !password) { alert('Please fill in all fields.'); return; }

        let users = JSON.parse(localStorage.getItem('users')) || [];
        if (users.find(user => user.email === email)) { alert('An account with this email already exists.'); return; }

        users.push({ name, email, password, phone: '', totalPoints: 0, purchaseHistory: [], pointsHistory: [], redemptionHistory: [], myVouchers: [], wishlist: [] });
        localStorage.setItem('users', JSON.stringify(users));
        alert('Registration successful! Please login.');
        toggleAuthForms();
    }

    function login() {
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value.trim();
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const user = users.find(u => u.email === email && u.password === password);

        if (user) {
            sessionStorage.setItem('loggedInUser', user.email);
            document.getElementById('account-link').textContent = 'My Account';
            document.getElementById('account-link').setAttribute('onclick', 'showDashboardPage()');
            renderDashboard(user);
            showDashboardPage();
            renderProducts(); // Re-render to show wishlist buttons
            updateRedeemButtonsState();
        } else {
            alert('Invalid email or password.');
        }
    }

    function logout() {
        sessionStorage.removeItem('loggedInUser');
        document.getElementById('account-link').textContent = 'Login';
        document.getElementById('account-link').setAttribute('onclick', 'showAuthPage()');
        showStorePage();
        renderProducts(); // Re-render to hide wishlist buttons
        updateRedeemButtonsState();
    }

    function renderDashboard(user) {
        document.getElementById('dash-name').textContent = user.name;
        document.getElementById('dash-email').textContent = user.email;
        document.getElementById('dash-phone').textContent = user.phone || 'Not set';
        document.getElementById('dash-points').textContent = user.totalPoints;
        
        document.getElementById('update-name').value = user.name;
        document.getElementById('update-phone').value = user.phone || '';

        const purchaseHistoryBody = document.getElementById('dash-purchase-history');
        purchaseHistoryBody.innerHTML = user.purchaseHistory.length ? user.purchaseHistory.map(p => `<tr><td>${p.id}</td><td>${p.date}</td><td>RM ${p.total}</td><td>${p.status}</td></tr>`).join('') : '<tr><td colspan="4">No purchases yet.</td></tr>';

        const pointsHistoryBody = document.getElementById('dash-points-history');
        pointsHistoryBody.innerHTML = user.pointsHistory.length ? user.pointsHistory.map(p => `<tr><td>${p.date}</td><td>${p.description}</td><td style="color: green;">${p.points}</td></tr>`).join('') : '<tr><td colspan="3">No points history.</td></tr>';
        
        const wishlistContainer = document.getElementById('dash-wishlist');
        wishlistContainer.innerHTML = user.wishlist.length ? user.wishlist.map(productId => {
            const product = products.find(p => p.id === productId);
            return product ? `<div class="product"><h3>${product.name}</h3><img src="${product.image}" style="height:100px; object-fit:contain;"><button class="btn btn-primary" onclick="addToCart(${product.id}); toggleCart();">Add to Cart</button></div>` : '';
        }).join('') : '<p>Your wishlist is empty.</p>';
    }

    function updateProfile() {
        const loggedInUserEmail = sessionStorage.getItem('loggedInUser');
        if (!loggedInUserEmail) return;
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const userIndex = users.findIndex(u => u.email === loggedInUserEmail);

        if (userIndex !== -1) {
            users[userIndex].name = document.getElementById('update-name').value.trim();
            users[userIndex].phone = document.getElementById('update-phone').value.trim();
            localStorage.setItem('users', JSON.stringify(users));
            alert('Profile updated successfully!');
            renderDashboard(users[userIndex]);
            showUserTab('profile', document.querySelector('.dashboard-nav a'));
        }
    }

    function addToWishlist(productId) {
        const loggedInUserEmail = sessionStorage.getItem('loggedInUser');
        if (!loggedInUserEmail) { alert('Please login to add items to your wishlist.'); return; }
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const userIndex = users.findIndex(u => u.email === loggedInUserEmail);

        if (userIndex !== -1) {
            if (!users[userIndex].wishlist.includes(productId)) {
                users[userIndex].wishlist.push(productId);
                localStorage.setItem('users', JSON.stringify(users));
                alert('Item added to your wishlist!');
            } else {
                alert('This item is already in your wishlist.');
            }
        }
    }

    function showUserTab(tabId, element) {
        document.querySelectorAll('.user-tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('.dashboard-nav a').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }

    function updateRedeemButtonsState() {
        const isLoggedIn = !!sessionStorage.getItem('loggedInUser');
        document.querySelectorAll('.redeem-btn').forEach(btn => {
            btn.disabled = !isLoggedIn;
            btn.title = isLoggedIn ? "" : "You must be logged in to redeem.";
        });
    }

    function startCountdown() {
        const countdownEl = document.getElementById('countdown-timer');
        const promoDetailsEl = document.getElementById('promo-details');

        const interval = setInterval(() => {
            const now = new Date().getTime();
            const distance = promoEndDate - now;

            if (distance < 0) {
                clearInterval(interval);
                promoDetailsEl.innerHTML = '<div class="promo-period">Our Grand Opening promotion has ended.</div>';
                document.body.classList.remove('grand-opening-active');
                renderProducts(); // Re-render products with original prices
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownEl.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }, 1000);
    }

    function createConfetti() {
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
            confetti.style.animationDelay = Math.random() * 5 + 's';
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            document.body.appendChild(confetti);
        }
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      if (isPromoActive()) {
          document.body.classList.add('grand-opening-active');
          startCountdown();
          createConfetti();
      } else {
          document.getElementById('promo-details').innerHTML = '<div class="promo-period">Our Grand Opening promotion has ended.</div>';
      }

      renderProducts();
      showTab('products');
      updateRedeemButtonsState();
    });
  </script>
</body>
</html>
